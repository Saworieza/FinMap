webpackJsonp([3],{101:function(t,e,i){var n=i(543),a=i(534),s=new a({locale:"en",phrases:n.en}),r=s.t.bind(s),o={"aggregate-intersection":{title:r("analyses.aggregate-intersection.short-title")},"bounding-box":{title:r("analyses.bounding-box.short-title")},"bounding-circle":{title:r("analyses.bounding-circle.short-title")},buffer:{title:r("analyses.area-of-influence.short-title")},centroid:{title:r("analyses.centroid.short-title")},"convex-hull":{title:r("analyses.convex-hull.short-title")},"concave-hull":{title:r("analyses.concave-hull.short-title")},"data-observatory-measure":{title:r("analyses.data-observatory-measure.short-title")},"filter-by-node-column":{title:r("analyses.filter-by-node-column.short-title")},"filter-category":{title:r("analyses.filter.short-title")},"filter-range":{title:r("analyses.filter.short-title")},"georeference-city":{title:r("analyses.georeference.short-title")},"georeference-ip-address":{title:r("analyses.georeference.short-title")},"georeference-country":{title:r("analyses.georeference.short-title")},"georeference-long-lat":{title:r("analyses.georeference.short-title")},"georeference-postal-code":{title:r("analyses.georeference.short-title")},"georeference-street-address":{title:r("analyses.georeference.short-title")},"georeference-admin-region":{title:r("analyses.georeference.short-title")},intersection:{title:r("analyses.filter-intersection.short-title")},kmeans:{title:r("analyses.kmeans.short-title")},"line-to-column":{title:r("analyses.connect-with-lines.short-title")},"line-to-single-point":{title:r("analyses.connect-with-lines.short-title")},"line-source-to-target":{title:r("analyses.connect-with-lines.short-title")},"line-sequential":{title:r("analyses.connect-with-lines.short-title")},merge:{title:r("analyses.merge.short-title")},moran:{title:r("analyses.moran-cluster.short-title")},"routing-sequential":{title:r("analyses.routing.short-title")},"routing-to-layer-all-to-all":{title:r("analyses.routing.short-title")},"routing-to-single-point":{title:r("analyses.routing.short-title")},sampling:{title:r("analyses.sampling.short-title")},"spatial-markov-trend":{title:r("analyses.spatial-markov-trend.short-title")},"trade-area":{title:r("analyses.area-of-influence.short-title")},"weighted-centroid":{title:r("analyses.centroid.short-title")},closest:{title:r("analyses.find-nearest.short-title")},"deprecated-sql-function":{title:r("analyses.deprecated-sql-function.short-title")}},l=function(t){return o[t]||{title:r("analyses."+t)}};t.exports={MAP:o,title:function(t){return l(t).title}}},102:function(t,e,i){var n=i(0);t.exports={COLORS:["#66B79E","#E65176","#528995","#FF710F","#305482","#CCD859","#565175","#FFB927","#3EBCAE","#E54C1F"],letter:function(t){if(!t||!n.isString(t))return"";var e=t.match(/^([a-z]+)/);return n.isArray(e)&&e[0]||""},getColorForLetter:function(t){if(!t)return this.COLORS[0];var e=t.charCodeAt(0)-97,i=(e/this.COLORS.length%1*10).toFixed();return this.COLORS[i]||this.COLORS[0]}}},104:function(t,e,i){"use strict";function n(){}function a(t){var e;return t=(t+"").trim().toLowerCase(),(e=C.exec(t))?(e=parseInt(e[1],16),new h(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1)):(e=y.exec(t))?s(parseInt(e[1],16)):(e=x.exec(t))?new h(e[1],e[2],e[3],1):(e=S.exec(t))?new h(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=B.exec(t))?r(e[1],e[2],e[3],e[4]):(e=D.exec(t))?r(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=M.exec(t))?d(e[1],e[2]/100,e[3]/100,1):(e=k.exec(t))?d(e[1],e[2]/100,e[3]/100,e[4]):j.hasOwnProperty(t)?s(j[t]):"transparent"===t?new h(NaN,NaN,NaN,0):null}function s(t){return new h(t>>16&255,t>>8&255,255&t,1)}function r(t,e,i,n){return n<=0&&(t=e=i=NaN),new h(t,e,i,n)}function o(t){return t instanceof n||(t=a(t)),t?(t=t.rgb(),new h(t.r,t.g,t.b,t.opacity)):new h}function l(t,e,i,n){return 1===arguments.length?o(t):new h(t,e,i,null==n?1:n)}function h(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}function d(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new g(t,e,i,n)}function c(t){if(t instanceof g)return new g(t.h,t.s,t.l,t.opacity);if(t instanceof n||(t=a(t)),!t)return new g;if(t instanceof g)return t;t=t.rgb();var e=t.r/255,i=t.g/255,s=t.b/255,r=Math.min(e,i,s),o=Math.max(e,i,s),l=NaN,h=o-r,d=(o+r)/2;return h?(l=e===o?(i-s)/h+6*(i<s):i===o?(s-e)/h+2:(e-i)/h+4,h/=d<.5?o+r:2-o-r,l*=60):h=d>0&&d<1?0:l,new g(l,h,d,t.opacity)}function u(t,e,i,n){return 1===arguments.length?c(t):new g(t,e,i,null==n?1:n)}function g(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}function p(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}var _=i(105);e.c=n,i.d(e,"e",function(){return f}),i.d(e,"d",function(){return m}),e.h=a,e.b=o,e.g=l,e.a=h,e.f=u;var f=.7,m=1/f,v="\\s*([+-]?\\d+)\\s*",b="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",w="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",C=/^#([0-9a-f]{3})$/,y=/^#([0-9a-f]{6})$/,x=new RegExp("^rgb\\("+[v,v,v]+"\\)$"),S=new RegExp("^rgb\\("+[w,w,w]+"\\)$"),B=new RegExp("^rgba\\("+[v,v,v,b]+"\\)$"),D=new RegExp("^rgba\\("+[w,w,w,b]+"\\)$"),M=new RegExp("^hsl\\("+[b,w,w]+"\\)$"),k=new RegExp("^hsla\\("+[b,w,w,b]+"\\)$"),j={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};i.i(_.a)(n,a,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),i.i(_.a)(h,l,i.i(_.b)(n,{brighter:function(t){return t=null==t?m:Math.pow(m,t),new h(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?f:Math.pow(f,t),new h(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(1===t?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),i.i(_.a)(g,u,i.i(_.b)(n,{brighter:function(t){return t=null==t?m:Math.pow(m,t),new g(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?f:Math.pow(f,t),new g(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,a=2*i-n;return new h(p(t>=240?t-240:t+120,a,n),p(t,a,n),p(t<120?t+240:t-120,a,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}))},105:function(t,e,i){"use strict";function n(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}e.b=n,e.a=function(t,e,i){t.prototype=e.prototype=i,i.constructor=t}},106:function(t,e,i){"use strict";function n(t,e,i,n,a){var s=t*t,r=s*t;return((1-3*t+3*s-r)*e+(4-6*s+3*r)*i+(1+3*t+3*s-3*r)*n+r*a)/6}e.b=n,e.a=function(t){var e=t.length-1;return function(i){var a=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),s=t[a],r=t[a+1],o=a>0?t[a-1]:2*s-r,l=a<e-1?t[a+2]:2*r-s;return n((i-a/e)*e,o,s,r,l)}}},107:function(t,e,i){"use strict";var n=i(37),a=i(262),s=i(257),r=i(260),o=i(73),l=i(261),h=i(263),d=i(259);e.a=function(t,e){var c,u=typeof e;return null==e||"boolean"===u?i.i(d.a)(e):("number"===u?o.a:"string"===u?(c=i.i(n.f)(e))?(e=c,a.a):h.a:e instanceof n.f?a.a:e instanceof Date?r.a:Array.isArray(e)?s.a:isNaN(e)?l.a:o.a)(t,e)}},108:function(t,e,i){var n=i(608);t.exports=Function.prototype.bind||n},117:function(t,e,i){var n=i(812),a=i(0);t.exports={getURLFromState:function(t){var e=new n(this.getLocalURL());if(e.removeQuery("state"),!a.isEmpty(t)){var i=JSON.stringify(t);e.setQuery("state",i)}return e.toString()},getStateFromCurrentURL:function(){var t=this.getLocalURL();return this.getStateFromURL(t)},getStateFromURL:function(t){var e,i=new n(t),s={};return i.hasQuery("state")&&(e=i.query(!0).state,a.isEmpty(e)||(s=JSON.parse(decodeURIComponent(e)))),s},getLocalURL:a.constant(window.location.href)}},22:function(t,e,i){var n=i(0),a=i(31),s={};s.formatNumber=function(t,e){if(!n.isNumber(t)||0===t)return t;var i=a.format(".2s"),s=0,r=Math.abs(t);if(t>1e3)return t=i(t)+(e?" "+e:"");r>100?s=0:r>10?s=1:r>1?s=2:r>0&&(s=Math.max(Math.ceil(Math.abs(Math.log(r)/Math.log(10)))+2,3)),t=t.toFixed(s);var o=t.match(/(\.0+)$/);return o&&(t=t.replace(o[0],"")),t},s.formatDate=function(t){return a.time.format("%Y-%m-%d")(t)},s.formatTime=function(t){return a.time.format("%H:%M:%S %d/%m/%Y")(t)},s.timeFactory=function(t){return a.time.format(t)},s.formatValue=function(t){return n.isNumber(t)?s.formatNumber(t):n.isDate(t)?s.formatDate(t):t},t.exports=s},247:function(t,e,i){var n=i(5),a=i(545);t.exports=n.core.Model.extend({initialize:function(t,e){this.options=e||{},this.styles=e&&e.auto_style,this.dataviewModel=t,this.colors=new a(this.styles),this.layer=this.dataviewModel.layer}})},248:function(t,e,i){function n(t,e){var i=d().process(t),n=i.result.root,r=!1;return n.walk(function(t){var i=t.parent;"decl"===t.type&&t.prop===e&&(a(i)&&!s(i)||(r=!0))}),r}function a(t){return"rule"===t.type&&-1!==t.selector.search(/\[(.)+\]/g)}function s(t){return a(t)&&-1!==t.selector.search("mapnik::geometry_type")}function r(t){return"rule"===t.type&&-1!==t.selector.search("::outline")}function o(t){return t.replace(new RegExp(String.fromCharCode(160),"g")," ")}function l(t,e,i){var n=d().process(t),s=n.result.root,o=!1;return s.walk(function(t){var n=t.parent;"decl"===t.type&&t.prop===e&&(r(n)&&"line-color"===e||(a(n)||o?t.remove():(t.value=i,o=!0)))}),n.css}var h=i(0),d=i(267);t.exports={changeStyle:h.memoize(l,function(t,e,i){return t+e+i}),isPropertyIncluded:n,replaceWrongSpaceChar:o}},249:function(t,e,i){var n=i(3),a=i(0),s=i(5),r=i(551),o=i(781);t.exports=s.core.View.extend({options:{paginator:!1,itemsPerPage:6},className:"CDB-Widget-list CDB-Widget-list--wrapped js-list",tagName:"ul",initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this.dataviewModel.get("sync_on_bbox_change")||this.$el.addClass("CDB-Widget-list--nodynamic"),this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var t=this.dataviewModel.getData();return a.isEmpty(t)||0===a.size(t)?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){this.widgetModel.bind("change:search",this.toggle,this),this.widgetModel.bind("change:autoStyle",this.render,this),this.widgetModel.bind("change:style",this.render,this),this.add_related_model(this.widgetModel),this.dataviewModel.bind("change:data",this.render,this),this.dataviewModel.bind("change:sync_on_bbox_change",this.blockFiltering,this),this.add_related_model(this.dataviewModel)},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--withBorders CDB-Widget-list--fake").removeClass("CDB-Widget-list--wrapped"),this.$el.append(o())},_renderList:function(){this.$el.removeClass("CDB-Widget-list--withBorders CDB-Widget-list--fake"),this.$el[this.options.paginator?"addClass":"removeClass"]("CDB-Widget-list--wrapped");var t;this.dataviewModel.getData().each(function(e,i){i%this.options.itemsPerPage==0&&(t=n("<div>").addClass("CDB-Widget-listGroup"),this.$el.append(t)),this._addItem(e,t)},this)},_addItem:function(t,e){var i=new r({model:t,widgetModel:this.widgetModel,dataviewModel:this.dataviewModel});i.bind("itemClicked",this._setFilters,this),this.addView(i),e.append(i.render().el)},_setFilters:function(t){if(!this.dataviewModel.get("sync_on_bbox_change"))return this;var e=t.get("selected"),i=this.dataviewModel.filter,n=t.get("name");if(e)if(0===i.rejectedCategories.size()&&0===i.acceptedCategories.size()){var a=this.dataviewModel.getData();a.each(function(t){t.get("name")!==n&&t.set("selected",!1)}),i.accept(t.get("name"))}else t.set("selected",!1),i.reject(n);else t.set("selected",!0),i.accept(n);this.widgetModel.set("acceptedCategories",this.widgetModel._acceptedCategories().pluck("name"))},blockFiltering:function(t){t.changed.sync_on_bbox_change?this.$el.removeClass("CDB-Widget-list--nodynamic"):(this.$el.addClass("CDB-Widget-list--nodynamic"),this.dataviewModel.filter.acceptAll())},removeSelections:function(){this.dataviewModel.filter.acceptAll()},toggle:function(){this[this.widgetModel.isSearchEnabled()?"hide":"show"]()},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})},250:function(t,e,i){var n=i(3),a=i(0),s=i(5),r=i(784);t.exports=s.core.View.extend({options:{itemsPerPage:6,template:r,paginator:!1},className:"CDB-Widget-nav CDB-Widget-contentSpaced",events:{"click .js-searchToggle":"_onSearchClicked","click .js-page":"_onDotClick"},initialize:function(){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._$target=this.options.$target,this.model=new s.core.Model({page:0}),this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var t=this.dataviewModel.getCount(),e="ontouchstart"in window;if(t>5){var i=Math.ceil(this.dataviewModel.getSize()/this.options.itemsPerPage),n=this.options.template;this.$el.html(n({showSearch:!e,showPaginator:this.options.paginator,currentPage:this.model.get("page"),categoriesCount:t,pages:i}))}else this.model.set("page",0);return this._scrollToPage(),this},_initBinds:function(){n(window).bind("resize."+this.cid,a.bind(this._scrollToPage,this)),this.model.bind("change:page",this.render,this),this.dataviewModel.bind("change:categoriesCount",this.render,this),this.dataviewModel.bind("change:data change:searchData",function(){this._setPage(),this.render()},this),this.widgetModel.bind("change:search",this.toggle,this),this.add_related_model(this.dataviewModel),this.add_related_model(this.widgetModel)},_setPage:function(){var t=this.dataviewModel.getSize(),e=Math.ceil(t/this._ITEMS_PER_PAGE);this.model.get("page")>e-1&&this.model.set({page:0},{silent:!0})},_onSearchClicked:function(){this.widgetModel.setupSearch()},_scrollToPage:function(){var t=this.model.get("page"),e=this._$target.find(".CDB-Widget-listGroup").first().outerWidth();this._$target.css("margin-left",-t*e)},_onDotClick:function(t){var e=n(t.target).data("page");this.model.set("page",e)},toggle:function(){this[this.widgetModel.isSearchEnabled()?"hide":"show"]()},hide:function(){this.$el.addClass("is-hidden")},show:function(){this.$el.removeClass("is-hidden")},clean:function(){n(window).unbind("resize."+this.cid),s.core.View.prototype.clean.call(this)}})},251:function(t,e,i){var n=i(3),a=i(0),s=i(31),r=i(584),o=i(5),l=i(653),h=i(22),d=function(t,e,i,n,a,s,r){var o=s+1*r;return"M "+t+" "+e+" L "+i+" "+n+" C "+(a+.1)+" "+o+" "+(a-.1)+" "+o+" "+t+" "+e+" z"};t.exports=o.core.View.extend({options:{showOnWidthChange:!0,chartBarColor:"#F2CC8F",labelsMargin:16,hasAxisTip:!1,minimumBarHeight:2,animationSpeed:750,handleWidth:10,handleHeight:23,handleRadius:3,divisionWidth:80,animationBarDelay:function(t,e){return Math.random()*(100+10*e)},transitionType:"elastic"},initialize:function(){if(this._originalData=this.options.originalData,!a.isNumber(this.options.height))throw new Error("height is required");a.bindAll(this,"_selectBars","_adjustBrushHandles","_onBrushMove","_onBrushEnd","_onMouseMove","_onMouseOut"),this._onWindowResize=a.debounce(this._resizeToParentElement.bind(this),50),n(window).bind("resize",this._onWindowResize),this.setElement(n('<svg class=""></svg>')[0]),this.options.mini||this.$el.attr("class","CDB-Chart--histogram"),this._widgetModel=this.options.widgetModel,this._dataviewModel=this.options.dataviewModel,this.canvas=s.select(this.el).style("overflow","visible").attr("width",0).attr("height",this.options.height),this.canvas.append("g").attr("class","CDB-WidgetCanvas"),this._setupModel(),this._setupBindings(),this._setupDimensions(),this._setupD3Bindings(),this._setupFillColor(),this.hide(),this.formatter="time"===this.options.type?h.timeFactory("%H:%M:%S %d/%m/%Y"):h.formatNumber},render:function(){return this._generateChart(),this._generateChartContent(),this},replaceData:function(t){this.model.set({data:t})},toggleLabels:function(t){this.model.set("showLabels",t)},chartWidth:function(){var t=this.model.get("margin");return Math.max(0,this.model.get("width")-t.left-t.right)},chartHeight:function(){var t=this.model.get("margin"),e=this.model.get("showLabels")?this.options.labelsMargin:0;return this.model.get("height")-t.top-t.bottom-e},_resizeToParentElement:function(){if(this.$el.parent()){var t=this.isHidden();this.hide();var e=this.$el.parent().width()||0;t?this.hide():this.show(),this.model.set("width",e)}},_onChangeLeftAxisTip:function(){this._updateAxisTip("left")},_onChangeRightAxisTip:function(){this._updateAxisTip("right")},_overlap:function(t,e){var i=t.node().getBoundingClientRect(),n=e.node().getBoundingClientRect();return!(i.right<n.left||i.left>n.right||i.bottom<n.top||i.top>n.bottom)},_updateTriangle:function(t,e,i){var n="right"===t?-1:1,a="right"===t?this.chartWidth():0,r=Math.abs(a-i),o=s.transform(e.attr("transform"));r<=7?(r="right"===t?14-r:r,e.attr("d",d(0,0,14,0,r,7*n,n)),o.translate[0]="left"===t?0:-Math.max(0,Math.abs(this.options.handleWidth-14))):(e.attr("d",d(0,0,14,0,7,7*n,n)),o.translate[0]=this.options.handleWidth/2-7),e.attr("transform",o.toString())},_updateAxisTip:function(t){var e=this.model.get(t+"_axis_tip");if(void 0!==e){var i=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+t),n=this.chart.select(".CDB-Chart-axisTip.CDB-Chart-axisTip-"+t),a=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+t),r=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+t),o=r.select(".CDB-Chart-axisTipTriangle");if(o.style("opacity","1"),i.data([e]).text(function(t){return this.formatter(t)}.bind(this)),i.node()){var l=i.node().getBBox(),h=l.width,d=h+6;a.attr("width",h+6),i.attr("dx",3),i.attr("dy",l.height-Math.abs((l.height-17)/2));var c=s.transform(r.attr("transform")).translate,u=+c[0]+this.options.handleWidth/2,g="left"===t?-26:this.chartHeight()+9.1;if(g=Math.floor(g),this._updateTriangle(t,o,u),u-h/2<0)n.attr("transform","translate("+-u+","+g+" )");else if(u+h/2+2>=this.chartWidth()){var p=this.chartWidth()-(u+d);p+=this.options.handleWidth,n.attr("transform","translate("+p+", "+g+")")}else n.attr("transform","translate(-"+(d/2-this.options.handleWidth/2)+", "+g+")")}}},_onChangeData:function(){this.model.previous("data").length!==this.model.get("data").length?this.reset():this.refresh(),this._setupFillColor(),this._refreshBarsColor()},_onChangeRange:function(){var t=this.model.get("lo_index"),e=this.model.get("hi_index");0===t&&0===e||null===t&&null===e||(this.selectRange(t,e),this._adjustBrushHandles(),this._selectBars(),this.trigger("on_brush_end",t,e))},_onChangeWidth:function(){var t=this.model.get("width");this.$el.width(t),this.chart.attr("width",t),this.options.showOnWidthChange&&t>0&&this.show(),this.reset();var e=this.model.get("lo_index"),i=this.model.get("hi_index");this.selectRange(e,i),this._updateAxisTip("left"),this._updateAxisTip("right")},_onChangeNormalized:function(){this.model.set("show_shadow_bars",!this.model.get("normalized")),this._generateShadowBars(),this.updateYScale(),this.refresh()},_onChangeHeight:function(){var t=this.model.get("height");this.$el.height(t),this.chart.attr("height",t),this.leftHandle.attr("height",t),this.rightHandle.attr("height",t),this.updateYScale(),this.reset()},_onChangShowLabels:function(){this._axis.style("opacity",this.model.get("showLabels")?1:0)},_onChangePos:function(){var t=this.model.get("pos"),e=this.model.get("margin"),i=+t.x,n=+t.y;this.chart.transition().duration(150).attr("transform","translate("+(e.left+i)+", "+(e.top+n)+")")},_onChangeDragging:function(){this.chart.classed("is-dragging",this.model.get("dragging")),this._updateAxisTipOpacity("right"),this._updateAxisTipOpacity("left")},_showAxisTip:function(t){var e=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+t),i=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+t),n=this.chart.select(".CDB-Chart-axisTip-"+t+" .CDB-Chart-axisTipTriangle");e&&e.transition().duration(200).attr("opacity",1),i&&i.transition().duration(200).attr("opacity",1),n&&n.transition().duration(200).attr("opacity",1)},_updateAxisTipOpacity:function(t){this.model.get("dragging")&&this._showAxisTip(t)},reset:function(){this._removeChartContent(),this._setupDimensions(),this._calcBarWidth(),this._generateChartContent(),this._generateShadowBars()},refresh:function(){this._setupDimensions(),this._removeAxis(),this._generateAxis(),this._updateChart(),this._refreshBarsColor(),this.chart.select(".CDB-Chart-handles").moveToFront(),this.chart.select(".Brush").moveToFront()},resetIndexes:function(){this.model.set({lo_index:null,hi_index:null})},removeShadowBars:function(){this.model.set("show_shadow_bars",!1)},_removeShadowBars:function(){this.chart.selectAll(".CDB-Chart-shadowBars").remove()},_removeBars:function(){this.chart.selectAll(".CDB-Chart-bars").remove()},_removeBrush:function(){this.chart.selectAll(".Brush").remove(),this.chart.classed("is-selectable",!1),this._axis.classed("is-disabled",!1)},_removeLines:function(){this.chart.select(".CDB-Chart-lines").remove(),this.chart.select(".CDB-Chart-line--bottom").remove()},_removeChartContent:function(){this._removeBrush(),this._removeHandles(),this._removeBars(),this._removeAxis(),this._removeLines()},_generateChartContent:function(){this._generateAxis(),this._generateLines(),this._generateBars(),this._generateHandles(),this._setupBrush(),this._generateBottomLine()},_generateLines:function(){this._generateHorizontalLines(),"time"!==this.options.type&&this._generateVerticalLines()},_generateVerticalLines:function(){this.chart.select(".CDB-Chart-lines").append("g").selectAll(".CDB-Chart-line").data(this.verticalRange.slice(1,this.verticalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("y1",0).attr("x1",function(t){return t}).attr("y2",this.chartHeight()).attr("x2",function(t){return t})},_generateHorizontalLines:function(){this.chart.append("g").attr("class","CDB-Chart-lines").append("g").attr("class","y").selectAll(".CDB-Chart-line").data(this.horizontalRange.slice(0,this.horizontalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("x1",0).attr("y1",function(t){return t}).attr("x2",this.chartWidth()).attr("y2",function(t){return t})},_generateBottomLine:function(){this.chart.append("line").attr("class","CDB-Chart-line CDB-Chart-line--bottom").attr("x1",0).attr("y1",this.chartHeight()-1).attr("x2",this.chartWidth()-1).attr("y2",this.chartHeight()-1)},_setupD3Bindings:function(){s.selection.prototype.moveToBack=function(){return this.each(function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)})},s.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})}},_setupModel:function(){this.model=new o.core.Model({bounded:!1,showLabels:!0,data:this.options.data,height:this.options.height,display:!0,show_shadow_bars:this.options.displayShadowBars,margin:a.clone(this.options.margin),width:0,pos:{x:0,y:0},normalized:this.options.normalized})},_setupBindings:function(){this.listenTo(this.model,"change:data",this._onChangeData),this.listenTo(this.model,"change:display",this._onChangeDisplay),this.listenTo(this.model,"change:dragging",this._onChangeDragging),this.listenTo(this.model,"change:height",this._onChangeHeight),this.listenTo(this.model,"change:left_axis_tip",this._onChangeLeftAxisTip),this.listenTo(this.model,"change:lo_index change:hi_index",this._onChangeRange),this.listenTo(this.model,"change:pos",this._onChangePos),this.listenTo(this.model,"change:right_axis_tip",this._onChangeRightAxisTip),this.listenTo(this.model,"change:showLabels",this._onChangShowLabels),this.listenTo(this.model,"change:show_shadow_bars",this._onChangeShowShadowBars),this.listenTo(this.model,"change:width",this._onChangeWidth),this.listenTo(this.model,"change:normalized",this._onChangeNormalized),this._widgetModel&&(this.listenTo(this._widgetModel,"change:autoStyle",this._refreshBarsColor),this.listenTo(this._widgetModel,"change:style",function(){this._setupFillColor(),this._refreshBarsColor()})),this._dataviewModel&&this.listenTo(this._dataviewModel.layer,"change:cartocss",function(){this._areGradientsAlreadyGenerated()||this._setupFillColor()}),this._originalData&&this.listenTo(this._originalData,"change:data",function(){this._removeShadowBars(),this._generateShadowBars()})},_setupDimensions:function(){this._setupScales(),this._setupRanges(),this._onWindowResize()},_getData:function(){return this._originalData&&this._originalData.getData()||this.model.get("data")},_getMaxData:function(t){return s.max(t,function(t){return a.isEmpty(t)?0:t.freq})},_getXScale:function(){return s.scale.linear().domain([0,100]).range([0,this.chartWidth()])},_getYScale:function(){var t=this.model.get("normalized")?this.model.get("data"):this._getData();return s.scale.linear().domain([0,this._getMaxData(t)]).range([this.chartHeight(),0])},updateXScale:function(){this.xScale=this._getXScale()},updateYScale:function(){this.yScale=this._getYScale()},resetYScale:function(){this.yScale=this._originalYScale},_getDataForScales:function(){return!this.model.get("bounded")&&this._originalData?this._originalData.getData():this.model.get("data")},_setupScales:function(){var t=this._getDataForScales();this.updateXScale(),this._originalYScale&&!this.model.get("normalized")||(this._originalYScale=this.yScale=this._getYScale()),t&&t.length&&("time"===this.options.type?this.xAxisScale=s.time.scale().domain([1e3*t[0].start,1e3*t[t.length-1].end]).range([0,this.chartWidth()]):this.xAxisScale=s.scale.linear().range([t[0].start,t[t.length-1].end]).domain([0,this.chartWidth()]))},_setupRanges:function(){var t=Math.round(this.chartWidth()/this.options.divisionWidth);this.verticalRange=s.range(0,this.chartWidth()+this.chartWidth()/t,this.chartWidth()/t),this.horizontalRange=s.range(0,this.chartHeight()+this.chartHeight()/2,this.chartHeight()/2)},_calcBarWidth:function(){this.barWidth=this.chartWidth()/this.model.get("data").length},_generateChart:function(){var t=this.model.get("margin");this.chart=s.select(this.el).selectAll(".CDB-WidgetCanvas").append("g").attr("class","CDB-Chart").attr("transform","translate("+t.left+", "+t.top+")"),this.chart.classed(this.options.className||"",!0)},_onChangeShowShadowBars:function(){this.model.get("show_shadow_bars")?this._generateShadowBars():this._removeShadowBars()},_onChangeDisplay:function(){this.model.get("display")?this._show():this._hide()},hide:function(){this.model.set("display",!1)},show:function(){this.model.set("display",!0)},_hide:function(){this.$el.hide()},_show:function(){this.$el.show()},isHidden:function(){return!this.model.get("display")},_selectBars:function(){this.chart.selectAll(".CDB-Chart-bar").classed({"is-selected":function(t,e){return this._isBarChartWithinFilter(e)}.bind(this),"is-filtered":function(t,e){return!this._isBarChartWithinFilter(e)}.bind(this)})},_isBarChartWithinFilter:function(t){var e=this.brush.extent(),i=e[0],n=e[1],a=Math.floor(t*this.barWidth),s=Math.floor(a+this.barWidth),r=Math.floor(this.xScale(i)),o=Math.floor(this.xScale(n));return a>r&&a<o||s>r&&s<o||a<=r&&s>=o},_isDragging:function(){return this.model.get("dragging")},setAnimated:function(){return this.model.set("animated",!0)},_isAnimated:function(){return this.model.get("animated")},_move:function(t){this.model.set({pos:t})},expand:function(t){this.canvas.attr("height",this.model.get("height")+t),this._move({x:0,y:t})},contract:function(t){this.canvas.attr("height",t),this._move({x:0,y:0})},resizeHeight:function(t){this.model.set("height",t)},setNormalized:function(t){return this.model.set("normalized",!!t),this},removeSelection:function(){this.resetIndexes(),this.chart.selectAll(".CDB-Chart-bar").classed({"is-selected":!1,"is-filtered":!1}),this._refreshBarsColor(),this._removeBrush(),this._setupBrush()},selectRange:function(t,e){if(t||e){var i=this._getBarPosition(t),n=this._getBarPosition(e);this.model.set({lo_index:t,hi_index:e}),this._selectRange(i,n)}},_selectRange:function(t,e){this.chart.select(".Brush").transition().duration(this.brush.empty()?0:150).call(this.brush.extent([t,e])).call(this.brush.event)},_getLoBarIndex:function(){var t=this.brush.extent();return Math.round(this.xScale(t[0])/this.barWidth)},_getHiBarIndex:function(){var t=this.brush.extent();return Math.round(this.xScale(t[1])/this.barWidth)},_getBarIndex:function(){var t=s.event.sourceEvent.layerX;return Math.floor(t/this.barWidth)},_getBarPosition:function(t){return t*(100/this.model.get("data").length)},_setupBrush:function(){var t=s.svg.brush().x(this.xScale).on("brush",this._onBrushMove).on("brushend",this._onBrushEnd),e=this.chart.append("g").attr("class","Brush").call(t);e.selectAll("rect").attr("y",0).attr("height",this.chartHeight()),e.selectAll("rect.background").on("mouseout",this._onMouseOut).on("mousemove",this._onMouseMove),this.brush=t,this.chart.selectAll("g.resize rect").attr("width",this.options.handleWidth).attr("x",-this.options.handleWidth/2)},_onBrushMove:function(){this.brush.empty()||(this.chart.classed("is-selectable",!0),this._axis.classed("is-disabled",!0),this.model.set({dragging:!0}),this._selectBars(),this._setupFillColor(),this._refreshBarsColor(),this._adjustBrushHandles())},_onBrushEnd:function(){var t,e,i=this.model.get("data"),n=this.brush,a=this._getLoBarIndex(),r=this._getHiBarIndex();if(this.model.set({dragging:!1}),n.empty()&&this._isAnimated())return void this.trigger("on_brush_click",n.extent()[0]/100);if(t=this._getBarPosition(a),e=this._getBarPosition(r),s.event.sourceEvent){if(a===r&&(r>=i.length?(a=i.length-1,r=i.length):r+=1),this.model.set({lo_index:a,hi_index:r}),s.event.sourceEvent&&void 0===t&&void 0===e){var o=this._getBarIndex();this.model.set({lo_index:o,hi_index:o+1})}this._setupFillColor(),this._refreshBarsColor()}},_onMouseOut:function(){this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this)),this.trigger("hover",{value:null})},_onMouseMove:function(){var t=s.event.offsetX,e=Math.floor(t/this.barWidth),i=this.model.get("data");if(void 0!==i[e]&&null!==i[e]){var n=i[e].freq,a={},r=this.chart.select(".CDB-Chart-bar:nth-child("+(e+1)+")");if(r&&r.node()&&!r.classed("is-selected")){var o=e*this.barWidth+this.barWidth/2,l=this.yScale(n),d=this.chartHeight()-this.yScale(n);d<this.options.minimumBarHeight&&d>0&&(l=this.chartHeight()-this.options.minimumBarHeight),a=!this._isDragging()&&n>0?{top:l,left:o,data:h.formatNumber(n)}:null}else a=null;this.trigger("hover",a),this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this)),r&&r.node()&&(r.attr("fill",function(){return this._getHoverFillColor(i[e],e)}.bind(this)),r.classed("is-highlighted",!0))}},_adjustBrushHandles:function(){var t=this.brush.extent(),e=t[0],i=t[1],n=this.xScale(e)-this.options.handleWidth/2,a=this.xScale(i)-this.options.handleWidth/2;this.chart.select(".CDB-Chart-handle-left").attr("transform","translate("+n+", 0)"),this.chart.select(".CDB-Chart-handle-right").attr("transform","translate("+a+", 0)"),this.options.hasAxisTip&&("time"===this.options.type?this.model.set({left_axis_tip:this.xAxisScale.invert(n+this.options.handleWidth/2),right_axis_tip:this.xAxisScale.invert(a+this.options.handleWidth/2)}):this.model.set({left_axis_tip:this.xAxisScale(n+this.options.handleWidth/2),right_axis_tip:this.xAxisScale(a+this.options.handleWidth/2)}))},_generateAxisTip:function(t){var e=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+t),i="right"===t?this.chartHeight()+9.1:-26,n="right"===t?this.chartHeight()+9.1+2:-11,a="right"===t?-1:1,s=7*a,r=e.selectAll("g").data([""]).enter().append("g").attr("class","CDB-Chart-axisTip CDB-Chart-axisTip-"+t).attr("transform","translate(0,"+i+")");e.append("path").attr("class","CDB-Chart-axisTipRect CDB-Chart-axisTipTriangle").attr("transform","translate("+(this.options.handleWidth/2-7)+", "+n+")").attr("d",d(0,0,14,0,7,s,a)).style("opacity","0"),r.append("rect").attr("class","CDB-Chart-axisTipRect CDB-Chart-axisTip-"+t).attr("rx","2").attr("ry","2").attr("height",17),r.append("text").attr("class","CDB-Text CDB-Size-small CDB-Chart-axisTipText CDB-Chart-axisTip-"+t).attr("dy","11").attr("dx","0").text(function(t){return t})},_generateHandle:function(t){var e={width:this.options.handleWidth,height:this.options.handleHeight,radius:this.options.handleRadius},i=this.chart.select(".CDB-Chart-handles").append("g").attr("class","CDB-Chart-handle CDB-Chart-handle-"+t);if(this.options.hasAxisTip&&this._generateAxisTip(t),this.options.hasHandles){i.append("rect").attr("class","CDB-Chart-handleRect").attr("width",e.width).attr("height",this.chartHeight()).attr("rx",e.radius).attr("ry",e.radius);var n=this.chartHeight()/2;n-=3;for(var a=(e.width-4)/2,s=0;s<3;s++)i.append("line").attr("class","CDB-Chart-handleGrip").attr("x1",a).attr("y1",n+3*s).attr("x2",a+4).attr("y2",n+3*s)}return i},_generateHandles:function(){this.chart.append("g").attr("class","CDB-Chart-handles"),this.leftHandle=this._generateHandle("left"),this.rightHandle=this._generateHandle("right")},_removeHandles:function(){this.chart.select(".CDB-Chart-handles").remove()},_removeAxis:function(){this.canvas.select(".CDB-Chart-axis").remove()},_generateAdjustAnchorMethod:function(t){return function(e,i){return 0===i?"start":i===t.length-1?"end":"middle"}},_generateAxis:function(){this._axis="time"===this.options.type?this._generateTimeAxis():this._generateNumericAxis(),this._onChangShowLabels()},_generateNumericAxis:function(){var t=this,e=this._generateAdjustAnchorMethod(this.verticalRange),i=this.chart.append("g").attr("class","CDB-Chart-axis CDB-Text CDB-Size-small");return i.append("g").selectAll(".Label").data(this.verticalRange).enter().append("text").attr("x",function(t){return t}).attr("y",function(){return t.chartHeight()+15}).attr("text-anchor",e).text(function(e){if(t.xAxisScale)return h.formatNumber(t.xAxisScale(e))}),i},_generateTimeAxis:function(){var t=this._generateAdjustAnchorMethod(this.xAxisScale.ticks()),e=s.svg.axis().orient("bottom").tickPadding(5).innerTickSize(-this.chartHeight()).scale(this.xAxisScale).orient("bottom"),i=this.canvas.append("g").attr("class","CDB-Chart-axis CDB-Text CDB-Size-small").attr("transform","translate(0,"+(this.chartHeight()+5)+")").call(e);return i.selectAll("text").style("text-anchor",t),i.moveToBack(),i},_getMinValueFromBinIndex:function(t){var e=this.model.get("data"),i=e[t];return i?null!=i.min?i.min:i.start:null},_getMaxValueFromBinIndex:function(t){var e=this.model.get("data"),i=e[t];return i?null!=i.min?i.max:i.end:null},_calculateDataDomain:function(){var t,e,i,n,s=a.clone(this.model.get("data"));if(this._hasFilterApplied()){var r=this._getLoBarIndex(),o=this._getHiBarIndex()-1,l=s.slice(r,o);if(a.isNaN(r)||a.isNaN(o))return[0,0];if(i=this._getMinValueFromBinIndex(r),n=this._getMaxValueFromBinIndex(o),s[r]&&0===s[r].freq&&(t=a.find(l,function(t){return 0!==t.freq},this)),s[o]&&0===s[o].freq){var h=l.reverse();e=a.find(h,function(t){return 0!==t.freq},this)}}else i=this._getMinValueFromBinIndex(0),n=this._getMaxValueFromBinIndex(s.length-1),t=a.find(s,function(t){return 0!==t.freq}),e=a.find(s.reverse(),function(t){return 0!==t.freq});return i=t?null!=t.min?t.min:t.start:i,n=e?null!=e.max?e.max:e.end:n,[i,n]},_removeFillGradients:function(){s.select(this.el).select("defs").remove(),delete this._linearGradients},_areGradientsAlreadyGenerated:function(){return!!this._linearGradients},_generateFillGradients:function(){if(!this._widgetModel||!this._widgetModel.isAutoStyleEnabled())return!1;var t=this._widgetModel.getAutoStyle();if(a.isEmpty(t)||a.isEmpty(t.definition))return!1;var e=this,i=t.definition[Object.keys(t.definition)[0]],n=i&&i.color.range,o=this.model.get("data"),l=r.interpolateRgbBasis(n),h=this._calculateDataDomain(),d=s.scale.linear().domain(h).range([0,1]),c=s.select(this.el).append("defs");this._linearGradients=c.selectAll("linearGradient").data(o).enter().append("linearGradient").attr("id",function(t,i){return this.__scale__=s.scale.linear().range([e._getMinValueFromBinIndex(i),e._getMaxValueFromBinIndex(i)]).domain([0,1]),"bar-"+e.cid+"-"+i}).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),this._linearGradients.selectAll("stop").data(s.range(5)).enter().append("stop").attr("offset",function(t,e){return(this.__offset__=Math.floor(e/4*100))+"%"}).attr("stop-color",function(){var t=this.parentNode.__scale__,e=d(t(this.__offset__/100));return l(e)})},_setupFillColor:function(){this._removeFillGradients(),this._generateFillGradients()},_getFillColor:function(t,e){return this._widgetModel?this._widgetModel.isAutoStyle()?this._hasFilterApplied()&&!this._isBarChartWithinFilter(e)?"rgba(0, 0, 0, 0.06)":"url(#bar-"+this.cid+"-"+e+")":this._hasFilterApplied()?this._isBarChartWithinFilter(e)?"#1181FB":"rgba(0, 0, 0, 0.06)":this._widgetModel.getWidgetColor()||this.options.chartBarColor:this.options.chartBarColor},_getHoverFillColor:function(t,e){var i=this._getFillColor(t,e);return this._widgetModel&&this._widgetModel.isAutoStyle()?i:l(i).darken(20).toString()},_updateChart:function(){var t=this,e=this.model.get("data"),i=this.chart.selectAll(".CDB-Chart-bar").data(e);i.enter().append("rect").attr("class","CDB-Chart-bar").attr("fill",this._getFillColor.bind(this)).attr("transform",function(e,i){return"translate("+i*t.barWidth+", 0 )"}).attr("y",t.chartHeight()).attr("height",0).attr("width",Math.max(0,this.barWidth-1)),i.transition().duration(200).attr("height",function(e){if(a.isEmpty(e))return 0;var i=t.chartHeight()-t.yScale(e.freq);return i<t.options.minimumBarHeight&&i>0&&(i=t.options.minimumBarHeight),i}).attr("y",function(e){if(a.isEmpty(e))return t.chartHeight();var i=t.chartHeight()-t.yScale(e.freq);return i<t.options.minimumBarHeight&&i>0?t.chartHeight()-t.options.minimumBarHeight:t.yScale(e.freq)}),i.exit().transition().duration(200).attr("height",function(){return 0}).attr("y",function(){return t.chartHeight()})},_refreshBarsColor:function(){this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this))},_generateBars:function(){var t=this,e=this.model.get("data");this._calcBarWidth();var i=2*e.length-1>this.chartWidth()?0:1,n=this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-bars").selectAll(".CDB-Chart-bar").data(e);n.enter().append("rect").attr("class","CDB-Chart-bar").attr("fill",this._getFillColor.bind(t)).attr("transform",function(e,i){return"translate("+i*t.barWidth+", 0 )"}).attr("y",t.chartHeight()).attr("height",0).attr("width",Math.max(1,this.barWidth-i)),n.transition().ease(this.options.transitionType).duration(this.options.animationSpeed).delay(this.options.animationBarDelay).transition().attr("height",function(e){if(a.isEmpty(e))return 0;var i=t.chartHeight()-t.yScale(e.freq);return i<t.options.minimumBarHeight&&i>0&&(i=t.options.minimumBarHeight),i}).attr("y",function(e){if(a.isEmpty(e))return t.chartHeight();var i=t.chartHeight()-t.yScale(e.freq);return i<t.options.minimumBarHeight&&i>0?t.chartHeight()-t.options.minimumBarHeight:t.yScale(e.freq)})},showShadowBars:function(){this.options.displayShadowBars&&this.model.set("show_shadow_bars",!0)},_generateShadowBars:function(){var t=this._getData();if(!t||!t.length||!this.model.get("show_shadow_bars")||this.model.get("normalized"))return void this._removeShadowBars();this._removeShadowBars();var e=this,i=s.scale.linear().domain([0,this._getMaxData(t)]).range([this.chartHeight(),0]),n=this.chartWidth()/t.length;this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-shadowBars").selectAll(".CDB-Chart-shadowBar").data(t).enter().append("rect").attr("class","CDB-Chart-shadowBar").attr("transform",function(t,e){return"translate("+e*n+", 0 )"}).attr("y",function(t){if(a.isEmpty(t))return e.chartHeight();var n=e.chartHeight()-i(t.freq);return n<e.options.minimumBarHeight&&n>0?e.chartHeight()-e.options.minimumBarHeight:i(t.freq)}).attr("width",Math.max(.5,n-1)).attr("height",function(t){if(a.isEmpty(t))return 0;var n=e.chartHeight()-i(t.freq);return n<e.options.minimumBarHeight&&n>0&&(n=e.options.minimumBarHeight),n}),this.chart.selectAll(".CDB-Chart-shadowBars").moveToBack(),this.chart.selectAll(".CDB-Chart-lines").moveToBack()},_hasFilterApplied:function(){return null!=this.model.get("lo_index")&&null!=this.model.get("hi_index")},unsetBounds:function(){this.model.set("bounded",!1),this.updateYScale(),this.contract(this.options.height),this.resetIndexes(),this.removeSelection(),this._setupFillColor()},setBounds:function(){this.model.set("bounded",!0),this.updateYScale(),this.expand(4),this.removeShadowBars()},clean:function(){n(window).unbind("resize",this._onWindowResize),o.core.View.prototype.clean.call(this)}})},252:function(t,e,i){var n=i(3),a=i(5),s=i(251);t.exports=a.core.View.extend({defaults:{mobileThreshold:960,histogramChartHeight:72,histogramChartMobileHeight:24},initialize:function(){this._timeSeriesModel=this.options.timeSeriesModel,this._rangeFilter=this.options.rangeFilter,this._originalData=this.model.getUnfilteredDataModel(),this._chartType="time",this._initBinds()},render:function(){return this.clearSubViews(),this._createHistogramView(),this},selectRange:function(t,e){this._chartView.selectRange(t,e)},resetFilter:function(){this._rangeFilter.unsetRange(),this._chartView.removeSelection(),this._timeSeriesModel.set({lo_index:null,hi_index:null})},_initBinds:function(){this.model.bind("change:data",this._onChangeData,this),this.listenTo(this._timeSeriesModel,"change:normalized",this._onNormalizedChanged)},_createHistogramView:function(){this._chartView=this._instantiateChartView(),this.addView(this._chartView),this.$el.append(this._chartView.render().el),this._chartView.show(),this._chartView.bind("on_brush_end",this._onBrushEnd,this),this._chartView.model.bind("change:width",this._onChangeChartWidth,this),this.add_related_model(this._chartView.model)},_instantiateChartView:function(){return new s({type:this._chartType,chartBarColor:this._timeSeriesModel.getWidgetColor()||"#F2CC8F",animationSpeed:100,margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,handleWidth:10,hasAxisTip:!0,animationBarDelay:function(t,e){return 3*e},height:this.defaults.histogramChartHeight,data:this.model.getData(),originalData:this._originalData,displayShadowBars:!this._timeSeriesModel.get("normalized"),normalized:!!this._timeSeriesModel.get("normalized"),widgetModel:this._timeSeriesModel})},_onChangeData:function(){this._chartView&&(this._chartView.replaceData(this.model.getData()),this._chartView.updateXScale(),this._chartView.updateYScale())},_onBrushEnd:function(t,e){var i=this.model.getData();this._rangeFilter.setRange(i[t].start,i[e-1].end),this._timeSeriesModel.set({lo_index:t,hi_index:e})},_onChangeChartWidth:function(){var t=n(window).width()<this.defaults.mobileThreshold;this._chartView.toggleLabels(!t);var e=t?this.defaults.histogramChartMobileHeight:this.defaults.histogramChartHeight;this._chartView.model.set("height",e)},_onNormalizedChanged:function(){this._chartView&&this._chartView.setNormalized(this._timeSeriesModel.get("normalized"))}})},253:function(t,e,i){var n=i(5),a=i(801),s=i(22),r=i(71),o=i(799);t.exports=n.core.View.extend({className:"CDB-Widget-contentSpaced",events:{"click .js-clear":"_onClick"},options:{showClearButton:!0},initialize:function(t){if(!t.dataviewModel)throw new Error("dataviewModel is required");if(!t.rangeFilter)throw new Error("rangeFilter is required");if(!t.timeSeriesModel)throw new Error("timeSeriesModel is required");if(void 0===t.selectedAmount)throw new Error("selectedAmount is required");this._timeSeriesModel=t.timeSeriesModel,this._dataviewModel=t.dataviewModel,this._rangeFilter=t.rangeFilter,this._selectedAmount=t.selectedAmount,this._layer=this._dataviewModel.layer,this._initBinds()},render:function(){var t=this._timeSeriesModel.get("title"),e=this._rangeFilter,i=!e.isEmpty();return this.$el.html(a({start:void 0,end:void 0,title:t,showClearButton:this.options.showClearButton&&i,showSelection:i})),this._animateValue(),this},_animateValue:function(){var t=new r({el:this.$el}),e=this._rangeFilter.isEmpty()?"totalAmount":"filteredAmount",i=this._dataviewModel.get(e);t.animateFromValues.call(this,this._selectedAmount,i,".js-val",o,{formatter:s.formatNumber,templateData:{suffix:" Selected"}}),this._selectedAmount=i},_initBinds:function(){this.listenTo(this._timeSeriesModel,"change:title",this.render),this.listenTo(this._dataviewModel,"change:totalAmount",this._animateValue),this.listenTo(this._rangeFilter,"change",this.render)},_onClick:function(){this.trigger("resetFilter",this)}})},254:function(t,e,i){var n=i(5),a=i(0);t.exports=n.core.View.extend({className:"CDB-Widget-tooltip CDB-Widget-tooltip--light CDB-Text CDB-Size-small",options:{attribute:"data-tooltip",offsetX:10,offsetY:-28},initialize:function(t){if(!t.target)throw new Error("target is not defined");this._$target=this.options.target,this._initBinds()},render:function(){var t=this._$target.attr(this.options.attribute);return this.$el.html(t),this},_initBinds:function(){this._$target.hover(a.bind(this.show,this),a.bind(this.hide,this))},_setPosition:function(){var t=this._$target.offset(),e=this.$el.outerWidth();this.$el.css({top:t.top+this.options.offsetY,left:t.left-e/2+this.options.offsetX})},show:function(){this.render(),this._setPosition(),n.core.View.prototype.show.call(this)},clean:function(){this._$target.off("mouseenter mouseleave"),n.core.View.prototype.clean.call(this)}})},255:function(t,e,i){var n=i(0),a=i(578),s=function(t){this.defs=[],n.each(t,function(t){this.addType(t)},this)};s.prototype.DEFAULT_CLASS_NAMES="CDB-Widget CDB-Widget--light",s.prototype.addType=function(t){if(!t.match){if(!t.type)throw new Error("def.type or def.match must be provided for createContentView to work");t.match=function(t){return t.get("type")===this.type}}if(!n.isFunction(t.createContentView))throw new Error("def.createContentView must be a function");this.defs.push(t)},s.prototype.createWidgetView=function(t){var e=n.find(this.defs,function(e){return e.match(t)});if(e){var i={className:this.DEFAULT_CLASS_NAMES,model:t,contentView:e.createContentView(t)};return new a(n.isFunction(e.customizeWidgetAttrs)?e.customizeWidgetAttrs(i):i)}},t.exports=s},256:function(t,e,i){"use strict";i.d(e,"b",function(){return n}),i.d(e,"a",function(){return a});var n=Math.PI/180,a=180/Math.PI},257:function(t,e,i){"use strict";var n=i(107);e.a=function(t,e){var a,s=e?e.length:0,r=t?Math.min(s,t.length):0,o=new Array(s),l=new Array(s);for(a=0;a<r;++a)o[a]=i.i(n.a)(t[a],e[a]);for(;a<s;++a)l[a]=e[a];return function(t){for(a=0;a<r;++a)l[a]=o[a](t);return l}}},258:function(t,e,i){"use strict";var n=i(106);e.a=function(t){var e=t.length;return function(a){var s=Math.floor(((a%=1)<0?++a:a)*e),r=t[(s+e-1)%e],o=t[s%e],l=t[(s+1)%e],h=t[(s+2)%e];return i.i(n.b)((a-s/e)*e,r,o,l,h)}}},259:function(t,e,i){"use strict";e.a=function(t){return function(){return t}}},260:function(t,e,i){"use strict";e.a=function(t,e){var i=new Date;return t=+t,e-=t,function(n){return i.setTime(t+e*n),i}}},261:function(t,e,i){"use strict";var n=i(107);e.a=function(t,e){var a,s={},r={};null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={});for(a in e)a in t?s[a]=i.i(n.a)(t[a],e[a]):r[a]=e[a];return function(t){for(a in s)r[a]=s[a](t);return r}}},262:function(t,e,i){"use strict";function n(t){return function(e){var n,s,r=e.length,o=new Array(r),l=new Array(r),h=new Array(r);for(n=0;n<r;++n)s=i.i(a.e)(e[n]),o[n]=s.r||0,l[n]=s.g||0,h[n]=s.b||0;return o=t(o),l=t(l),h=t(h),s.opacity=1,function(t){return s.r=o(t),s.g=l(t),s.b=h(t),s+""}}}var a=i(37),s=i(106),r=i(258),o=i(49);i.d(e,"b",function(){return l}),i.d(e,"c",function(){return h}),e.a=function t(e){function n(t,e){var n=s((t=i.i(a.e)(t)).r,(e=i.i(a.e)(e)).r),r=s(t.g,e.g),o=s(t.b,e.b),l=s(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=r(e),t.b=o(e),t.opacity=l(e),t+""}}var s=i.i(o.c)(e);return n.gamma=t,n}(1);var l=n(s.a),h=n(r.a)},263:function(t,e,i){"use strict";function n(t){return function(){return t}}function a(t){return function(e){return t(e)+""}}var s=i(73),r=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,o=new RegExp(r.source,"g");e.a=function(t,e){var l,h,d,c=r.lastIndex=o.lastIndex=0,u=-1,g=[],p=[];for(t+="",e+="";(l=r.exec(t))&&(h=o.exec(e));)(d=h.index)>c&&(d=e.slice(c,d),g[u]?g[u]+=d:g[++u]=d),(l=l[0])===(h=h[0])?g[u]?g[u]+=h:g[++u]=h:(g[++u]=null,p.push({i:u,x:i.i(s.a)(l,h)})),c=o.lastIndex;return c<e.length&&(d=e.slice(c),g[u]?g[u]+=d:g[++u]=d),g.length<2?p[0]?a(p[0].x):n(e):(e=p.length,function(t){for(var i,n=0;n<e;++n)g[(i=p[n]).i]=i.x(t);return g.join("")})}},264:function(t,e,i){"use strict";var n=i(595),a=i(607),s="function"==typeof Symbol&&"symbol"==typeof Symbol(),r=Object.prototype.toString,o=function(t){return"function"==typeof t&&"[object Function]"===r.call(t)},l=Object.defineProperty&&function(){var t={};try{Object.defineProperty(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(t){return!1}}(),h=function(t,e,i,n){(!(e in t)||o(n)&&n())&&(l?Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:i,writable:!0}):t[e]=i)},d=function(t,e){var i=arguments.length>2?arguments[2]:{},r=n(e);s&&(r=r.concat(Object.getOwnPropertySymbols(e))),a(r,function(n){h(t,n,e[n],i[n])})};d.supportsDescriptors=!!l,t.exports=d},265:function(t,e,i){"use strict";var n=Function.prototype.toString,a=/^\s*class /,s=function(t){try{var e=n.call(t),i=e.replace(/\/\/.*\n/g,""),s=i.replace(/\/\*[.\s\S]*\*\//g,""),r=s.replace(/\n/gm," ").replace(/ {2}/g," ");return a.test(r)}catch(t){return!1}},r=function(t){try{return!s(t)&&(n.call(t),!0)}catch(t){return!1}},o=Object.prototype.toString,l="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;t.exports=function(t){if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(l)return r(t);if(s(t))return!1;var e=o.call(t);return"[object Function]"===e||"[object GeneratorFunction]"===e}},270:function(t,e,i){"use strict";var n=i(108),a=i(599),s=n.call(Function.call,String.prototype.replace),r=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,o=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;t.exports=function(){var t=a.ToString(a.CheckObjectCoercible(this));return s(s(t,r,""),o,"")}},271:function(t,e,i){"use strict";var n=i(270),a="";t.exports=function(){return String.prototype.trim&&a.trim()===a?String.prototype.trim:n}},277:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="CDB-Widget-header CDB-Widget-header--timeSeries">\n  ',hasTorqueLayer&&(__p+='\n    <div class="CDB-Widget-timeSeriesFakeControl"></div>\n    <div class="CDB-Widget-timeSeriesTimeInfo CDB-Widget-timeSeriesTimeInfo--fake"></div>\n  '),__p+='\n</div>\n<div class="CDB-Widget-content CDB-Widget-content--timeSeries">\n  <div class="CDB-Widget-timeSeriesFakeChart ',hasTorqueLayer&&(__p+="CDB-Widget-timeSeriesFakeChart--torque"),__p+='">\n    ';for(var i=0;i<50;i++)__p+='\n      <div class="CDB-Widget-timeSeriesFakeChartItem" style="height: '+__e(Math.floor(100*Math.random()))+'%"></div>\n    ';__p+="\n  </div>\n</div>\n"}return __p}},290:function(t,e,i){t.exports={VERSION:i(535).version,createDashboard:i(536)}},37:function(t,e,i){"use strict";var n=i(104);i.d(e,"f",function(){return n.h}),i.d(e,"e",function(){return n.g}),i.d(e,"d",function(){return n.f});var a=i(583);i.d(e,"c",function(){return a.b}),i.d(e,"b",function(){return a.a});var s=i(582);i.d(e,"a",function(){return s.a})},48:function(t,e,i){var n=i(3),a=i(0),s=i(5),r=i(789);t.exports=s.core.View.extend({className:"CDB-Dropdown",events:{"click .js-toggleNormalized":"_toggleNormalized","click .js-toggleCollapsed":"_toggleCollapsed","click .js-removeWidget":"_removeWidget","click .js-editWidget":"_editWidget"},initialize:function(t){if(!t.target)throw new Error("target is not defined");this._target=this.options.target,this._$container=this.options.container,this._initBinds()},render:function(){var t=a.defaults(this.options.flags||{},{canCollapse:!0}),e=a.defaults({},this.model.attributes,{flags:t},{normalized:!1,collapsed:!1,show_options:!1});return this.$el.html(r(e)),this},_initBinds:function(){this.add_related_model(this.model),this.model.bind("change:widget_dropdown_open",this._onChangeOpen,this),this._$container.delegate(this._target,"click",a.bind(this._toggleClick,this))},_removeWidget:function(){this.model.trigger("removeWidget",this.model)},_editWidget:function(){this.model.trigger("editWidget",this.model)},_bindGlobalClick:function(){n(document).bind("click."+this.cid,a.bind(this._onGlobalClick,this))},_unbindGlobalClick:function(){n(document).unbind("click."+this.cid)},_bindESC:function(){n(document).bind("keyup."+this.cid,a.bind(this._onKeyUp,this))},_unbindESC:function(){n(document).unbind("keyup."+this.cid)},_onGlobalClick:function(t){var e=this._$container.find(this._target);e.get(0)!==n(t.target).closest(e).get(0)&&this.model.set("widget_dropdown_open",!1)},_onKeyUp:function(t){if(27===t.keyCode)return this.model.set("widget_dropdown_open",!1),!1},_onChangeOpen:function(){this.model.get("widget_dropdown_open")?this._open():this._close()},_toggleCollapsed:function(){var t=!this.model.get("collapsed");this.model.set("collapsed",t)},_toggleNormalized:function(){var t=!this.model.get("normalized");this.model.set("normalized",t)},_open:function(){this._bindESC(),this._bindGlobalClick(),this.render(),this._$container.append(this.$el),this.$el.show(),this._adjustVerticalPosition()},_adjustVerticalPosition:function(){this._getDropdownBottom()>this._getBodyHeight()&&this.$el.addClass("has-top-position")},_getDropdownBottom:function(){return this.$el.offset().top+this.$el.height()},_getBodyHeight:function(){return n("body").height()},_close:function(){this._unbindESC(),this._unbindGlobalClick(),this.$el.hide(),this.$el.removeClass("has-top-position")},_toggleClick:function(){this.model.set("widget_dropdown_open",!this.model.get("widget_dropdown_open"))},clean:function(){this.model.set("widget_dropdown_open",!1),this._unbindESC(),this._unbindGlobalClick(),this._$container.undelegate(this._target,"click"),s.core.View.prototype.clean.call(this)}})},49:function(t,e,i){"use strict";function n(t,e){return function(i){return t+i*e}}function a(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function s(t,e){var a=e-t;return a?n(t,a>180||a<-180?a-360*Math.round(a/360):a):i.i(l.a)(isNaN(t)?e:t)}function r(t){return 1==(t=+t)?o:function(e,n){return n-e?a(e,n,t):i.i(l.a)(isNaN(e)?n:e)}}function o(t,e){var a=e-t;return a?n(t,a):i.i(l.a)(isNaN(t)?e:t)}var l=i(259);e.b=s,e.c=r,e.a=o},534:function(t,e,i){"use strict";function n(t){var e={};return l(t,function(t,i){l(t,function(t){e[t]=i})}),e}function a(t){var e=n(m);return e[t]||e[p.call(t,/-/,1)[0]]||e.en}function s(t,e){return f[a(t)](e)}function r(t,e,i){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var n=t,a="number"==typeof e?{smart_count:e}:e;if(null!=a.smart_count&&n){var r=p.call(n,_);n=c(r[s(i||"en",a.smart_count)]||r[0])}return n=g.call(n,w,function(t,e){return d(a,e)&&null!=a[e]?g.call(a[e],v,b):t})}function o(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?r:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||u}var l=i(606),h=i(814),d=i(611),c=i(650),u=function(t){h(!1,t)},g=String.prototype.replace,p=String.prototype.split,_="||||",f={arabic:function(t){return t<3?t:t%100>=3&&t%100<=10?3:t%100>=11?4:5},chinese:function(){return 0},german:function(t){return 1!==t?1:0},french:function(t){return t>1?1:0},russian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){return 1===t?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0}},m={arabic:["ar"],chinese:["fa","id","ja","ko","lo","ms","th","tr","zh"],german:["da","de","en","es","fi","el","he","hu","it","nl","no","pt","sv"],french:["fr","tl","pt-br"],russian:["hr","ru","lt"],czech:["cs","sk"],polish:["pl"],icelandic:["is"]},v=/\$/g,b="$$",w=/%\{(.*?)\}/g;o.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},o.prototype.extend=function(t,e){l(t,function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t},this)},o.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:l(t,function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]},this)},o.prototype.clear=function(){this.phrases={}},o.prototype.replace=function(t){this.clear(),this.extend(t)},o.prototype.t=function(t,e){var i,n,a=null==e?{}:e;if("string"==typeof this.phrases[t])i=this.phrases[t];else if("string"==typeof a._)i=a._;else if(this.onMissingKey){var s=this.onMissingKey;n=s(t,a,this.currentLocale)}else this.warn('Missing translation for key: "'+t+'"'),n=t;return"string"==typeof i&&(n=r(i,a,this.currentLocale)),n},o.prototype.has=function(t){return d(this.phrases,t)},o.transformPhrase=r,t.exports=o},535:function(t,e){t.exports={_args:[[{raw:"cartodb-deep-insights.js@git://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",scope:null,escapedName:"cartodb-deep-insights.js",name:"cartodb-deep-insights.js",rawSpec:"git://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",spec:"git://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",type:"hosted",hosted:{type:"github",ssh:"git@github.com:cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",sshUrl:"git+ssh://git@github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",httpsUrl:"git+https://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",gitUrl:"git://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",shortcut:"github:cartodb/deep-insights.js#61eaa3b8875d3d8440b11221cf8609c371721fc2",directUrl:"https://raw.githubusercontent.com/cartodb/deep-insights.js/61eaa3b8875d3d8440b11221cf8609c371721fc2/package.json"}},"/home/ubuntu/www/production.cartodb.com/releases/20170713102957"]],_from:"cartodb/deep-insights.js#master",_id:"cartodb-deep-insights.js@0.0.2",_inCache:!0,_location:"/cartodb-deep-insights.js",_phantomChildren:{"for-each":"0.3.2",has:"1.0.1","string.prototype.trim":"1.1.2",warning:"3.0.0"},_requested:{raw:"cartodb-deep-insights.js@git://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",scope:null,escapedName:"cartodb-deep-insights.js",name:"cartodb-deep-insights.js",rawSpec:"git://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",spec:"git://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",type:"hosted",hosted:{type:"github",ssh:"git@github.com:cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",sshUrl:"git+ssh://git@github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",httpsUrl:"git+https://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",gitUrl:"git://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",shortcut:"github:cartodb/deep-insights.js#61eaa3b8875d3d8440b11221cf8609c371721fc2",directUrl:"https://raw.githubusercontent.com/cartodb/deep-insights.js/61eaa3b8875d3d8440b11221cf8609c371721fc2/package.json"}},_requiredBy:["/"],_resolved:"git://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",_shasum:"2e868be38e6bc9e437ea17dd2684c5438d432aba",_shrinkwrap:null,_spec:"cartodb-deep-insights.js@git://github.com/cartodb/deep-insights.js.git#61eaa3b8875d3d8440b11221cf8609c371721fc2",_where:"/home/ubuntu/www/production.cartodb.com/releases/20170713102957",author:{name:"CARTO",email:"wadus@carto.com",url:"http://carto.com/"},browserify:{transform:["jstify"]},bugs:{url:"https://github.com/CartoDB/deep-insights.js/issues"},contributors:[{name:"Javier lvarez",email:"jmedina@cartodb.com"},{name:"Javier Arce",email:"javierarce@cartodb.com"},{name:"Javier Santana",email:"jsantana@cartodb.com"},{name:"Raul Ochoa",email:"rochoa@cartodb.com"},{name:"Nicklas Gummesson",email:"nicklas@cartodb.com"},{name:"Pablo Alonso",email:"pablo@cartodb.com"},{name:"Antonio Santiago Prez",email:"asantiago@cartodb.com"},{name:"Carlos Matalln",email:"matallo@carto.com"}],dependencies:{backbone:"1.2.3",cartocolor:"4.0.0","cartodb.js":"github:cartodb/cartodb.js#v4",d3:"3.5.17","d3-interpolate":"1.1.2",jquery:"2.1.4",moment:"2.10.6","node-polyglot":"^2.2.2","perfect-scrollbar":"git://github.com/CartoDB/perfect-scrollbar.git#master",postcss:"5.0.19",tinycolor2:"1.4.1",underscore:"1.8.3",urijs:"1.17.1"},description:"CARTO Deep Insights JS library",devDependencies:{"babel-preset-es2015":"~6.24.1",babelify:"~7.3.0",browserify:"13.0.0","browserify-resolutions":"1.1.0",cartoassets:"github:cartodb/CartoAssets#master",grunt:"0.4.5","grunt-aws":"^0.4.0","grunt-browserify":"5.0.0","grunt-contrib-clean":"0.7.0","grunt-contrib-concat":"0.5.1","grunt-contrib-connect":"0.11.2","grunt-contrib-copy":"0.8.2","grunt-contrib-cssmin":"0.14.0","grunt-contrib-imagemin":"1.0.0","grunt-contrib-jasmine":"0.9.2","grunt-contrib-uglify":"0.11.0","grunt-contrib-watch":"0.6.1","grunt-exorcise":"2.1.0","grunt-fastly":"~0.1.3","grunt-gh-pages":"1.0.0","grunt-sass":"2.0.0",jstify:"0.12.0","load-grunt-tasks":"3.3.0",semistandard:"7.0.4","source-map-support":"0.4.0","time-grunt":"1.2.2",watchify:"3.6.1"},gitHead:"61eaa3b8875d3d8440b11221cf8609c371721fc2",homepage:"https://github.com/CartoDB/deep-insights.js#readme",license:"BSD-3-Clause",main:"src/index.js",name:"cartodb-deep-insights.js",optionalDependencies:{},readme:"Deep-Insights.js [![Build Status](http://travis-ci.org/CartoDB/deep-insights.js.png?branch=master)](http://travis-ci.org/CartoDB/deep-insights.js)\n====================\n\n## Intro\n\nDepth Insights.js allows to create powerful dashboards using CartoDB\n\n## Quickstart\n\nPlease, read the [quickstart](doc/quickstart.md) and the [API](doc/api.md)\n\n\n## Develop\n\n`npm install` and then `grunt dev` to build dev dist files\n\nAfter the last step [http://localhost:9002/](http://localhost:9002/) should open in a browser, where you can run tests, see styleguide and examples etc.\n\n## release\n\n1. be sure you have the right secrets.json\n1. Modify the package.json version\n1. execute `grunt release`\n",readmeFilename:"README.md",repository:{type:"git",url:"git://github.com/CartoDB/deep-insights.js.git"},semistandard:{globals:["alert","cartodb","cdb","jasmine","describe","xdescribe","beforeEach","afterEach","spyOn","it","xit","expect"],ignore:["/*.js","/dist","/examples","/grunt-tasks","/styleguide","/themes","/vendor"]},version:"0.0.2"}},536:function(t,e,i){var n=i(0),a=i(5),s=i(537),r=i(541),o=i(579),l=i(544),h=i(117),d=function(t,e,i,s){var d=document.querySelector(t);if(!d)throw new Error("no element found with selector "+t);i=i||{},i.renderMenu=!n.isBoolean(i.renderMenu)||i.renderMenu,i.autoStyle=!!n.isBoolean(i.autoStyle)&&i.autoStyle;var c=new o,u=new a.core.Model({title:e.title,description:e.description,updatedAt:e.updated_at,userName:e.user.fullname,userProfileURL:e.user.profile_url,userAvatarURL:e.user.avatar_url,renderMenu:i.renderMenu,autoStyle:i.autoStyle,showLogo:i.cartodb_logo,initialPosition:{bounds:e.bounds}}),g=new r({el:d,widgets:c,model:u}),p=i.state||h.getStateFromCurrentURL();p&&!n.isEmpty(p.map)&&(n.isArray(p.map.center)&&(e.center=p.map.center),n.isNumber(p.map.zoom)&&(e.zoom=p.map.zoom),p.map.ne&&p.map.sw&&(e.bounds=[p.map.ne,p.map.sw])),a.createVis(g.$("#map"),e,n.extend(i,{skipMapInstantiation:!0})).once("load",function(t){var i=p&&p.widgets||{},r=new l(c,t.dataviews),o={list:r.createListModel.bind(r),formula:r.createFormulaModel.bind(r),histogram:r.createHistogramModel.bind(r),"time-series":r.createTimeSeriesModel.bind(r),category:r.createCategoryModel.bind(r)};e.widgets.forEach(function(e){var s=n.extend({},e,e.options),r=o[e.type],l=i[e.id];if(n.isFunction(r)){var h;e.layer_id?h=t.map.layers.get(e.layer_id):Number.isInteger(e.layerIndex)&&(h=t.map.layers.at(e.layerIndex)),r(s,h,l)}else a.log.error("No widget found for type "+e.type)}),g.render();var h={dashboardView:g,widgets:r,areWidgetsInitialised:function(){var t=r.getCollection();return!(t.size()>0)||t.hasInitialState()},vis:t};t.instantiateMap({success:function(){s&&s(null,h)},error:function(t){s&&s(new Error(t),h)}})})};t.exports=function(t,e,i,r){function o(e){d(t,e,i,function(t,e){var a=new s(e);i.share_urls&&a.onStateChanged(n.debounce(function(t,e){window.history.replaceState("Object","Title",e)},500)),r&&r(t,a)})}var l=arguments,h=l[l.length-1];n.isFunction(h)&&(r=h),"string"==typeof e?a.core.Loader.get(e,function(t){t?o(t):r&&r(new Error("Error fetching viz.json file: "+e))}):o(e)}},537:function(t,e,i){function n(t){this._dashboard=t,this.onDataviewsFetched(function(){t.widgets._widgetsCollection.initialState(),t.widgets._widgetsCollection.each(function(t){t&&t.applyInitialState&&t.applyInitialState()})})}var a=i(117),s=i(0);n.prototype={getView:function(){return this._dashboard.dashboardView},getMap:function(){return this._dashboard.vis},reloadMap:function(){this.getMap().reload()},getWidgets:function(){return this._dashboard.widgets.getList()},getDashboardURL:function(){return a.getURLFromState(this.getState())},getState:function(){var t={},e=this.getMapState();s.isEmpty(e)||(t.map=e);var i=this._dashboard.widgets.getCollection(),n=i.getStates();return s.isEmpty(n)||(t.widgets=n),t},getMapState:function(){var t=this._dashboard.vis.map,e=t.getViewBounds(),i=t.get("center"),n=t.get("zoom");return{ne:e[0],sw:e[1],center:i,zoom:n}},setState:function(t){this._dashboard.widgets.setWidgetsState(t.widgets),this._dashboard.vis.mapvis.map.setBounds([t.map.ne,t.map.sw])},onDataviewsFetched:function(t){this._dashboard.areWidgetsInitialised()?t&&t():this._dashboard.vis.once("dataviewsFetched",function(){t&&t()})},onStateChanged:function(t){this.onDataviewsFetched(function(){t&&this._bindChange(t)}.bind(this))},_bindChange:function(t){this._dashboard.widgets.getCollection().bind("change",function(){t(this.getState(),this.getDashboardURL())},this),this._dashboard.vis.map.bind("change",function(){t(this.getState(),this.getDashboardURL())},this)},getWidget:function(t){return this._dashboard.widgets.get(t)},createCategoryWidget:function(t,e){return this._dashboard.widgets.createCategoryModel(t,e,null)},createHistogramWidget:function(t,e){return this._dashboard.widgets.createHistogramModel(t,e,null)},createFormulaWidget:function(t,e){return this._dashboard.widgets.createFormulaModel(t,e,null)},createTimeSeriesWidget:function(t,e){return this._dashboard.widgets.createTimeSeriesModel(t,e,null)}},t.exports=n},538:function(t,e,i){var n=i(0),a=i(5),s=i(255),r=i(568),o=i(570);t.exports=a.core.View.extend({className:"CDB-Dashboard-belowMap",initialize:function(t){this._widgetViewFactory=new s([{match:function(t){if("time-series"===t.get("type")){var e=t.dataviewModel;return e&&"torque"===e.layer.get("type")}return!1},createContentView:function(t){return new o({model:t})},customizeWidgetAttrs:function(t){return t.className+=" CDB-Widget--timeSeries",t}},{type:"time-series",createContentView:function(t){return new r({model:t})},customizeWidgetAttrs:function(t){return t.className+=" CDB-Widget--timeSeries",t}}]),this._widgets=t.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("add reset remove",this._onWidgetsChange,this),this.add_related_model(this._widgets)},render:function(){return this.clearSubViews(),this.$el.empty(),this._widgets.each(this._maybeRenderWidgetView,this),this._toggleVisiblity(),this},_maybeRenderWidgetView:function(t){var e=this._widgetViewFactory.createWidgetView(t);e&&(this.addView(e),this.$el.append(e.render().el))},_toggleVisiblity:function(){this.$el.toggle(!n.isEmpty(this._subviews))},_onWidgetsChange:function(){this._toggleVisiblity()}})},539:function(t,e,i){var n=i(5),a=i(774),s=i(4),r=n.core.View.extend({className:"CDB-Dashboard-menu",events:{"click .js-toggle-view":"_toogleView"},render:function(){var t=this.model.get("title");return t&&t.length>120&&(t=t.slice(0,110)+"... %23 map"),this.$el.html(a({showLogo:this.model.get("showLogo"),title:this.model.get("title"),description:this.model.get("description"),updatedAt:s(this.model.get("updatedAt")).fromNow(),userName:this.model.get("userName"),url:window.location.href,urlWithoutParams:window.location.protocol+"//"+window.location.host+window.location.pathname,inIframe:window.location!==window.parent.location,shortTitle:t,userAvatarURL:this.model.get("userAvatarURL"),userProfileURL:this.model.get("userProfileURL")})),this},_toogleView:function(){this.$el.toggleClass("is-active")}});t.exports=r},540:function(t,e,i){var n=i(0),a=i(3),s=i(62),r=i(5),o=i(550),l=i(559),h=i(560),d=i(563),c=i(255),u=i(775),g=window.matchMedia;t.exports=r.core.View.extend({className:"CDB-Widget-canvas",initialize:function(t){this._widgetViewFactory=new c([{type:"formula",createContentView:function(t){return new l({model:t})}},{type:"list",createContentView:function(t){return new d({model:t})}},{type:"histogram",createContentView:function(t){return new h({model:t})}},{type:"category",createContentView:function(t){return new o({model:t})}}]),this._widgets=t.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("orderChanged",this.render,this),this._widgets.bind("change:collapsed",this._onWidgetUpdate,this),this._widgets.bind("add remove reset",this._onUpdate,this),this.add_related_model(this._widgets),this._resizeHandler=this._onResize.bind(this)},render:function(){return this._cleanScroll(),this._observer&&this._observer.disconnect(),this.clearSubViews(),this.$el.html(u()),this.$el.toggleClass("CDB-Widget-canvas--withMenu",this.model.get("renderMenu")),this._widgets.each(this._maybeRenderWidgetView,this),this.$el.toggle(!n.isEmpty(this._subviews)),this._renderScroll(),this._renderShadows(),this._bindScroll(),this._initResize(),this},_initResize:function(){["(max-width: 1600px)","(max-width: 1280px)","(max-width: 759px)"].forEach(function(t){g(t).addListener(this._resizeHandler)},this)},_updateScrollCss:function(){this._onWidgetUpdate();var t=this._container();if(t){var e=t.clientWidth,i=t.clientHeight,n=t.scrollWidth,a=t.scrollHeight,s=e<n,r=i<a;this._$container().toggleClass("hasXScroll",s),this._$container().toggleClass("hasYScroll",r)}},_$container:function(){return a(this._container())},_container:function(){return this.el.querySelector(".js-container")},_maybeRenderWidgetView:function(t){var e=this._widgetViewFactory.createWidgetView(t);e&&(this.addView(e),this._$container().append(e.render().el))},_bindScroll:function(){this._$container().on("ps-y-reach-start",n.bind(this._onScrollTop,this)).on("ps-y-reach-end",n.bind(this._onScrollBottom,this)).on("ps-scroll-y",n.bind(this._onScroll,this))},_renderScroll:function(){s.initialize(this._container(),{wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20})},_onWidgetUpdate:function(){s.update(this._container())},_renderShadows:function(){this.$shadowTop=a("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--top"),this.$shadowBottom=a("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--bottom"),this.$el.append(this.$shadowTop),this.$el.append(this.$shadowBottom)},_onScrollTop:function(){this.$shadowTop.removeClass("is-visible")},_onScroll:function(){var t=this._$container(),e=t.scrollTop(),i=t.get(0).scrollHeight,n=t.outerHeight(),a=i-n;this.$shadowTop.toggleClass("is-visible",e>0),this.$shadowBottom.toggleClass("is-visible",e<a)},_updateScroll:function(){this._$container().scrollLeft=0,this._$container().scrollTop=0},_onResize:function(t){this._updateScroll(),this._onScroll()},_onScrollBottom:function(){this.$shadowBottom.removeClass("is-visible")},_cleanScroll:function(){a(window).off("resize",this._resizeHandler),this._container()&&(this._$container().off("ps-scroll-y"),s.destroy(this._container()))},_onUpdate:function(){this.$el.toggle(n.size(this._subviews)>0)},clean:function(){this._cleanScroll(),this._observer&&this._observer.disconnect(),r.core.View.prototype.clean.call(this)}})},541:function(t,e,i){var n=i(5),a=i(776),s=i(538),r=i(539),o=i(540);t.exports=n.core.View.extend({className:"CDB-Dashboard-canvas",initialize:function(t){this._widgets=t.widgets,this._infoView=t.infoView,this.el.classList.add(this.className),this.$el.html(a())},render:function(){this.clearSubViews();var t,e=this.model.get("renderMenu");return e&&(t=new r({model:this.model}),this.addView(t),this.$el.append(t.render().el)),t=new s({widgets:this._widgets}),this.addView(t),this.$(".js-map-wrapper").toggleClass("CDB-Dashboard-mapWrapper--withMenu",e).append(t.render().el),t=new o({widgets:this._widgets,model:this.model}),this.addView(t),this.$el.append(t.render().el),this},getInitialMapState:function(){return{bounds:this.model.get("initialPosition").bounds}}})},542:function(t,e){t.exports={analyses:{source:"Source","connect-with-lines":{"short-title":"Connect with lines"},georeference:{"short-title":"Georeference"},"data-observatory-measure":{"short-title":"Data observatory"},merge:{"short-title":"Join columns"},"filter-by-node-column":{"short-title":"Filter by layer"},centroid:{"short-title":"Centroid"},"group-points":{"short-title":"Group points"},"convex-hull":{"short-title":"Convex Hull"},"concave-hull":{"short-title":"Concave Hull"},"bounding-box":{"short-title":"Bounding Box"},"bounding-circle":{"short-title":"Bounding Circle"},"area-of-influence":{"short-title":"AOI"},"filter-intersection":{"short-title":"Filter points in polygons"},"aggregate-intersection":{"short-title":"Aggregate intersection"},filter:{"short-title":"Filter"},sampling:{"short-title":"Sampling"},kmeans:{"short-title":"Clusters"},"moran-cluster":{"short-title":"Outliers & clusters"},"spatial-markov-trend":{"short-title":"Trends"},routing:{"short-title":"Routing"},"deprecated-sql-function":{"short-title":"SQL Function"},"find-nearest":{"short-title":"Find nearest"}}}},543:function(t,e,i){t.exports={en:i(542)}},544:function(t,e,i){function n(t,e){a.each(e,function(e){if(void 0===t[e])throw new Error(e+" is required")})}var a=i(0),s=i(72),r=i(549),o=i(562),l=i(569),h={auto_style_allowed:"autoStyleEnabled"},d=function(t){return a.reduce(h,function(e,i,n){if(void 0!==t[n])return e[i]=t[n],e},{})},c=function(t,e){this._widgetsCollection=t,this._dataviews=e};c.prototype.getCollection=function(){return this._widgetsCollection},c.prototype.get=function(t){return this._widgetsCollection.get(t)},c.prototype.getList=function(){return this._widgetsCollection.models},c.prototype.createCategoryModel=function(t,e,i){n(t,["title"]),t=a.extend(t,i,{hasInitialState:this._widgetsCollection.hasInitialState()});var s=this._dataviews.createCategoryModel(e,t),o=["id","title","order","collapsed","prefix","suffix","show_stats","show_source","style","hasInitialState"],l=a.pick(t,o),h=d(t);l.attrsNames=o;var c=new r(l,{dataviewModel:s},h);return c.setInitialState(i),this._widgetsCollection.add(c),c},c.prototype.createHistogramModel=function(t,e,i,s){n(t,["title"]);var r=a.extend(t,i,{hasInitialState:this._widgetsCollection.hasInitialState()}),l=this._dataviews.createHistogramModel(e,r),h=["id","title","order","collapsed","bins","show_stats","show_source","normalized","style","hasInitialState"],c=a.pick(t,h),u=d(t);c.type="histogram",c.attrsNames=h;var g=new o(c,{dataviewModel:l},u);return g.setInitialState(i),this._widgetsCollection.add(g),g},c.prototype.createFormulaModel=function(t,e,i){n(t,["title"]),t=a.extend(t,i,{hasInitialState:this._widgetsCollection.hasInitialState()});var r=this._dataviews.createFormulaModel(e,t),o=["id","title","order","collapsed","prefix","suffix","show_stats","show_source","description","hasInitialState"],l=a.pick(t,o);l.type="formula",l.attrsNames=o;var h=new s(l,{dataviewModel:r});return h.setInitialState(i),this._widgetsCollection.add(h),h},c.prototype.createListModel=function(t,e){n(t,["title","columns_title"]);var i=this._dataviews.createListModel(e,t),r=["id","title","order","columns_title","show_stats","show_source"],o=a.pick(t,r);o.type="list",o.attrsNames=r;var l=new s(o,{dataviewModel:i});return this._widgetsCollection.add(l),l},c.prototype.createTimeSeriesModel=function(t,e,i,n){t.column_type=t.column_type||"date";var s=this._dataviews.createHistogramModel(e,t),r=["id","style","title","normalized"],o=a.pick(t,r);o.type="time-series",o.attrsNames=r;var h=new l(o,{dataviewModel:s},n);return h.setInitialState(i),this._widgetsCollection.add(h),h},c.prototype.setWidgetsState=function(t){this._widgetsCollection.setStates(t)},t.exports=c},545:function(t,e,i){function n(t){return t&&t.definition&&t.definition.color&&t.definition.color.range||r}function a(t){this.updateColors(t)}var s=i(0),r=["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74"];a.prototype.updateColors=function(t){var e=n(t);this.colors={},s.each(e,function(t){this.colors[t]=null},this)},a.prototype.updateData=function(t){s.each(this.colors,function(e,i){s.contains(t,e)?t=s.without(t,e):this.colors[i]=null},this),s.each(t,function(t){var e=this.getNextAvailableColor();e&&(this.colors[e]=t)},this)},a.prototype.getNextAvailableColor=function(){for(var t in this.colors)if(null===this.colors[t])return t;return null},a.prototype.getColorByCategory=function(t){for(var e in this.colors)if(this.colors[e]===t)return e;return"#A5AA99"},a.prototype.getCategoryByColor=function(t){return this.colors[t]},t.exports=a},546:function(t,e,i){var n=i(247),a=i(248),s=i(0);t.exports=n.extend({getStyle:function(){var t=this.layer.get("initialStyle");if(t)return["marker-fill","polygon-fill","line-color"].forEach(function(e){t=a.changeStyle(t,e,this._generateCategoryRamp())}.bind(this)),a.replaceWrongSpaceChar(t)},getRange:function(){return s.map(this.dataviewModel.get("data"),function(t){return this.colors.getColorByCategory(t.name)},this)},getDef:function(){var t=this.dataviewModel,e=t.get("data"),i=this.getRange(),n={};return["marker-fill","polygon-fill","line-color"].forEach(function(a){var r={},o=a.substring(0,a.indexOf("-"));r={color:{domain:s.pluck(e,"name"),range:i,attribute:t.get("column")}},n["marker"===o?"point":o]=r}),n},_generateCategoryRamp:function(){var t=this.dataviewModel,e=t.get("data"),i=t.get("column");return this._getCategoryRamp(e,i)},_getCategoryRamp:function(t,e){for(var i="ramp(["+e+"], ",n="",a="",s=0;s<t.length;s++){var r=t[s],o=s!==t.length-1?'", ':'"';n+='"'+this.colors.getColorByCategory(r.name)+o,r.agg?'"'===o&&(a=a.substring(0,a.length-2)):a+='"'+r.name.replace(/"/g,'\\"')+o}return i+"("+n+"), ("+a+"))"}})},547:function(t,e,i){var n={category:i(546),histogram:i(548)};t.exports={get:function(t,e){var i=n[t.get("type")];if(i)return new i(t,e);throw new Error("dataview type not supported")}}},548:function(t,e,i){var n=i(247),a=i(248),s=i(29),r=i(0),o=n.extend({getStyle:function(){var t=this.layer.get("initialStyle");if(t)return["marker-fill","polygon-fill","line-color"].forEach(function(e){t=a.changeStyle(t,e,this.getColorLine(e,this.getCustomStyle()))}.bind(this)),a.replaceWrongSpaceChar(t)},getCustomStyle:function(){return this.styles&&this.styles.definition&&this.styles.definition.color},updateColors:function(t){this.styles=t.auto_style},getColorLine:function(t,e){var i=e||{};if(!e){var n=this.dataviewModel.getDistributionType(this.dataviewModel.getUnfilteredDataModel().get("data"));i=o.SCALES_MAP[t][n]}return"ramp(["+this.dataviewModel.get("column")+"], "+(e?"('"+i.range.join("', '")+"'), ":"cartocolor("+i.palette+", "+this.dataviewModel.get("bins")+"), ")+i.quantification+")"},getDef:function(t){var e={},i=this.dataviewModel.getDistributionType(this.dataviewModel.getUnfilteredDataModel().get("data")),n=this.dataviewModel.get("bins"),l=this.dataviewModel.get("column"),h=this.styles,d=this.styles&&this.styles.custom||!1;return["marker-fill","polygon-fill","line-color"].forEach(function(c){if(a.isPropertyIncluded(t,c)){var u=o.SCALES_MAP[c][i],g=c.substring(0,c.indexOf("-")),p={};u&&(p=!0===d?r.extend(p,h.definition):{color:{range:s[u.palette][n]||s[u.palette][Object.keys(s[u.palette]).length],quantification:u.quantification,attribute:l}}),e["marker"===g?"point":g]=p}}),e}});o.SCALES_MAP={"polygon-fill":{F:{palette:"PinkYl",quantification:"equal"},L:{palette:"Emrld",quantification:"headtails"},J:{palette:"Emrld",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"Sunset",quantification:"jenks"},U:{palette:"Sunset",quantification:"jenks"}},"line-color":{F:{palette:"PinkYl",quantification:"equal"},L:{palette:"Emrld",quantification:"headtails"},J:{palette:"Emrld",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"Sunset",quantification:"jenks"},U:{palette:"Sunset",quantification:"jenks"}},"marker-fill":{F:{palette:"RedOr",quantification:"equal"},L:{palette:"BluYl",quantification:"headtails"},J:{palette:"BluYl",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"SunsetDark",quantification:"jenks"},U:{palette:"SunsetDark",quantification:"jenks"}}},t.exports=o},549:function(t,e,i){var n=i(0),a=i(72),s=i(554);t.exports=a.extend({defaults:n.extend({type:"category",search:!1,locked:!1},a.prototype.defaults),defaultState:n.extend({acceptedCategories:[],locked:!1,autoStyle:!1},a.prototype.defaultState),initialize:function(){a.prototype.initialize.apply(this,arguments),this.lockedCategories=new s,this.listenTo(this.dataviewModel,"change:allCategoryNames",this._onDataviewAllCategoryNamesChange),this.on("change:locked",this._onLockedChange,this),this.on("change:collapsed",this._onCollapsedChange,this),this.isAutoStyleEnabled()&&this.on("change:style",this._updateColors,this),this.dataviewModel.filter.on("change",function(){this.set("acceptedCategories",this._acceptedCategories().pluck("name"))},this),this.dataviewModel.once("change:allCategoryNames",function(){this.get("autoStyle")&&this.autoStyle()},this)},setupSearch:function(){this.dataviewModel.setupSearch(),this.lockedCategories.addItems(this._acceptedCategories().toJSON()),this.toggleSearch()},toggleSearch:function(){this.set("search",!this.get("search"))},enableSearch:function(){this.set("search",!0)},disableSearch:function(){this.set("search",!1)},isSearchEnabled:function(){return this.get("search")},cleanSearch:function(){this.dataviewModel.cleanSearch(),this.lockedCategories.reset([])},autoStyle:function(){this.autoStyler.colors.updateData(this.dataviewModel.get("allCategoryNames")),a.prototype.autoStyle.call(this)},_updateColors:function(t,e){this.autoStyler.colors.updateColors(e.auto_style),this.autoStyler.colors.updateData(n.pluck(this.dataviewModel.get("data"),"name")),this.isAutoStyle()&&this.reapplyAutoStyle()},isLocked:function(){return this.get("locked")},canBeLocked:function(){return this.isLocked()||this._acceptedCategories().size()>0},canApplyLocked:function(){return this._acceptedCategories().size()!==this.lockedCategories.size()||this._acceptedCategories().any(function(t){return!this.lockedCategories.isItemLocked(t.get("name"))},this)},applyLocked:function(){var t=this.lockedCategories.getItemsName();if(!t.length)return this.unlockCategories(),!1;this.set("locked",!0);var e=this.dataviewModel.filter;e.cleanFilter(!1),e.accept(t),e.applyFilter(),this.cleanSearch()},lockCategories:function(){this.set("locked",!0),this.dataviewModel.fetch()},unlockCategories:function(){this.set("locked",!1),this.dataviewModel.filter.acceptAll()},_onDataviewAllCategoryNamesChange:function(t,e){this.isAutoStyleEnabled()&&(this.isAutoStyle()||this.autoStyler.colors.updateData(e))},_onLockedChange:function(t,e){e?this.dataviewModel.enableFilter():this.dataviewModel.disableFilter()},_acceptedCategories:function(){return this.dataviewModel.filter.acceptedCategories},_onCollapsedChange:function(t,e){this.dataviewModel.set("enabled",!e)}})},550:function(t,e,i){var n=i(5),a=i(558),s=i(555),r=i(249),o=i(557),l=i(250),h=i(553),d=i(556),c=i(777);t.exports=n.core.View.extend({className:"CDB-Widget-body",_ITEMS_PER_PAGE:6,initialize:function(){this._dataviewModel=this.model.dataviewModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(c()),this._initViews(),this},_initBinds:function(){!0===this.model.get("hasInitialState")?this._onInitialState():this.model.bind("change:hasInitialState",this._onInitialState,this),this.model.bind("change:collapsed",function(t,e){this.$el.toggleClass("is-collapsed",!!e)},this)},_onInitialState:function(){this.render(),!0===this.model.get("autoStyle")&&this.model.autoStyle()},_initViews:function(){var t=new a({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-header").append(t.render().el),this.addView(t);var e=new o({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-header").append(e.render().el),this.addView(e);var i=new s({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-content").html(i.render().el),this.addView(i);var n=new r({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE});this.$(".js-content").append(n.render().el),this.addView(n);var c=new l({$target:n.$el,widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE});this.$(".js-footer").append(c.render().el),this.addView(c);var u=new h({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0});this.$(".js-content").append(u.render().el),this.addView(u);var g=new d({$target:u.$el,widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0});this.$(".js-footer").append(g.render().el),this.addView(g)}})},551:function(t,e,i){var n=i(5),a=i(22),s=i(0),r=i(778),o=i(779);t.exports=n.core.View.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(t){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){var t=this.model.get("name"),e=this.model.get("value"),i=this.model.get("agg")||this.widgetModel.isLocked()?o:r,n=this.dataviewModel.filter.getAcceptedCategoryNames(),l=s.contains(n,t);return this.$el.html(i({isAggregated:this.model.get("agg"),name:t,value:e,formattedValue:a.formatNumber(e),percentage:e/this.dataviewModel.get("max")*100,color:this.widgetModel.getColor(t),isDisabled:this.model.get("selected")?"":"is-disabled",isAccepted:l,prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change",this.render,this),this.widgetModel.bind("change:search change:prefix change:suffix change:autoStyle",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.trigger("itemClicked",this.model,this)}})},552:function(t,e,i){var n=i(5),a=i(22),s=i(780);t.exports=n.core.View.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(t){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var t=this.model.get("value");return this.$el.html(s({name:this.model.get("name"),value:t,formattedValue:a.formatNumber(t),percentage:t/this.dataviewModel.get("max")*100,isDisabled:!this.model.get("selected"),prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change:selected",this.render,this),this.widgetModel.bind("change:prefix change:suffix",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.model.set("selected",!this.model.get("selected"))}})},553:function(t,e,i){var n=i(3),a=i(249),s=i(552),r=i(782);t.exports=a.extend({className:"CDB-Widget-list is-hidden CDB-Widget-list--wrapped js-list",render:function(){this.clearSubViews(),this.$el.empty();var t=this._searchResultsCollection;return t.isEmpty()||0===t.size()?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){a.prototype._initBinds.apply(this,arguments),this._searchResultsCollection=this.dataviewModel.getSearchResult(),this._searchResultsCollection.on("change:selected",this._onSelectedItemChange,this),this._searchResultsCollection.on("reset",this.render,this),this.add_related_model(this._searchResultsCollection)},_renderList:function(){this.$el.removeClass("CDB-Widget-list--withBorders CDB-Widget-list--noresults"),this.$el.addClass("CDB-Widget-list--wrapped");var t;this._searchResultsCollection.each(function(e,i){i%this.options.itemsPerPage==0&&(t=n("<div>").addClass("CDB-Widget-listGroup"),this.$el.append(t)),this._addItem(e,t)},this)},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--noresults").removeClass("CDB-Widget-list--wrapped"),this.$el.html(r({q:this.dataviewModel.getSearchQuery()}))},_addItem:function(t,e){var i=new s({model:t,widgetModel:this.widgetModel,dataviewModel:this.dataviewModel});this.addView(i),e.append(i.render().el)},toggle:function(){this[this.widgetModel.isSearchEnabled()?"show":"hide"]()},_onSelectedItemChange:function(t,e){this.widgetModel.lockedCategories[e?"addItem":"removeItem"](t)}})},554:function(t,e,i){var n=i(0),a=i(1);t.exports=a.Collection.extend({addItem:function(t){this.isItemLocked(t.get("name"))||this.add(t)},addItems:function(t){n.each(t,function(t){this.isItemLocked(t.name)||this.add(t)},this)},resetItems:function(t){this.reset(t)},removeItem:function(t){var e=this.isItemLocked(t.get("name"));e&&this.remove(e)},removeItems:function(){this.reset([])},isItemLocked:function(t){return this.find(function(e){return e.get("name")===t})},getItemsName:function(){return this.pluck("name")}})},555:function(t,e,i){var n=i(5),a=i(783);t.exports=n.core.View.extend({className:"CDB-Widget-filter CDB-Widget-contentSpaced CDB-Widget-contentSpaced--sideMargins",events:{"click .js-all":"_onSelectAll","click .js-lock":"_lockCategories","click .js-unlock":"_unlockCategories"},initialize:function(){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var t=this.dataviewModel.filter.acceptedCategories.size(),e=this.dataviewModel.filter.rejectedCategories.size(),i=this.dataviewModel.filter.areAllRejected(),n=this.dataviewModel.getData().size(),s=this.widgetModel.isLocked();return this.$el.html(a({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:s,canBeLocked:this.widgetModel.canBeLocked(),allSelected:0===e&&0===t&&!i,canSelectAll:!s&&(e>0||t>0||i),noneSelected:i||!n&&!t,acceptedCats:t,totalLocked:this.widgetModel.lockedCategories.size(),totalCats:n})),this},_initBinds:function(){this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.lockedCategories.bind("change add remove",this.render,this),this.add_related_model(this.widgetModel),this.add_related_model(this.widgetModel.lockedCategories),this.dataviewModel.bind("change:data",this.render,this),this.add_related_model(this.dataviewModel);var t=this.dataviewModel.filter;t.acceptedCategories.bind("add remove reset",this.render,this),t.rejectedCategories.bind("add remove reset",this.render,this),this.add_related_model(t.rejectedCategories),this.add_related_model(t.acceptedCategories)},_lockCategories:function(){this.widgetModel.lockCategories()},_unlockCategories:function(){this.widgetModel.unlockCategories()},_onSelectAll:function(){this.dataviewModel.filter.acceptAll()}})},556:function(t,e,i){var n=i(250),a=i(785);t.exports=n.extend({className:"CDB-Widget-nav is-hidden CDB-Widget-contentSpaced",render:function(){this.clearSubViews(),this.$el.empty();var t=Math.ceil(this.dataviewModel.getSearchCount()/this.options.itemsPerPage);return this.$el.html(a({showPaginator:t>1,currentPage:this.model.get("page"),pages:t})),this._scrollToPage(),this},_setPage:function(){var t=this.dataviewModel.getSearchCount(),e=Math.ceil(t/this._ITEMS_PER_PAGE);this.model.get("page")>e-1&&this.model.set({page:0},{silent:!0})},toggle:function(){this[this.widgetModel.isSearchEnabled()?"show":"hide"]()},_onSearchClicked:function(){this.widgetModel.cleanSearch(),this.widgetModel.toggleSearch()}})},557:function(t,e,i){var n=i(0),a=i(5),s=i(22),r=i(787),o=i(786),l=i(71);t.exports=a.core.View.extend({className:"CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace",tagName:"dl",initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){return this.$el.html(r({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:this.widgetModel.isLocked(),isOtherAvailable:this.dataviewModel.isOtherAvailable(),resultsCount:this.dataviewModel.getSearchCount(),totalCats:this._getCategoriesSize(),nullsPer:this._getNullPercentage(),catsPer:this._getCurrentCategoriesPercentage()})),new l({el:this.$el}).animateFromValues(this._getPreviousCategoriesPercentage(),this._getCurrentCategoriesPercentage(),".js-cats",o,{defaultValue:"-",animationSpeed:700,formatter:s.formatValue}),this._checkVisibility(),this},_initBinds:function(){this.dataviewModel.bind("change:data change:totalCount",this.render,this),this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.bind("change:show_stats",this._checkVisibility,this),this.add_related_model(this.dataviewModel),this.add_related_model(this.widgetModel)},_getNullPercentage:function(){var t=this.dataviewModel.get("nulls"),e=this.dataviewModel.get("totalCount")||0;return t?(t/e*100).toFixed(2):0},_getPreviousCategoriesPercentage:function(){var t=this.dataviewModel.previous("totalCount")||0,e=this.dataviewModel.getPreviousData();return this._getCategoriesPercentage(e,t)},_getCurrentCategoriesPercentage:function(){var t=this.dataviewModel.get("totalCount")||0,e=this.dataviewModel.getData().toJSON();return this._getCategoriesPercentage(e,t)},_getCategoriesPercentage:function(t,e){if(!e)return 0;var i=t.reduce(function(t,e){return e.agg?t:t+parseFloat(e.value)},0);return i?(i/e*100).toFixed(2):0},_getCategoriesSize:function(){return n.pluck(this.dataviewModel.getData().reject(function(t){return t.get("agg")}),"name").length},_checkVisibility:function(){this.$el.toggle(!!this.widgetModel.get("show_stats"))}})},558:function(t,e,i){var n=i(0),a=i(3),s=i(5),r=i(48),o=i(254),l=i(788),h=i(102),d=i(101);t.exports=s.core.View.extend({events:{"keyup .js-textInput":"_onKeyupInput","submit .js-form":"_onSubmitForm","click .js-applyLocked":"_applyLocked","click .js-autoStyle":"_autoStyle","click .js-cancelAutoStyle":"_cancelAutoStyle"},initialize:function(){this.model=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){this.clearSubViews();var t=this.dataviewModel.get("source").id,e=h.letter(t),i=h.getColorForLetter(e),n=this.dataviewModel.getSourceType()||"",a=this.dataviewModel.getLayerName()||"";return this.$el.html(l({isCollapsed:this.model.get("collapsed"),isAutoStyleEnabled:this._isAutoStyleButtonVisible(),isAutoStyle:this.model.isAutoStyle(),title:this.model.get("title"),sourceId:t,sourceType:d.title(n),showSource:this.model.get("show_source")&&""!==e,sourceColor:i,layerName:a,columnName:this.dataviewModel.get("column"),q:this.dataviewModel.getSearchQuery(),isLocked:this.model.isLocked(),canBeLocked:this.model.canBeLocked(),isSearchEnabled:this.model.isSearchEnabled(),canShowApply:this.model.canApplyLocked()})),this._initViews(),this},_initBinds:function(){this.model.bind("change:search",this._onSearchToggled,this),this.model.bind("change:title change:collapsed change:autoStyle change:style",this.render,this),this.model.lockedCategories.bind("change add remove",this.render,this),this.add_related_model(this.model.lockedCategories),this.dataviewModel.bind("change:data",this.render,this),this.add_related_model(this.dataviewModel),this.dataviewModel.filter.bind("change",this.render,this),this.add_related_model(this.dataviewModel.filter),this.dataviewModel.layer.bind("change:visible change:cartocss",this.render,this),this.add_related_model(this.dataviewModel.layer)},_initViews:function(){var t=new r({model:this.model,target:".js-actions",container:this.$el});this.addView(t);var e=new o({target:this.$(".js-colors")});a("body").append(e.render().el),this.addView(e)},_isAutoStyleButtonVisible:function(){return this.model.isAutoStyleEnabled()&&this.dataviewModel.layer.get("visible")&&this.model.hasColorsAutoStyle()},_onSearchToggled:function(){var t=this.model.isSearchEnabled();this[t?"_bindESC":"_unbindESC"](),this.render(),t&&this._focusOnInput()},_onSubmitForm:function(t){t&&t.preventDefault();var e=this.$(".js-textInput").val();this.dataviewModel.getSearchQuery()!==e&&(this.dataviewModel.setSearchQuery(e),this.dataviewModel.isSearchValid()&&this.dataviewModel.applySearch())},_focusOnInput:function(){var t=this;setTimeout(function(){t.$(".js-textInput").focus()},0)},_onKeyupInput:n.debounce(function(t){var e=this.$(".js-textInput").val();13!==t.keyCode&&27!==t.keyCode&&""!==e&&this._onSubmitForm()},250),_bindESC:function(){a(document).bind("keyup."+this.cid,n.bind(this._onKeyUp,this))},_unbindESC:function(){a(document).unbind("keyup."+this.cid)},_onKeyUp:function(t){if(27===t.keyCode)return this._cancelSearch(),!1},_applyLocked:function(){this.model.toggleSearch(),this.model.applyLocked()},_autoStyle:function(){this.model.autoStyle()},_cancelAutoStyle:function(){this.model.cancelAutoStyle()},_cancelSearch:function(){this.model.cleanSearch(),this.model.disableSearch()},clean:function(){this._unbindESC(),s.core.View.prototype.clean.call(this)}})},559:function(t,e,i){var n=i(0),a=i(31),s=i(5),r=i(22),o=i(791),l=i(48),h=i(790),d=i(71),c=i(102),u=i(101);t.exports=s.core.View.extend({className:"CDB-Widget-body",initialize:function(){this._dataviewModel=this.model.dataviewModel,!0===this.model.get("hasInitialState")?this._initBinds():this.model.once("change:hasInitialState",this._onInitialState,this)},_onInitialState:function(){this._initBinds(),this.render()},render:function(){this.clearSubViews();var t=this._dataviewModel.get("data"),e=function(t){var e=a.format("0,000");return n.isNumber(t)?e(t.toFixed(2)):0},i=!n.isUndefined(this._dataviewModel.get("nulls"))&&r.formatNumber(this._dataviewModel.get("nulls"))||"-",s=this.model.get("collapsed"),l=this.model.get("prefix"),g=this.model.get("suffix"),p=this._dataviewModel.get("source").id,_=c.letter(p),f=c.getColorForLetter(_),m=this._dataviewModel.getSourceType()||"",v=this._dataviewModel.getLayerName()||"";return this.$el.html(o({title:this.model.get("title"),sourceId:p,sourceType:u.title(m),showStats:this.model.get("show_stats"),showSource:this.model.get("show_source")&&""!==_,operation:this._dataviewModel.get("operation"),value:t,formatedValue:e(t),description:this.model.get("description"),nulls:i,prefix:l,suffix:g,isCollapsed:s,sourceColor:f,layerName:v})),new d({el:this.$el}).animateValue(this._dataviewModel,"data",".js-value",h,{animationSpeed:700,formatter:e,templateData:{prefix:l,suffix:g}}),this.$el.toggleClass("is-collapsed",!!s),this._initViews(),this},_initBinds:function(){this.model.bind("change:title change:description change:collapsed change:prefix change:suffix",this.render,this),this._dataviewModel.bind("change:data",this.render,this),this.add_related_model(this._dataviewModel)},_initViews:function(){var t=new l({model:this.model,target:".js-actions",container:this.$(".js-header")});this.addView(t)}})},560:function(t,e,i){var n=i(0),a=i(5),s=i(22),r=i(561),o=i(251),l=i(795),h=i(793),d=i(48),c=i(71),u=i(792),g=i(102),p=i(101);t.exports=a.core.View.extend({className:"CDB-Widget-body",defaults:{chartHeight:72},events:{"click .js-clear":"_resetWidget","click .js-zoom":"_zoom"},initialize:function(){this._dataviewModel=this.model.dataviewModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this.filter=this._dataviewModel.filter,this.lockedByUser=!1,this._numberOfFilters=0,this._initStateApplied=!1;var t=this._initBinds.bind(this);this._originalData.once("change:data",function(){this._dataviewModel.fetch({complete:t})},this)},_initViews:function(){this._initTitleView();var t=new d({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{normalizeHistogram:!0}});this.addView(t),this._renderMiniChart(),this._renderMainChart(),this._renderAllValues()},_initTitleView:function(){var t=new r({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-title").append(t.render().el),this.addView(t)},_initBinds:function(){this.model.bind("change:normalized",function(){var t=this.model.get("normalized");this.histogramChartView.setNormalized(t),this.miniHistogramChartView.setNormalized(t)},this),this.model.bind("change:collapsed",this.render,this),!0===this.model.get("hasInitialState")?this._setInitialState():this.model.bind("change:hasInitialState",this._setInitialState,this)},_setInitialState:function(){0===this._dataviewModel.getData().length?this._dataviewModel.once("change:data",this._onInitialState,this):this._onInitialState()},_onInitialState:function(){this.add_related_model(this._dataviewModel),this.render(),!0===this.model.get("autoStyle")&&this.model.autoStyle(),this._hasRange()&&(this._numberOfFilters=1),this._isZoomed()&&(this._numberOfFilters=2),0!==this._numberOfFilters?this._setInitialRange():this._completeInitialState()},_setupRange:function(t,e,i,a){var s,r,o=0,l=t.length;n.isNumber(e)&&(s=n.findWhere(t,{start:e}),o=s?s.bin:0),n.isNumber(i)&&(r=n.findWhere(t,{end:i}),l=r?r.bin+1:t.length),(o&&0!==o||l&&l!==t.length)&&(this.filter.setRange(t[o].start,t[l-1].end),this._onChangeFilterEnabled(),this.histogramChartView.selectRange(o,l)),a&&a(o,l)},_setInitialRange:function(){var t=this._dataviewModel.getData(),e=this.model.get("min"),i=this.model.get("max"),n=void 0!==e||void 0!==i;this._setupRange(t,e,i,function(t,e){this.model.set({filter_enabled:n,lo_index:t,hi_index:e}),this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this._initStateApplied=!0,this._isZoomed()?(this._onChangeZoomEnabled(),this._onZoomIn()):this._updateStats()}.bind(this))},_completeInitialState:function(){this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this._initStateApplied=!0,this._updateStats()},_isZoomed:function(){return this.model.get("zoomed")},_hasRange:function(){var t=this.model.get("min"),e=this.model.get("max");return null!=t||null!=e},_onHistogramDataChanged:function(){this._dataviewModel.changed.url&&this._isZoomed()||(this.lockedByUser?this.lockedByUser=!1:(this._isZoomed()?this._filteredData=this._dataviewModel.getData():(this.histogramChartView.showShadowBars(),this.miniHistogramChartView.replaceData(this._dataviewModel.getData())),this.histogramChartView.replaceData(this._dataviewModel.getData())),this.unsettingRange&&this._unsetRange(),this._updateStats())},render:function(){this.clearSubViews(),this._unbinds();var t=this._dataviewModel.getData(),e=this._originalData.getData(),i=!n.size(t)&&!n.size(e),a=this._dataviewModel.get("source").id,s=g.letter(a),r=g.getColorForLetter(s),o=this._dataviewModel.getSourceType()||"",l=this._dataviewModel.getLayerName()||"";return this.$el.html(h({title:this.model.get("title"),sourceId:a,sourceType:p.title(o),showStats:this.model.get("show_stats"),showSource:this.model.get("show_source")&&""!==s,itemsCount:i?"-":t.length,isCollapsed:!!this.model.get("collapsed"),sourceColor:r,layerName:l})),i?(this._addPlaceholder(),this._initTitleView()):(this._setupBindings(),this._initViews()),this},_unsetRange:function(){this.unsettingRange=!1,this.histogramChartView.replaceData(this._dataviewModel.getData()),this.model.set({lo_index:null,hi_index:null}),this._isZoomed()||this.histogramChartView.showShadowBars()},_addPlaceholder:function(){this.$(".js-content").append(l())},_renderMainChart:function(){this.histogramChartView=new o({margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,hasAxisTip:!0,chartBarColor:this.model.getColor()||"#9DE0AD",width:this.canvasWidth,height:this.defaults.chartHeight,data:this._dataviewModel.getData(),dataviewModel:this._dataviewModel,originalData:this._originalData,displayShadowBars:!this.model.get("normalized"),normalized:this.model.get("normalized"),widgetModel:this.model}),this.$(".js-content").append(this.histogramChartView.el),this.addView(this.histogramChartView),this.histogramChartView.bind("on_brush_end",this._onBrushEnd,this),this.histogramChartView.bind("hover",this._onValueHover,this),this.histogramChartView.render().show(),this._updateStats()},_renderMiniChart:function(){this.miniHistogramChartView=new o({className:"CDB-Chart--mini",mini:!0,margin:{top:0,right:4,bottom:4,left:4},height:40,showOnWidthChange:!1,data:this._dataviewModel.getData(),normalized:this.model.get("normalized"),chartBarColor:this.model.getColor()||"#9DE0AD",originalData:this._originalData,widgetModel:this.model}),this.addView(this.miniHistogramChartView),this.$(".js-content").append(this.miniHistogramChartView.el),this.miniHistogramChartView.bind("on_brush_end",this._onMiniRangeUpdated,this),this.miniHistogramChartView.render()},_setupBindings:function(){this._dataviewModel.bind("change:bins",this._onChangeBins,this),this.model.bind("change:zoomed",this._onChangeZoomed,this),this.model.bind("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.bind("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.bind("change:total",this._onChangeTotal,this),this.model.bind("change:nulls",this._onChangeNulls,this),this.model.bind("change:max",this._onChangeMax,this),this.model.bind("change:min",this._onChangeMin,this),this.model.bind("change:avg",this._onChangeAvg,this)},_unbinds:function(){this._dataviewModel.off("change:bins",this._onChangeBins,this),this.model.off("change:zoomed",this._onChangeZoomed,this),this.model.off("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.off("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.off("change:total",this._onChangeTotal,this),this.model.off("change:nulls",this._onChangeNulls,this),this.model.off("change:max",this._onChangeMax,this),this.model.off("change:min",this._onChangeMin,this),this.model.off("change:avg",this._onChangeAvg,this)},_clearTooltip:function(){this.$(".js-tooltip").stop().hide()},_onValueHover:function(t){var e=this.$(".js-tooltip");if(t&&t.data){var i=this.defaults.chartHeight-t.top;e.css({bottom:i,left:t.left}),e.text(t.data),e.css({left:t.left-e.width()/2,bottom:i+e.height()+6}),e.fadeIn(70)}else this._clearTooltip()},_onMiniRangeUpdated:function(t,e){this.lockedByUser=!1,this._clearTooltip(),this.histogramChartView.removeSelection();var i=this._originalData.getData();this.model.set({lo_index:t,hi_index:e,zlo_index:null,zhi_index:null}),this._applyBrushFilter(i,t,e)},_onBrushEnd:function(t,e){this._isZoomed()?this._onBrushEndFiltered(t,e):this._onBrushEndUnfiltered(t,e)},_onBrushEndFiltered:function(t,e){var i=this._filteredData;i&&i.length&&(this.model.get("zlo_index")!==t||this.model.get("zhi_index")!==e)&&(this._numberOfFilters=2,this.lockedByUser=!0,this.model.set({filter_enabled:!0,zlo_index:t,zhi_index:e}),this._applyBrushFilter(i,t,e))},_onBrushEndUnfiltered:function(t,e){var i=this._dataviewModel.getData();i&&i.length&&(this.model.get("lo_index")!==t||this.model.get("hi_index")!==e)&&(this._numberOfFilters=1,this.model.set({filter_enabled:!0,zoom_enabled:!0,lo_index:t,hi_index:e}),this._applyBrushFilter(i,t,e))},_applyBrushFilter:function(t,e,i){e!==i&&e>=0&&e<t.length&&i-1>=0&&i-1<t.length?(this.filter.setRange(t[e].start,t[i-1].end),this._updateStats()):console.error("Error accessing array bounds",e,i,t)},_onChangeFilterEnabled:function(){this.$(".js-filter").toggleClass("is-hidden",!this.model.get("filter_enabled"))},_onChangeBins:function(t,e){this._originalData.setBins(e),this.model.set({zoom_enabled:!1,filter_enabled:!1,lo_index:null,hi_index:null})},_onChangeZoomEnabled:function(){this.$(".js-zoom").toggleClass("is-hidden",!this.model.get("zoom_enabled"))},_renderAllValues:function(){this._changeHeaderValue(".js-nulls","nulls",""),this._changeHeaderValue(".js-val","total","SELECTED"),this._changeHeaderValue(".js-max","max",""),this._changeHeaderValue(".js-min","min",""),this._changeHeaderValue(".js-avg","avg","")},_changeHeaderValue:function(t,e,i){if(null==this.model.get(e))return void this.$(t).text("0 "+i);this._addTitleForValue(t,e,i),new c({el:this.$el}).animateValue(this.model,e,t,u,{formatter:s.formatNumber,templateData:{suffix:" "+i}})},_onChangeNulls:function(){this._changeHeaderValue(".js-nulls","nulls","")},_onChangeTotal:function(){this._changeHeaderValue(".js-val","total","SELECTED")},_onChangeMax:function(){this._changeHeaderValue(".js-max","max","")},_onChangeMin:function(){this._changeHeaderValue(".js-min","min","")},_onChangeAvg:function(){this._changeHeaderValue(".js-avg","avg","")},_addTitleForValue:function(t,e,i){this.$(t).attr("title",this._formatNumberWithCommas(this.model.get(e).toFixed(2))+" "+i)},_formatNumberWithCommas:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},_calculateBars:function(t){var e,i,a,s,r,o;return this._isZoomed()&&2===this._numberOfFilters?(e=this.model.get("zmin"),i=this.model.get("zmax"),a=this.model.get("zlo_index"),s=this.model.get("zhi_index")):1===this._numberOfFilters&&(e=this.model.get("min"),i=this.model.get("max"),a=this.model.get("lo_index"),s=this.model.get("hi_index")),t.length>0?(n.isNumber(e)||n.isNumber(a)?n.isNumber(e)&&!n.isNumber(a)&&(r=n.findWhere(t,{start:e}),a=r&&r.bin||0):a=0,n.isNumber(i)||n.isNumber(s)?n.isNumber(i)&&!n.isNumber(s)&&(o=n.findWhere(t,{end:i}),s=o&&o.bin+1||t.length):s=t.length):(a=0,s=t.length),{loBarIndex:a,hiBarIndex:s}},_updateStats:function(){if(this._initStateApplied){var t;if(null!=(t=!this._isZoomed()||this._isZoomed()&&2===this._numberOfFilters?this.histogramChartView.model.get("data"):this.miniHistogramChartView.model.get("data"))){var e,i,a,s,r,o=this._dataviewModel.get("nulls"),l=this._calculateBars(t),h=l.loBarIndex,d=l.hiBarIndex;t&&t.length&&(e=this._calcSum(t,h,d),i=this._calcAvg(t,h,d),h>=0&&h<t.length&&(a=t[h].start),d>=0&&d-1<t.length&&(s=t[Math.max(0,d-1)].end),this._isZoomed()&&2===this._numberOfFilters?r={zmin:a,zmax:s,zlo_index:h,zhi_index:d}:this._isZoomed()||1!==this._numberOfFilters||(r={min:a,max:s,lo_index:h,hi_index:d}),r=n.extend({total:e,nulls:o,avg:i},r),this.model.set(r))}}},_calcAvg:function(t,e,i){var a=t.slice(e,i),s=this._calcSum(t,e,i,s);return s?n.reduce(a,function(t,e){return e.avg&&e.freq?e.avg*e.freq+t:t},0)/s:0},_calcSum:function(t,e,i){return n.reduce(t.slice(e,i),function(t,e){return e.freq+t},0)},_onChangeZoomed:function(){this.model.get("zoomed")?this._onZoomIn():this._resetWidget()},_showMiniRange:function(){var t=this.model.get("lo_index"),e=this.model.get("hi_index");this.miniHistogramChartView.selectRange(t,e),this.miniHistogramChartView.show()},_zoom:function(){this.model.set({zoomed:!0,zoom_enabled:!1}),this.histogramChartView.removeSelection()},_onZoomIn:function(){this.lockedByUser=!1,this._showMiniRange(),this.histogramChartView.setBounds(),this._dataviewModel.enableFilter(),this._dataviewModel.fetch()},_resetWidget:function(){this._numberOfFilters=0,this.model.set({zoomed:!1,zoom_enabled:!1,filter_enabled:!1,lo_index:null,hi_index:null,min:null,max:null,zlo_index:null,zhi_index:null,zmin:null,zmax:null}),this.filter.unsetRange(),this._dataviewModel.disableFilter(),this.histogramChartView.unsetBounds(),this.miniHistogramChartView.hide(),this._clearTooltip(),this._updateStats()}})},561:function(t,e,i){var n=i(3),a=i(5),s=i(254),r=i(794);t.exports=a.core.View.extend({className:"CDB-Widget-title CDB-Widget-contentSpaced",events:{"click .js-autoStyle":"_autoStyle","click .js-cancelAutoStyle":"_cancelAutoStyle"},initialize:function(t){if(!t.widgetModel)throw new Error("widgetModel is needed");if(!t.dataviewModel)throw new Error("dataviewModel is needed");this.widgetModel=t.widgetModel,this.dataviewModel=t.dataviewModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(r({title:this.widgetModel.get("title"),isAutoStyleEnabled:this._isAutoStyleButtonVisible(),isAutoStyle:this.widgetModel.get("autoStyle"),isCollapsed:this.widgetModel.get("collapsed")})),this._initViews(),this},_initBinds:function(){this.widgetModel.bind("change:title change:collapsed change:autoStyle change:style",this.render,this),this.add_related_model(this.widgetModel),this.dataviewModel.layer.bind("change:visible change:cartocss",this.render,this),this.add_related_model(this.dataviewModel.layer)},_initViews:function(){var t=new s({target:this.$(".js-sizes")});n("body").append(t.render().el),this.addView(t)},_isAutoStyleButtonVisible:function(){var t=this.dataviewModel.layer.get("meta"),e=this.dataviewModel.layer.get("cartocss")||t&&t.cartocss,i=e&&this.widgetModel.hasColorsAutoStyle();return this.widgetModel.isAutoStyleEnabled()&&this.dataviewModel.layer.get("visible")&&i},_autoStyle:function(){this.widgetModel.autoStyle()},_cancelAutoStyle:function(){this.widgetModel.cancelAutoStyle()}})},562:function(t,e,i){var n=i(72),a=i(0);t.exports=n.extend({defaults:{normalized:!0},defaultState:a.extend({autoStyle:!1,normalized:!1},n.prototype.defaultState),initialize:function(t,e){n.prototype.initialize.apply(this,arguments),this.on("change:collapsed",this._onCollapsedChange,this),this.on("change:style",this._updateAutoStyle,this),this.dataviewModel.once("change",function(){this.get("autoStyle")&&this.autoStyle()},this)},_onCollapsedChange:function(t,e){this.dataviewModel.set("enabled",!e)},_updateAutoStyle:function(t,e){this.autoStyler&&this.autoStyler.updateColors(e),this.isAutoStyle()&&this.reapplyAutoStyle()},getState:function(){var t=n.prototype.getState.call(this),e=this.dataviewModel.get("start"),i=this.dataviewModel.get("end"),s=this.get("min"),r=this.get("max"),o=function(t,n){return!!(a.isNumber(t)&&a.isNumber(n)&&t!==n&&Math.abs(t-n)>.01*Math.abs(e-i))};return o(e,s)?t.min=s:delete t.min,o(i,r)?t.max=r:delete t.max,!0===this.get("zoomed")&&(t.zoomed=!0),t}})},563:function(t,e,i){var n=i(0),a=i(5),s=i(22),r=i(566),o=i(567),l=i(564),h=i(796),d=i(798);t.exports=a.core.View.extend({className:"CDB-Widget-body",options:{showScroll:!1},initialize:function(){this._dataviewModel=this.model.dataviewModel,this._initBinds()},render:function(){this.clearSubViews();var t=this._dataviewModel.getData(),e=n.isEmpty(t)||0===n.size(t);return this.$el.html(h({title:this.model.get("title"),itemsCount:e?"-":s.formatValue(t.length)})),e?this.$(".js-content").append(d()):this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:title",this.render),this.listenTo(this._dataviewModel,"change:data",this.render),this.add_related_model(this._dataviewModel)},_initViews:function(){this._list=new r({model:this.model,dataviewModel:this._dataviewModel}),this.$(".js-content").html(this._list.render().el),this.addView(this._list),(this._list.$el.get(0).scrollHeight-this._list.$el.outerHeight()>0||this.options.showScroll)&&(this._pagination=new o({$target:this._list.$el}),this.$(".js-footer").append(this._pagination.render().el),this.addView(this._pagination),this._edges=new l({$target:this._list.$el}),this.$(".js-content").append(this._edges.render().el),this.addView(this._edges))}})},564:function(t,e,i){var n=i(0),a=i(5);t.exports=a.core.View.extend({_TEMPLATE:' <div class="CDB-Widget-listEdge CDB-Widget-listEdge--top"><div class="CDB-Widget-listEdgeShadow js-topShadow"></div><div class="CDB-Widget-listEdgeBorder"></div></div><div class="CDB-Widget-listEdge CDB-Widget-listEdge--bottom"><div class="CDB-Widget-listEdgeShadow js-bottomShadow"></div><div class="CDB-Widget-listEdgeBorder"></div></div>',initialize:function(){this._$target=this.options.$target,this._initBinds()},render:function(){this.clearSubViews();var t=n.template(this._TEMPLATE);return this.$el.html(t()),this._checkScroll(),this},_initBinds:function(){var t=this;this._$target.bind("scroll",function(){t._checkScroll()})},_unbindScroll:function(){this._$target.unbind("scroll")},_checkScroll:function(){var t=this._$target.scrollTop(),e=this._$target.get(0).scrollHeight-this._$target.outerHeight();this.$(".js-topShadow").toggle(0!==t),this.$(".js-bottomShadow").toggle(t!==e)},clean:function(){this._unbindScroll(),a.core.View.prototype.clean.call(this)}})},565:function(t,e,i){var n=i(0),a=i(22),s=i(5),r=i(797);t.exports=s.core.View.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(){this._widgetModel=this.options.widgetModel,this._dataviewModel=this.options.dataviewModel},render:function(){var t=this.model.toJSON(),e=this._hasInteractivity(t),i=this._sanitizeData(t);return this.$el.html(r({items:i,isClickable:e,itemsCount:n.size(i)})),this[e?"delegateEvents":"undelegateEvents"](),this},_sanitizeData:function(t){var e=this._hasInteractivity(t);t=n.omit(t,function(t,e,i){return"cartodb_id"===e});var i=this._widgetModel.get("columns_title");e&&!n.isEmpty(i)&&(i=n.rest(i,1));var s=[],r=0;return n.each(t,function(t,e){var n=i&&i[r]||e;s.push([n,a.formatValue(t)]),++r}),s},_hasInteractivity:function(t){return!n.isEmpty(n.filter(t,function(t,e){return"cartodb_id"===e}))},_onItemClick:function(){this.trigger("itemClicked",this.model,this)}})},566:function(t,e,i){var n=i(5),a=i(565);t.exports=n.core.View.extend({className:"CDB-Widget-list js-list",tagName:"ul",events:{scroll:"_checkScroll"},initialize:function(t){this._dataviewModel=t.dataviewModel},render:function(){return this.clearSubViews(),this._renderList(),this},_renderList:function(){this._dataviewModel.getData().each(this._addItem,this)},_addItem:function(t){var e=new a({model:t,widgetModel:this.model,dataviewModel:this._dataviewModel});e.bind("itemClicked",function(){this.trigger("itemClicked",t,this)},this),this.addView(e),this.$el.append(e.render().el)}})},567:function(t,e,i){var n=i(3),a=i(0),s=i(5);t.exports=s.core.View.extend({className:"CDB-Widget-nav CDB-Widget-contentSpaced",_TEMPLATE:' <span></span><div class="CDB-Widget-navArrows CDB-Widget-contentSpaced"><button class="CDB-Shape-arrow CDB-Shape-arrow--up js-up"></button><button class="CDB-Shape-arrow CDB-Shape-arrow--down js-down"></button></div>',events:{"click .js-up":"_scrollUp","click .js-down":"_scrollDown"},initialize:function(){if(!this.options.$target)throw new Error("target should be defined in order to be able to paginate");this._$target=this.options.$target,this._scrollHeight=this._$target.get(0).scrollHeight-this._$target.outerHeight(),this._initBinds()},render:function(){var t=a.template(this._TEMPLATE);return this.$el.html(t()),this._checkScroll(),this},_initBinds:function(){var t=this;this._$target.bind("scroll",function(){t._checkScroll()})},_unbindScroll:function(){this._$target.unbind("scroll")},_checkScroll:function(){var t=this._$target.scrollTop();this.$(".js-up").toggleClass("is-disabled",0===t),this.$(".js-down").toggleClass("is-disabled",t>=this._scrollHeight)},_getEdgeVisibleItems:function(){var t=this._$target.outerHeight(),e=null,i=null,a=this._$target.children(".CDB-Widget-listItem");return a.each(function(s,r){var o=n(this).position().top,l=n(this).outerHeight();o>-1&&null===e?e=this:o+l>t&&null===i&&(i=a[s-1])}),[e,i]},_scrollDown:function(){var t=this._getEdgeVisibleItems()[1],e=this._$target.scrollTop(),i=n(t).next();if(i.length){var a=i.position().top,s=i.outerHeight(),r=a+s-this._$target.outerHeight()+e;r>0&&this._$target.scrollTop(r)}},_scrollUp:function(){var t=this._getEdgeVisibleItems()[0],e=this._$target.scrollTop(),i=n(t).prev();if(i.length){var a=i.position().top,s=e+a;this._$target.scrollTop(s)}},clean:function(){this._unbindScroll(),s.core.View.prototype.clean.call(this)}})},568:function(t,e,i){var n=i(0),a=i(5),s=i(277),r=i(800),o=i(252),l=i(253),h=i(48);t.exports=a.core.View.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){this._dataviewModel=this.model.dataviewModel,this._originalData=this.model.dataviewModel.getUnfilteredDataModel(),this._selectedAmount=0,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._isDataEmpty()?this.$el.append(s({hasTorqueLayer:!1})):(this.$el.append(r()),this._createHistogramView(),this._createHeaderView(),this._createDropdownView(),this._updateRange()),this},_initBinds:function(){this._originalData.once("change:data",this._onOriginalDataChange,this),this._dataviewModel.once("error",function(){console.log("the tiler does not support non-torque layers just yet")}),this._dataviewModel.once("change:data",this.render,this),this._dataviewModel.bind("change:bins",this._onChangeBins,this),this.add_related_model(this._dataviewModel),this.add_related_model(this._originalData)},_createHistogramView:function(){this._histogramView&&this._histogramView.remove(),this._histogramView=new o({timeSeriesModel:this.model,model:this._dataviewModel,rangeFilter:this._dataviewModel.filter,displayShadowBars:!this.model.get("normalized"),normalized:!!this.model.get("normalized")}),this.addView(this._histogramView),this.$(".js-content").append(this._histogramView.render().el)},_createHeaderView:function(){if(this._headerView&&this._headerView.remove(),this._headerView=new l({dataviewModel:this._dataviewModel,rangeFilter:this._dataviewModel.filter,timeSeriesModel:this.model,showClearButton:!0,selectedAmount:this._selectedAmount}),!this._histogramView)throw new Error("Histogram view must be instantiated before the header view");this._headerView.bind("resetFilter",this._histogramView.resetFilter,this._histogramView),this.addView(this._headerView),this.$(".js-header").append(this._headerView.render().el)},_createDropdownView:function(){this._dropdownView&&this._dropdownView.remove(),this._dropdownView=new h({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{normalizeHistogram:!0,canCollapse:!1}}),this.addView(this._dropdownView)},_updateRange:function(){var t=this._calculateBars(),e=t.loBarIndex,i=t.hiBarIndex;0===e&&i===this._dataviewModel.get("bins")||this._histogramView.selectRange(e,i)},_setRange:function(t,e){var i=this._dataviewModel.getData(),n=this._dataviewModel.filter;i&&i.length&&t&&e&&n.setRange(i[t].start,i[e-1].end)},_calculateBars:function(){var t,e,i=this._dataviewModel.getData(),a=this.model.get("min"),s=this.model.get("max"),r=this.model.get("lo_index"),o=this.model.get("hi_index");return i.length>0?(n.isNumber(a)||n.isNumber(r)?n.isNumber(a)&&!n.isNumber(r)&&(t=n.findWhere(i,{start:a}),r=t&&t.bin||0):r=0,n.isNumber(s)||n.isNumber(o)?n.isNumber(s)&&!n.isNumber(o)&&(e=n.findWhere(i,{end:s}),o=e&&e.bin+1||i.length):o=i.length):(r=0,o=i.length),{loBarIndex:r,hiBarIndex:o}},_appendView:function(t){this.addView(t),this.$el.append(t.render().el)},_isDataEmpty:function(){var t=this._dataviewModel.getData();return n.isEmpty(t)||0===n.size(t)},_onOriginalDataChange:function(){this._dataviewModel.fetch()},_onChangeBins:function(t,e){this._originalData.setBins(e)}})},569:function(t,e,i){var n=i(72),a=i(0);t.exports=n.extend({defaults:{normalized:!0},defaultState:a.extend({normalized:!1},n.prototype.defaultState),getState:function(){var t,e,i=n.prototype.getState.call(this),s=this.dataviewModel.get("start"),r=this.dataviewModel.get("end"),o=this.dataviewModel.get("data"),l=this.get("lo_index"),h=this.get("hi_index"),d=function(t,e){return!!(a.isNumber(t)&&a.isNumber(e)&&t!==e&&Math.abs(t-e)>.01*Math.abs(s-r))};return a.isNumber(l)&&a.isNumber(h)?(t=o[l].start,e=o[h-1].end):(t=s,e=r),d(s,t)&&(i.min=t),d(r,e)&&(i.max=e),i}})},570:function(t,e,i){var n=i(0),a=i(5),s=i(805),r=i(277),o=i(573),l=i(572),h=i(48);t.exports=a.core.View.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){this._dataviewModel=this.model.dataviewModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._selectedAmount=0,this._initBinds()},render:function(){return this.clearSubViews(),this._isDataEmpty()?this.$el.html(r({hasTorqueLayer:!0})):(this.$el.html(s()),this._createHeaderView(),this._createTorqueHistogramView(),this._createDropdownView()),this},_createHeaderView:function(){this._headerView&&this._headerView.remove(),this._headerView=new l({el:this.$(".js-torque-header"),dataviewModel:this._dataviewModel,torqueLayerModel:this._dataviewModel.layer,timeSeriesModel:this.model,selectedAmount:this._selectedAmount}),this.addView(this._headerView),this._headerView.render()},_createTorqueHistogramView:function(){this._histogramView&&this._histogramView.remove(),this._histogramView=new o({timeSeriesModel:this.model,model:this._dataviewModel,rangeFilter:this._dataviewModel.filter,torqueLayerModel:this._dataviewModel.layer,displayShadowBars:!this.model.get("normalized"),normalized:!!this.model.get("normalized")}),this.addView(this._histogramView),this.$el.append(this._histogramView.render().el)},_createDropdownView:function(){this._dropdownView&&this._dropdownView.remove(),this._dropdownView=new h({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{normalizeHistogram:!!this.model.get("normalized"),canCollapse:!1}}),this.addView(this._dropdownView)},_initBinds:function(){this._originalData.once("change:data",this._onOriginalDataChange,this),this.add_related_model(this._originalData),this._dataviewModel.once("change:data",this.render,this),this._dataviewModel.bind("change:bins",this._onChangeBins,this),this.add_related_model(this._dataviewModel)},_isDataEmpty:function(){var t=this._dataviewModel.getData();return n.isEmpty(t)||0===n.size(t)},_onOriginalDataChange:function(){this._dataviewModel.fetch()},_onChangeBins:function(t,e){this._originalData.setBins(e)}})},571:function(t,e,i){var n=i(5),a=i(802);t.exports=n.core.View.extend({tagName:"button",className:"CDB-Widget-controlButton",events:{click:"_onClick"},initialize:function(){this._torqueLayerModel=this.options.torqueLayerModel,this._torqueLayerModel.bind("change:isRunning",this.render,this),this.add_related_model(this._torqueLayerModel)},render:function(){return this.$el.html(a({iconClass:"CDB-Widget-controlButtonIcon CDB-Widget-controlButtonIcon--"+(this._torqueLayerModel.get("isRunning")?"pause":"play")})),this},_onClick:function(){this._torqueLayerModel.get("isRunning")?this._torqueLayerModel.pause():this._torqueLayerModel.play()}})},572:function(t,e,i){var n=i(5),a=i(571),s=i(574),r=i(253),o=i(803);t.exports=n.core.View.extend({className:"CDB-Widget-header CDB-Widget-contentSpaced",initialize:function(){this._dataviewModel=this.options.dataviewModel,this._torqueLayerModel=this.options.torqueLayerModel,this._rangeFilter=this._dataviewModel.filter,this._selectedAmount=this.options.selectedAmount,this._timeSeriesModel=this.options.timeSeriesModel,this.listenTo(this._rangeFilter,"change",this.render)},render:function(){var t=!0;return this.clearSubViews(),this.$el.addClass(this.className),this.$el.html(o()),this._rangeFilter.isEmpty()&&(this._appendView(".js-torque-controls",new a({torqueLayerModel:this._torqueLayerModel})),this._appendView(".js-torque-controls",new s({dataviewModel:this._dataviewModel,torqueLayerModel:this._torqueLayerModel})),t=!1),this._createTimeSeriesHeaderView(t),this},_createTimeSeriesHeaderView:function(t){var e=new r({dataviewModel:this._dataviewModel,rangeFilter:this._dataviewModel.filter,showClearButton:t,timeSeriesModel:this._timeSeriesModel,selectedAmount:this._selectedAmount});this._appendView(".js-time-series-header",e),e.on("resetFilter",this._resetFilter,this)},_resetFilter:function(){this._torqueLayerModel.set({step:0}),this._torqueLayerModel.resetRenderRange()},_appendView:function(t,e){this.addView(e),this.$(t).append(e.render().el)}})},573:function(t,e,i){var n=i(252),a=i(575);t.exports=n.extend({className:"CDB-Widget-content CDB-Widget-content--timeSeries",initialize:function(){if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");if(!this.options.rangeFilter)throw new Error("rangeFilter is required");this._torqueLayerModel=this.options.torqueLayerModel,n.prototype.initialize.call(this)},_initBinds:function(){n.prototype._initBinds.call(this),this._torqueLayerModel.bind("change:renderRange",this._onRenderRangeChanged,this),this._torqueLayerModel.bind("change:steps change:start change:end",this._reSelectRange,this),this.add_related_model(this._torqueLayerModel)},_createHistogramView:function(){this._chartType="date"===this._torqueLayerModel.get("column_type")?"time":"number",n.prototype._createHistogramView.call(this),this._chartView.setAnimated(),this._chartView.bind("on_brush_click",this._onBrushClick,this);var t=new a({dataviewModel:this.model,chartView:this._chartView,torqueLayerModel:this._torqueLayerModel});this.addView(t),t.render()},_onChangeData:function(){n.prototype._onChangeData.call(this),this._chartView&&this._reSelectRange()},_onRenderRangeChanged:function(t,e){void 0===e.start&&void 0===e.end&&(this._chartView.removeSelection(),this._rangeFilter.unsetRange())},_onBrushClick:function(t){var e=this._torqueLayerModel.get("steps"),i=Math.round(e*t);i===e&&(i-=1),n.prototype.resetFilter.apply(this),this._torqueLayerModel.set({step:i})},_onBrushEnd:function(){n.prototype._onBrushEnd.apply(this,arguments),this._reSelectRange()},_timeToStep:function(t){var e=this._torqueLayerModel.get("steps"),i=this._torqueLayerModel.get("start");return e*(1e3*t-i)/(this._torqueLayerModel.get("end")-i)},_reSelectRange:function(){if(!this._rangeFilter.isEmpty()){var t=this._timeToStep(this._rangeFilter.get("min")),e=this._timeToStep(this._rangeFilter.get("max")),i=this._torqueLayerModel.get("steps");this._torqueLayerModel.renderRange(this._clampRangeVal(0,i,t),this._clampRangeVal(0,i,e))}},_clampRangeVal:function(t,e,i){return Math.max(t,Math.min(e,i))}})},574:function(t,e,i){var n=i(31),a=i(5),s=i(806),r=i(804),o={number:n.format(",.0f"),time:n.time.format("%H:%M"),date:n.time.format("%x")};t.exports=a.core.View.extend({className:"CDB-Widget-timeSeriesTimeInfo",initialize:function(t){if(!t.torqueLayerModel)throw new Error("torqueLayerModel is required");if(!t.dataviewModel)throw new Error("dataviewModel is required");this._torqueLayerModel=this.options.torqueLayerModel,this._dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){var t=this._dataviewModel.get("data"),e=this._torqueLayerModel.get("time"),i=this._torqueLayerModel.get("step"),a=this._torqueLayerModel.get("column_type"),l="number"===a?r:s,h=n.scale.linear().domain([0,t.length]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]),d="";return"number"===a?d=l({number:o.number(h(i))}):"date"!==a||isNaN(e&&e.getTime())||(d=l({time:o.time(e),date:o.date(e)})),this.$el.html(d),this},_initBinds:function(){this._torqueLayerModel.bind("change:step",this.render,this),this.add_related_model(this._torqueLayerModel)}})},575:function(t,e,i){var n=i(31),a=i(5);t.exports=a.core.View.extend({defaults:{width:6,height:8},initialize:function(){if(!this.options.chartView)throw new Error("chartView is required");if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");this.model=new a.core.Model,this._dataviewModel=this.options.dataviewModel,this._chartView=this.options.chartView,this._torqueLayerModel=this.options.torqueLayerModel,this._initBinds(),this._updateXScale()},render:function(){if(!this.timeSlider){var t=n.behavior.drag().on("dragstart",this._onDragStart.bind(this)).on("drag",this._onDrag.bind(this)).on("dragend",this._onDragEnd.bind(this)),e=this._chartView.canvas.append("rect");this.timeSlider=e.attr("class","CDB-TimeSlider").attr("width",this.defaults.width).attr("height",this._calcHeight()).attr("rx",3).attr("ry",3).data([{x:0,y:0}]).attr("transform",this._translateXY).call(t)}return this.setElement(e.node()),this},_initBinds:function(){this._torqueLayerModel.bind("change:start change:end",this._updateChartandTimeslider,this),this._torqueLayerModel.bind("change:step",this._onChangeStep,this),this._torqueLayerModel.bind("change:steps",this._updateChartandTimeslider,this),this.add_related_model(this._torqueLayerModel),this._chartView.model.bind("change:width",this._updateChartandTimeslider,this),this._chartView.model.bind("change:height",this._onChangeChartHeight,this),this.add_related_model(this._chartView.model),this._dataviewModel.on("change:bins",this._updateChartandTimeslider,this),this.add_related_model(this._dataviewModel),this._dataviewModel.filter.on("change:min change:max",this._onFilterMinMaxChange,this),this.add_related_model(this._dataviewModel.filter)},clean:function(){this.timeSlider&&this.timeSlider.remove(),a.core.View.prototype.clean.call(this)},_onDragStart:function(){var t=this._torqueLayerModel.get("isRunning");t&&this._torqueLayerModel.pause(),this.model.set({isDragging:!0,wasRunning:t})},_onDrag:function(t,e){var i=t.x+n.event.dx;if(this._isWithinRange(i)){t.x=i,this.timeSlider.attr("transform",this._translateXY);var a=Math.round(this._xScale.invert(t.x));this._torqueLayerModel.setStep(a)}},_onDragEnd:function(){this.model.set("isDragging",!1),this.model.get("wasRunning")&&this._torqueLayerModel.play()},_translateXY:function(t){return"translate("+[t.x,t.y]+")"},_isWithinRange:function(t){return t>=0&&t<=this._width()},_onChangeStep:function(){if(this.timeSlider&&!this.model.get("isDragging")){var t=this.timeSlider.data(),e=this._xScale(this._torqueLayerModel.get("step"));isNaN(e)||(t[0].x=e,this.timeSlider.data(t).transition().ease("linear").attr("transform",this._translateXY))}},_onFilterMinMaxChange:function(t,e){this.$el.toggle(!e)},_onChangeChartHeight:function(){this.timeSlider.attr("height",this._calcHeight())},_updateChartandTimeslider:function(){this._updateXScale(),this._onChangeStep()},_calcHeight:function(){return this._chartView.chartHeight()+this.defaults.height},_updateXScale:function(){var t=1e3*(this._dataviewModel.get("end")-this._dataviewModel.get("start")),e=(this._torqueLayerModel.get("start")-1e3*this._dataviewModel.get("start"))/t,i=(this._torqueLayerModel.get("end")-1e3*this._dataviewModel.get("start"))/t;this._xScale=n.scale.linear().domain([0,this._torqueLayerModel.get("steps")]).range([e*this._width(),i*this._width()])},_width:function(){return this._chartView.model.get("width")}})},576:function(t,e,i){var n=i(5),a=i(807);t.exports=n.core.View.extend({className:"CDB-Widget-error is-hidden",events:{"click .js-refresh":"_onRefreshClick"},initialize:function(){this._initBinds()},render:function(){return this.$el.html(a()),this},_initBinds:function(){this.model.bind("error",function(t,e){(!e||e&&"abort"!==e.statusText)&&this.show()},this),this.model.bind("loading loaded",this.hide,this)},_onRefreshClick:function(){this.model.refresh()},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})},577:function(t,e,i){var n=i(5);t.exports=n.core.View.extend({className:"CDB-Widget-loader",initialize:function(){this._initBinds()},render:function(){return this.$el.append('<div class="CDB-Loader js-loader"></div>'),this},show:function(){this.$(".js-loader").addClass("is-visible"),clearTimeout(this._timeout)},hide:function(){var t=this;this._timeout=setTimeout(function(){t.$(".js-loader").removeClass("is-visible")},500)},_initBinds:function(){this.model.bind("loading",this.show,this),this.model.bind("error",function(t,e){(!e||e&&"abort"!==e.statusText)&&this.hide()},this),this.model.bind("loaded",this.hide,this)}})},578:function(t,e,i){var n=i(5),a=i(577),s=i(576);t.exports=n.core.View.extend({className:"CDB-Widget CDB-Widget--light",options:{columns_title:[]},initialize:function(){this.listenTo(this.model,"destroy",this.clean)},render:function(){var t=this.model.dataviewModel;return t&&(this._appendView(new a({model:t})),this._appendView(new s({model:t}))),this._appendView(this.options.contentView),this},_appendView:function(t){this.$el.append(t.render().el),this.addView(t)}})},579:function(t,e,i){var n=i(0),a=i(1);t.exports=a.Collection.extend({comparator:"order",initialize:function(){this._allDataviewsFetched=!1,this._initBinds()},_initBinds:function(){this.bind("change:order",n.debounce(this._onChangeOrder.bind(this),10),this),this.bind("change:autoStyle",function(t,e){e&&this.each(function(e){e.dataviewModel&&e!==t&&e.dataviewModel.layer.get("layer_name")===t.dataviewModel.layer.get("layer_name")&&e.get("autoStyle")&&e.set("autoStyle",!1)})},this)},_onChangeOrder:function(){this.sort(),this.trigger("orderChanged",this)},getStates:function(){var t={};return this.each(function(e){var i=e.getState();n.isEmpty(i)||(t[e.get("id")]=i)}),t},setStates:function(t){for(var e in t)this.at(e).setState(t[e])},hasInitialState:function(){return this._allDataviewsFetched},initialState:function(){this._allDataviewsFetched=!0}})},582:function(t,e,i){"use strict";function n(t){if(t instanceof s)return new s(t.h,t.s,t.l,t.opacity);t instanceof o.a||(t=i.i(o.b)(t));var e=t.r/255,n=t.g/255,a=t.b/255,r=(f*a+p*e-_*n)/(f+p-_),h=a-r,d=(g*(n-r)-c*h)/u,m=Math.sqrt(d*d+h*h)/(g*r*(1-r)),v=m?Math.atan2(d,h)*l.a-120:NaN;return new s(v<0?v+360:v,m,r,t.opacity)}function a(t,e,i,a){return 1===arguments.length?n(t):new s(t,e,i,null==a?1:a)}function s(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}var r=i(105),o=i(104),l=i(256);e.a=a;var h=-.14861,d=1.78277,c=-.29227,u=-.90649,g=1.97294,p=g*u,_=g*d,f=d*c-u*h;i.i(r.a)(s,a,i.i(r.b)(o.c,{brighter:function(t){return t=null==t?o.d:Math.pow(o.d,t),new s(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?o.e:Math.pow(o.e,t),new s(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*l.b,e=+this.l,i=isNaN(this.s)?0:this.s*e*(1-e),n=Math.cos(t),a=Math.sin(t);return new o.a(255*(e+i*(h*n+d*a)),255*(e+i*(c*n+u*a)),255*(e+i*(g*n)),this.opacity)}}))},583:function(t,e,i){"use strict";function n(t){if(t instanceof s)return new s(t.l,t.a,t.b,t.opacity);if(t instanceof u){var e=t.h*_.b;return new s(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof p.a||(t=i.i(p.b)(t));var n=h(t.r),a=h(t.g),o=h(t.b),l=r((.4124564*n+.3575761*a+.1804375*o)/f),d=r((.2126729*n+.7151522*a+.072175*o)/m);return new s(116*d-16,500*(l-d),200*(d-r((.0193339*n+.119192*a+.9503041*o)/v)),t.opacity)}function a(t,e,i,a){return 1===arguments.length?n(t):new s(t,e,i,null==a?1:a)}function s(t,e,i,n){this.l=+t,this.a=+e,this.b=+i,this.opacity=+n}function r(t){return t>y?Math.pow(t,1/3):t/C+b}function o(t){return t>w?t*t*t:C*(t-b)}function l(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function h(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function d(t){if(t instanceof u)return new u(t.h,t.c,t.l,t.opacity);t instanceof s||(t=n(t));var e=Math.atan2(t.b,t.a)*_.a;return new u(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function c(t,e,i,n){return 1===arguments.length?d(t):new u(t,e,i,null==n?1:n)}function u(t,e,i,n){this.h=+t,this.c=+e,this.l=+i,this.opacity=+n}var g=i(105),p=i(104),_=i(256);e.b=a,e.a=c;var f=.95047,m=1,v=1.08883,b=4/29,w=6/29,C=3*w*w,y=w*w*w;i.i(g.a)(s,a,i.i(g.b)(p.c,{brighter:function(t){return new s(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new s(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,i=isNaN(this.b)?t:t-this.b/200;return t=m*o(t),e=f*o(e),i=v*o(i),new p.a(l(3.2404542*e-1.5371385*t-.4985314*i),l(-.969266*e+1.8760108*t+.041556*i),l(.0556434*e-.2040259*t+1.0572252*i),this.opacity)}})),i.i(g.a)(u,c,i.i(g.b)(p.c,{brighter:function(t){return new u(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new u(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return n(this).rgb()}}))},584:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(107);i.d(e,"interpolate",function(){return n.a});var a=i(257);i.d(e,"interpolateArray",function(){return a.a});var s=i(106);i.d(e,"interpolateBasis",function(){return s.a});var r=i(258);i.d(e,"interpolateBasisClosed",function(){return r.a});var o=i(260);i.d(e,"interpolateDate",function(){return o.a});var l=i(73);i.d(e,"interpolateNumber",function(){return l.a});var h=i(261);i.d(e,"interpolateObject",function(){return h.a});var d=i(590);i.d(e,"interpolateRound",function(){return d.a});var c=i(263);i.d(e,"interpolateString",function(){return c.a});var u=i(592);i.d(e,"interpolateTransformCss",function(){return u.a}),i.d(e,"interpolateTransformSvg",function(){return u.b});var g=i(594);i.d(e,"interpolateZoom",function(){return g.a});var p=i(262);i.d(e,"interpolateRgb",function(){return p.a}),i.d(e,"interpolateRgbBasis",function(){return p.b}),i.d(e,"interpolateRgbBasisClosed",function(){return p.c});var _=i(587);i.d(e,"interpolateHsl",function(){return _.a}),i.d(e,"interpolateHslLong",function(){return _.b});var f=i(588);i.d(e,"interpolateLab",function(){return f.a});var m=i(586);i.d(e,"interpolateHcl",function(){return m.a}),i.d(e,"interpolateHclLong",function(){return m.b});var v=i(585);i.d(e,"interpolateCubehelix",function(){return v.a}),i.d(e,"interpolateCubehelixLong",function(){return v.b});var b=i(589);i.d(e,"quantize",function(){return b.a})},585:function(t,e,i){"use strict";function n(t){return function e(n){function r(e,r){var o=t((e=i.i(a.a)(e)).h,(r=i.i(a.a)(r)).h),l=i.i(s.a)(e.s,r.s),h=i.i(s.a)(e.l,r.l),d=i.i(s.a)(e.opacity,r.opacity);return function(t){return e.h=o(t),e.s=l(t),e.l=h(Math.pow(t,n)),e.opacity=d(t),e+""}}return n=+n,r.gamma=e,r}(1)}var a=i(37),s=i(49);i.d(e,"b",function(){return r}),e.a=n(s.b);var r=n(s.a)},586:function(t,e,i){"use strict";function n(t){return function(e,n){var r=t((e=i.i(a.b)(e)).h,(n=i.i(a.b)(n)).h),o=i.i(s.a)(e.c,n.c),l=i.i(s.a)(e.l,n.l),h=i.i(s.a)(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=o(t),e.l=l(t),e.opacity=h(t),e+""}}}var a=i(37),s=i(49);i.d(e,"b",function(){return r}),e.a=n(s.b);var r=n(s.a)},587:function(t,e,i){"use strict";function n(t){return function(e,n){var r=t((e=i.i(a.d)(e)).h,(n=i.i(a.d)(n)).h),o=i.i(s.a)(e.s,n.s),l=i.i(s.a)(e.l,n.l),h=i.i(s.a)(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=o(t),e.l=l(t),e.opacity=h(t),e+""}}}var a=i(37),s=i(49);i.d(e,"b",function(){return r}),e.a=n(s.b);var r=n(s.a)},588:function(t,e,i){"use strict";function n(t,e){var n=i.i(s.a)((t=i.i(a.c)(t)).l,(e=i.i(a.c)(e)).l),r=i.i(s.a)(t.a,e.a),o=i.i(s.a)(t.b,e.b),l=i.i(s.a)(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=r(e),t.b=o(e),t.opacity=l(e),t+""}}var a=i(37),s=i(49);e.a=n},589:function(t,e,i){"use strict";e.a=function(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t(n/(e-1));return i}},590:function(t,e,i){"use strict";e.a=function(t,e){return t=+t,e-=t,function(i){return Math.round(t+e*i)}}},591:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var n=180/Math.PI,a={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};e.b=function(t,e,i,a,s,r){var o,l,h;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(h=t*i+e*a)&&(i-=t*h,a-=e*h),(l=Math.sqrt(i*i+a*a))&&(i/=l,a/=l,h/=l),t*a<e*i&&(t=-t,e=-e,h=-h,o=-o),{translateX:s,translateY:r,rotate:Math.atan2(e,t)*n,skewX:Math.atan(h)*n,scaleX:o,scaleY:l}}},592:function(t,e,i){"use strict";function n(t,e,n,s){function r(t){return t.length?t.pop()+" ":""}function o(t,s,r,o,l,h){if(t!==r||s!==o){var d=l.push("translate(",null,e,null,n);h.push({i:d-4,x:i.i(a.a)(t,r)},{i:d-2,x:i.i(a.a)(s,o)})}else(r||o)&&l.push("translate("+r+e+o+n)}function l(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(r(n)+"rotate(",null,s)-2,x:i.i(a.a)(t,e)})):e&&n.push(r(n)+"rotate("+e+s)}function h(t,e,n,o){t!==e?o.push({i:n.push(r(n)+"skewX(",null,s)-2,x:i.i(a.a)(t,e)}):e&&n.push(r(n)+"skewX("+e+s)}function d(t,e,n,s,o,l){if(t!==n||e!==s){var h=o.push(r(o)+"scale(",null,",",null,")");l.push({i:h-4,x:i.i(a.a)(t,n)},{i:h-2,x:i.i(a.a)(e,s)})}else 1===n&&1===s||o.push(r(o)+"scale("+n+","+s+")")}return function(e,i){var n=[],a=[];return e=t(e),i=t(i),o(e.translateX,e.translateY,i.translateX,i.translateY,n,a),l(e.rotate,i.rotate,n,a),h(e.skewX,i.skewX,n,a),d(e.scaleX,e.scaleY,i.scaleX,i.scaleY,n,a),e=i=null,function(t){for(var e,i=-1,s=a.length;++i<s;)n[(e=a[i]).i]=e.x(t);return n.join("")}}}var a=i(73),s=i(593);i.d(e,"a",function(){return r}),i.d(e,"b",function(){return o});var r=n(s.a,"px, ","px)","deg)"),o=n(s.b,", ",")",")")},593:function(t,e,i){"use strict";function n(t){return"none"===t?s.a:(r||(r=document.createElement("DIV"),o=document.documentElement,l=document.defaultView),r.style.transform=t,t=l.getComputedStyle(o.appendChild(r),null).getPropertyValue("transform"),o.removeChild(r),t=t.slice(7,-1).split(","),i.i(s.b)(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}function a(t){return null==t?s.a:(h||(h=document.createElementNS("http://www.w3.org/2000/svg","g")),h.setAttribute("transform",t),(t=h.transform.baseVal.consolidate())?(t=t.matrix,i.i(s.b)(t.a,t.b,t.c,t.d,t.e,t.f)):s.a)}var s=i(591);e.a=n,e.b=a;var r,o,l,h},594:function(t,e,i){"use strict";function n(t){return((t=Math.exp(t))+1/t)/2}function a(t){return((t=Math.exp(t))-1/t)/2}function s(t){return((t=Math.exp(2*t))-1)/(t+1)}var r=Math.SQRT2;e.a=function(t,e){var i,o,l=t[0],h=t[1],d=t[2],c=e[0],u=e[1],g=e[2],p=c-l,_=u-h,f=p*p+_*_;if(f<1e-12)o=Math.log(g/d)/r,i=function(t){return[l+t*p,h+t*_,d*Math.exp(r*t*o)]};else{var m=Math.sqrt(f),v=(g*g-d*d+4*f)/(2*d*2*m),b=(g*g-d*d-4*f)/(2*g*2*m),w=Math.log(Math.sqrt(v*v+1)-v),C=Math.log(Math.sqrt(b*b+1)-b);o=(C-w)/r,i=function(t){var e=t*o,i=n(w),c=d/(2*m)*(i*s(r*e+w)-a(w));return[l+c*p,h+c*_,d*i/n(r*e+w)]}}return i.duration=1e3*o,i}},595:function(t,e,i){"use strict";var n=Object.prototype.hasOwnProperty,a=Object.prototype.toString,s=Array.prototype.slice,r=i(596),o=Object.prototype.propertyIsEnumerable,l=!o.call({toString:null},"toString"),h=o.call(function(){},"prototype"),d=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(t){var e=t.constructor;return e&&e.prototype===t},u={$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},g=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!u["$"+t]&&n.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{c(window[t])}catch(t){return!0}}catch(t){return!0}return!1}(),p=function(t){if("undefined"==typeof window||!g)return c(t);try{return c(t)}catch(t){return!1}},_=function(t){var e=null!==t&&"object"==typeof t,i="[object Function]"===a.call(t),s=r(t),o=e&&"[object String]"===a.call(t),c=[];if(!e&&!i&&!s)throw new TypeError("Object.keys called on a non-object");var u=h&&i;if(o&&t.length>0&&!n.call(t,0))for(var g=0;g<t.length;++g)c.push(String(g));if(s&&t.length>0)for(var _=0;_<t.length;++_)c.push(String(_));else for(var f in t)u&&"prototype"===f||!n.call(t,f)||c.push(String(f));if(l)for(var m=p(t),v=0;v<d.length;++v)m&&"constructor"===d[v]||!n.call(t,d[v])||c.push(d[v]);return c};_.shim=function(){if(Object.keys){if(!function(){return 2===(Object.keys(arguments)||"").length}(1,2)){var t=Object.keys;Object.keys=function(e){return t(r(e)?s.call(e):e)}}}else Object.keys=_;return Object.keys||_},t.exports=_},596:function(t,e,i){"use strict";var n=Object.prototype.toString;t.exports=function(t){var e=n.call(t),i="[object Arguments]"===e;return i||(i="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===n.call(t.callee)),i}},599:function(t,e,i){"use strict";var n=i(601),a=i(600),s=i(603),r=i(602),o=i(265),l=i(604),h={ToPrimitive:l,ToBoolean:function(t){return Boolean(t)},ToNumber:function(t){return Number(t)},ToInteger:function(t){var e=this.ToNumber(t);return n(e)?0:0!==e&&a(e)?s(e)*Math.floor(Math.abs(e)):e},ToInt32:function(t){return this.ToNumber(t)>>0},ToUint32:function(t){return this.ToNumber(t)>>>0},ToUint16:function(t){var e=this.ToNumber(t);if(n(e)||0===e||!a(e))return 0;var i=s(e)*Math.floor(Math.abs(e));return r(i,65536)},ToString:function(t){return String(t)},ToObject:function(t){return this.CheckObjectCoercible(t),Object(t)},CheckObjectCoercible:function(t,e){if(null==t)throw new TypeError(e||"Cannot call method on "+t);return t},IsCallable:o,SameValue:function(t,e){return t===e?0!==t||1/t==1/e:n(t)&&n(e)},Type:function(t){return null===t?"Null":void 0===t?"Undefined":"function"==typeof t||"object"==typeof t?"Object":"number"==typeof t?"Number":"boolean"==typeof t?"Boolean":"string"==typeof t?"String":void 0}};t.exports=h},600:function(t,e){var i=Number.isNaN||function(t){return t!==t};t.exports=Number.isFinite||function(t){return"number"==typeof t&&!i(t)&&t!==1/0&&t!==-1/0}},601:function(t,e){t.exports=Number.isNaN||function(t){return t!==t}},602:function(t,e){t.exports=function(t,e){var i=t%e;return Math.floor(i>=0?i:i+e)}},603:function(t,e){t.exports=function(t){return t>=0?1:-1}},604:function(t,e,i){"use strict";var n=Object.prototype.toString,a=i(605),s=i(265),r={"[[DefaultValue]]":function(t,e){var i=e||("[object Date]"===n.call(t)?String:Number);if(i===String||i===Number){var r,o,l=i===String?["toString","valueOf"]:["valueOf","toString"];for(o=0;o<l.length;++o)if(s(t[l[o]])&&(r=t[l[o]](),a(r)))return r;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")}};t.exports=function(t,e){return a(t)?t:r["[[DefaultValue]]"](t,e)}},605:function(t,e){t.exports=function(t){return null===t||"function"!=typeof t&&"object"!=typeof t}},606:function(t,e,i){function n(t,e,i){if(!o(e))throw new TypeError("iterator must be a function");arguments.length<3&&(i=this),"[object Array]"===l.call(t)?a(t,e,i):"string"==typeof t?s(t,e,i):r(t,e,i)}function a(t,e,i){for(var n=0,a=t.length;n<a;n++)h.call(t,n)&&e.call(i,t[n],n,t)}function s(t,e,i){for(var n=0,a=t.length;n<a;n++)e.call(i,t.charAt(n),n,t)}function r(t,e,i){for(var n in t)h.call(t,n)&&e.call(i,t[n],n,t)}var o=i(612);t.exports=n;var l=Object.prototype.toString,h=Object.prototype.hasOwnProperty},607:function(t,e){var i=Object.prototype.hasOwnProperty,n=Object.prototype.toString;t.exports=function(t,e,a){if("[object Function]"!==n.call(e))throw new TypeError("iterator must be a function");var s=t.length;if(s===+s)for(var r=0;r<s;r++)e.call(a,t[r],r,t);else for(var o in t)i.call(t,o)&&e.call(a,t[o],o,t)}},608:function(t,e){var i=Array.prototype.slice,n=Object.prototype.toString;t.exports=function(t){var e=this;if("function"!=typeof e||"[object Function]"!==n.call(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var a,s=i.call(arguments,1),r=function(){if(this instanceof a){var n=e.apply(this,s.concat(i.call(arguments)));return Object(n)===n?n:this}return e.apply(t,s.concat(i.call(arguments)))},o=Math.max(0,e.length-s.length),l=[],h=0;h<o;h++)l.push("$"+h);if(a=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(r),e.prototype){var d=function(){};d.prototype=e.prototype,a.prototype=new d,d.prototype=null}return a}},611:function(t,e,i){var n=i(108);t.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},612:function(t,e){function i(t){var e=n.call(t);return"[object Function]"===e||"function"==typeof t&&"[object RegExp]"!==e||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}t.exports=i;var n=Object.prototype.toString},650:function(t,e,i){"use strict";var n=i(108),a=i(264),s=i(270),r=i(271),o=i(651),l=n.call(Function.call,r());a(l,{getPolyfill:r,implementation:s,shim:o}),t.exports=l},651:function(t,e,i){"use strict";var n=i(264),a=i(271);t.exports=function(){var t=a();return n(String.prototype,{trim:t},{trim:function(){return String.prototype.trim!==t}}),t}},653:function(t,e,i){var n;!function(a){function s(t,e){if(t=t||"",e=e||{},t instanceof s)return t;if(!(this instanceof s))return new s(t,e);var i=r(t);this._originalInput=t,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=P(100*this._a)/100,this._format=e.format||i.format,this._gradientType=e.gradientType,this._r<1&&(this._r=P(this._r)),this._g<1&&(this._g=P(this._g)),this._b<1&&(this._b=P(this._b)),this._ok=i.ok,this._tc_id=H++}function r(t){var e={r:0,g:0,b:0},i=1,n=null,a=null,s=null,r=!1,l=!1;return"string"==typeof t&&(t=q(t)),"object"==typeof t&&(E(t.r)&&E(t.g)&&E(t.b)?(e=o(t.r,t.g,t.b),r=!0,l="%"===String(t.r).substr(-1)?"prgb":"rgb"):E(t.h)&&E(t.s)&&E(t.v)?(n=L(t.s),a=L(t.v),e=c(t.h,n,a),r=!0,l="hsv"):E(t.h)&&E(t.s)&&E(t.l)&&(n=L(t.s),s=L(t.l),e=h(t.h,n,s),r=!0,l="hsl"),t.hasOwnProperty("a")&&(i=t.a)),i=k(i),{ok:r,format:t.format||l,r:O(255,U(e.r,0)),g:O(255,U(e.g,0)),b:O(255,U(e.b,0)),a:i}}function o(t,e,i){return{r:255*j(t,255),g:255*j(e,255),b:255*j(i,255)}}function l(t,e,i){t=j(t,255),e=j(e,255),i=j(i,255);var n,a,s=U(t,e,i),r=O(t,e,i),o=(s+r)/2;if(s==r)n=a=0;else{var l=s-r;switch(a=o>.5?l/(2-s-r):l/(s+r),s){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:a,l:o}}function h(t,e,i){function n(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}var a,s,r;if(t=j(t,360),e=j(e,100),i=j(i,100),0===e)a=s=r=i;else{var o=i<.5?i*(1+e):i+e-i*e,l=2*i-o;a=n(l,o,t+1/3),s=n(l,o,t),r=n(l,o,t-1/3)}return{r:255*a,g:255*s,b:255*r}}function d(t,e,i){t=j(t,255),e=j(e,255),i=j(i,255);var n,a,s=U(t,e,i),r=O(t,e,i),o=s,l=s-r;if(a=0===s?0:l/s,s==r)n=0;else{switch(s){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:a,v:o}}function c(t,e,i){t=6*j(t,360),e=j(e,100),i=j(i,100);var n=a.floor(t),s=t-n,r=i*(1-e),o=i*(1-s*e),l=i*(1-(1-s)*e),h=n%6;return{r:255*[i,o,r,r,l,i][h],g:255*[l,i,i,o,r,r][h],b:255*[r,r,l,i,i,o][h]}}function u(t,e,i,n){var a=[V(P(t).toString(16)),V(P(e).toString(16)),V(P(i).toString(16))];return n&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function g(t,e,i,n,a){var s=[V(P(t).toString(16)),V(P(e).toString(16)),V(P(i).toString(16)),V(I(n))];return a&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function p(t,e,i,n){return[V(I(n)),V(P(t).toString(16)),V(P(e).toString(16)),V(P(i).toString(16))].join("")}function _(t,e){e=0===e?0:e||10;var i=s(t).toHsl();return i.s-=e/100,i.s=A(i.s),s(i)}function f(t,e){e=0===e?0:e||10;var i=s(t).toHsl();return i.s+=e/100,i.s=A(i.s),s(i)}function m(t){return s(t).desaturate(100)}function v(t,e){e=0===e?0:e||10;var i=s(t).toHsl();return i.l+=e/100,i.l=A(i.l),s(i)}function b(t,e){e=0===e?0:e||10;var i=s(t).toRgb();return i.r=U(0,O(255,i.r-P(-e/100*255))),i.g=U(0,O(255,i.g-P(-e/100*255))),i.b=U(0,O(255,i.b-P(-e/100*255))),s(i)}function w(t,e){e=0===e?0:e||10;var i=s(t).toHsl();return i.l-=e/100,i.l=A(i.l),s(i)}function C(t,e){var i=s(t).toHsl(),n=(i.h+e)%360;return i.h=n<0?360+n:n,s(i)}function y(t){var e=s(t).toHsl();return e.h=(e.h+180)%360,s(e)}function x(t){var e=s(t).toHsl(),i=e.h;return[s(t),s({h:(i+120)%360,s:e.s,l:e.l}),s({h:(i+240)%360,s:e.s,l:e.l})]}function S(t){var e=s(t).toHsl(),i=e.h;return[s(t),s({h:(i+90)%360,s:e.s,l:e.l}),s({h:(i+180)%360,s:e.s,l:e.l}),s({h:(i+270)%360,s:e.s,l:e.l})]}function B(t){var e=s(t).toHsl(),i=e.h;return[s(t),s({h:(i+72)%360,s:e.s,l:e.l}),s({h:(i+216)%360,s:e.s,l:e.l})]}function D(t,e,i){e=e||6,i=i||30;var n=s(t).toHsl(),a=360/i,r=[s(t)];for(n.h=(n.h-(a*e>>1)+720)%360;--e;)n.h=(n.h+a)%360,r.push(s(n));return r}function M(t,e){e=e||6;for(var i=s(t).toHsv(),n=i.h,a=i.s,r=i.v,o=[],l=1/e;e--;)o.push(s({h:n,s:a,v:r})),r=(r+l)%1;return o}function k(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function j(t,e){z(t)&&(t="100%");var i=T(t);return t=O(e,U(0,parseFloat(t))),i&&(t=parseInt(t*e,10)/100),a.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function A(t){return O(1,U(0,t))}function W(t){return parseInt(t,16)}function z(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)}function T(t){return"string"==typeof t&&-1!=t.indexOf("%")}function V(t){return 1==t.length?"0"+t:""+t}function L(t){return t<=1&&(t=100*t+"%"),t}function I(t){return a.round(255*parseFloat(t)).toString(16)}function F(t){return W(t)/255}function E(t){return!!Y.CSS_UNIT.exec(t)}function q(t){t=t.replace(N,"").replace(R,"").toLowerCase();var e=!1;if(Z[t])t=Z[t],e=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=Y.rgb.exec(t))?{r:i[1],g:i[2],b:i[3]}:(i=Y.rgba.exec(t))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=Y.hsl.exec(t))?{h:i[1],s:i[2],l:i[3]}:(i=Y.hsla.exec(t))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=Y.hsv.exec(t))?{h:i[1],s:i[2],v:i[3]}:(i=Y.hsva.exec(t))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=Y.hex8.exec(t))?{r:W(i[1]),g:W(i[2]),b:W(i[3]),a:F(i[4]),format:e?"name":"hex8"}:(i=Y.hex6.exec(t))?{r:W(i[1]),g:W(i[2]),b:W(i[3]),format:e?"name":"hex"}:(i=Y.hex4.exec(t))?{r:W(i[1]+""+i[1]),g:W(i[2]+""+i[2]),b:W(i[3]+""+i[3]),a:F(i[4]+""+i[4]),format:e?"name":"hex8"}:!!(i=Y.hex3.exec(t))&&{r:W(i[1]+""+i[1]),g:W(i[2]+""+i[2]),b:W(i[3]+""+i[3]),format:e?"name":"hex"}}function $(t){var e,i;return t=t||{level:"AA",size:"small"},e=(t.level||"AA").toUpperCase(),i=(t.size||"small").toLowerCase(),"AA"!==e&&"AAA"!==e&&(e="AA"),"small"!==i&&"large"!==i&&(i="small"),{level:e,size:i}}var N=/^\s+/,R=/\s+$/,H=0,P=a.round,O=a.min,U=a.max,Q=a.random;s.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,i,n,s,r,o=this.toRgb();return t=o.r/255,e=o.g/255,i=o.b/255,n=t<=.03928?t/12.92:a.pow((t+.055)/1.055,2.4),s=e<=.03928?e/12.92:a.pow((e+.055)/1.055,2.4),r=i<=.03928?i/12.92:a.pow((i+.055)/1.055,2.4),.2126*n+.7152*s+.0722*r},setAlpha:function(t){return this._a=k(t),this._roundA=P(100*this._a)/100,this},toHsv:function(){var t=d(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=d(this._r,this._g,this._b),e=P(360*t.h),i=P(100*t.s),n=P(100*t.v);return 1==this._a?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var t=l(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=l(this._r,this._g,this._b),e=P(360*t.h),i=P(100*t.s),n=P(100*t.l);return 1==this._a?"hsl("+e+", "+i+"%, "+n+"%)":"hsla("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHex:function(t){return u(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return g(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:P(this._r),g:P(this._g),b:P(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+P(this._r)+", "+P(this._g)+", "+P(this._b)+")":"rgba("+P(this._r)+", "+P(this._g)+", "+P(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:P(100*j(this._r,255))+"%",g:P(100*j(this._g,255))+"%",b:P(100*j(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+P(100*j(this._r,255))+"%, "+P(100*j(this._g,255))+"%, "+P(100*j(this._b,255))+"%)":"rgba("+P(100*j(this._r,255))+"%, "+P(100*j(this._g,255))+"%, "+P(100*j(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(G[u(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+p(this._r,this._g,this._b,this._a),i=e,n=this._gradientType?"GradientType = 1, ":"";if(t){var a=s(t);i="#"+p(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+i+")"},toString:function(t){var e=!!t;t=t||this._format;var i=!1,n=this._a<1&&this._a>=0;return e||!n||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(i=this.toRgbString()),"prgb"===t&&(i=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(i=this.toHexString()),"hex3"===t&&(i=this.toHexString(!0)),"hex4"===t&&(i=this.toHex8String(!0)),"hex8"===t&&(i=this.toHex8String()),"name"===t&&(i=this.toName()),"hsl"===t&&(i=this.toHslString()),"hsv"===t&&(i=this.toHsvString()),i||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return s(this.toString())},_applyModification:function(t,e){var i=t.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(v,arguments)},brighten:function(){return this._applyModification(b,arguments)},darken:function(){return this._applyModification(w,arguments)},desaturate:function(){return this._applyModification(_,arguments)},saturate:function(){return this._applyModification(f,arguments)},greyscale:function(){return this._applyModification(m,arguments)},spin:function(){return this._applyModification(C,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(D,arguments)},complement:function(){return this._applyCombination(y,arguments)},monochromatic:function(){return this._applyCombination(M,arguments)},splitcomplement:function(){return this._applyCombination(B,arguments)},triad:function(){return this._applyCombination(x,arguments)},tetrad:function(){return this._applyCombination(S,arguments)}},s.fromRatio=function(t,e){if("object"==typeof t){var i={};for(var n in t)t.hasOwnProperty(n)&&(i[n]="a"===n?t[n]:L(t[n]));t=i}return s(t,e)},s.equals=function(t,e){return!(!t||!e)&&s(t).toRgbString()==s(e).toRgbString()},s.random=function(){return s.fromRatio({r:Q(),g:Q(),b:Q()})},s.mix=function(t,e,i){i=0===i?0:i||50;var n=s(t).toRgb(),a=s(e).toRgb(),r=i/100;return s({r:(a.r-n.r)*r+n.r,g:(a.g-n.g)*r+n.g,b:(a.b-n.b)*r+n.b,a:(a.a-n.a)*r+n.a})},s.readability=function(t,e){var i=s(t),n=s(e);return(a.max(i.getLuminance(),n.getLuminance())+.05)/(a.min(i.getLuminance(),n.getLuminance())+.05)},s.isReadable=function(t,e,i){var n,a,r=s.readability(t,e);switch(a=!1,n=$(i),n.level+n.size){case"AAsmall":case"AAAlarge":a=r>=4.5;break;case"AAlarge":a=r>=3;break;case"AAAsmall":a=r>=7}return a},s.mostReadable=function(t,e,i){var n,a,r,o,l=null,h=0;i=i||{},a=i.includeFallbackColors,r=i.level,o=i.size;for(var d=0;d<e.length;d++)(n=s.readability(t,e[d]))>h&&(h=n,l=s(e[d]));return s.isReadable(t,l,{level:r,size:o})||!a?l:(i.includeFallbackColors=!1,s.mostReadable(t,["#fff","#000"],i))};var Z=s.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},G=s.hexNames=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[t[i]]=i);return e}(Z),Y=function(){var t="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",e="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",i="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+e),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+e),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+e),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();void 0!==t&&t.exports?t.exports=s:void 0!==(n=function(){return s}.call(e,i,e,t))&&(t.exports=n)}(Math)},71:function(t,e,i){var n=i(0),a=i(31),s=i(5);t.exports=s.core.View.extend({animateFromValues:function(t,e,i,s,r){var o=this.$(i),l=r||{},h=l.formatter||a.format("0,000"),d=l.templateData||{},c=l.debounceWait||500,u=e%1==0,g=function(t){t=u?Math.round(t):t;var e=n.isNaN(t)||void 0===t?l.defaultValue||0:h(t),i=n.extend({value:e},d);o.text(s(i))};if(0===l.animationSpeed)return void g(e);g(t),n.debounce(function(){o.prop("counter",t).stop().animate({counter:e},{duration:l.animationSpeed||500,easing:l.easingMethod||"swing",step:g})},c)()},animateFromCurrentValue:function(t,e,i,s){var r=this.$(e),o=s||{},l=o.debounceWait||500,h=t,d=+this.$(e).text(),c=o.formatter||a.format("0,000"),u=o.templateData||{},g=h%1==0,p=function(e){e=g?Math.round(e):e,t=n.isNaN(e)||void 0===e?o.defaultValue||0:c(e);var a=n.extend({value:t},u);r.text(i(a))};if(0===o.animationSpeed)return void p(h);p(d),n.debounce(function(){r.prop("counter",d).stop().animate({counter:h},{duration:o.animationSpeed||500,easing:o.easingMethod||"swing",step:p})},l)()},animateValue:function(t,e,i,s,r){var o=this.$(i),l=r||{},h=l.debounceWait||500,d=t.get(e),c=t.previous(e)||0,u=l.formatter||a.format("0,000"),g=l.templateData||{},p=d%1==0,_=function(t){t=p?Math.round(t):t;var e=n.isNaN(t)||void 0===t?l.defaultValue||0:u(t),i=n.extend({value:e},g);o.text(s(i))};if(0===l.animationSpeed)return void _(d);_(c),n.debounce(function(){o.prop("counter",c).stop().animate({counter:d},{duration:l.animationSpeed||500,easing:l.easingMethod||"swing",step:_})},h)()}})},72:function(t,e,i){var n=i(0),a=i(5),s=i(547);t.exports=a.core.Model.extend({defaults:{attrsNames:[],show_stats:!1,show_source:!1},defaultState:{collapsed:!1},initialize:function(t,e,i){i=i||{},this.dataviewModel=e.dataviewModel,this._autoStyleEnabledWhenCreated=void 0===i.autoStyleEnabled||i.autoStyleEnabled,this.activeAutoStyler(),this.bind("change:style",this.activeAutoStyler,this)},activeAutoStyler:function(){this.isAutoStyleEnabled()&&!this.autoStyler&&(this.autoStyler=s.get(this.dataviewModel,this.get("style")))},update:function(t){var e=n.pick(t,this.get("attrsNames"));return this.set(e),this.dataviewModel.update(t),this._triggerChangesInAutoStyle(),!(!this.changedAttributes()&&!this.dataviewModel.changedAttributes())},_triggerChangesInAutoStyle:function(){var t=this.changed&&this.changed.style&&this.changed.style.auto_style&&this.changed.style.auto_style.definition,e=this.previousAttributes(),i=e.style&&e.style.auto_style&&e.style.auto_style.definition;n.isEqual(t,i)||this.trigger("customAutoStyle",this)},remove:function(){this.dataviewModel.remove(),this.trigger("destroy",this),this.stopListening()},isAutoStyleEnabled:function(){var t=this.get("style");return("category"===this.get("type")||"histogram"===this.get("type"))&&(t&&t.auto_style?t&&t.auto_style&&t.auto_style.allowed:this._autoStyleEnabledWhenCreated)},getWidgetColor:function(){var t=this.get("style"),e=t&&t.widget_style,i=e&&e.definition&&e.definition.color&&e.definition.color.fixed;return(e&&e.widget_color_changed||e&&!e.widget_color_changed&&"#9DE0AD"!==i)&&i},hasColorsAutoStyle:function(){var t=this.getAutoStyle(),e=!1;return!(!t||n.isEmpty(t)||n.isEmpty(t.definition))&&(n.each(t.definition,function(t){t.color&&t.color.range&&t.color.range.length>0&&(e=!0)},this),e)},getColor:function(t){return this.isAutoStyleEnabled()&&this.isAutoStyle()&&"category"===this.get("type")?this.autoStyler.colors.getColorByCategory(t):this.getWidgetColor()},isAutoStyle:function(){return this.get("autoStyle")},autoStyle:function(){if(this.isAutoStyleEnabled()&&this.dataForAutoStyle()){var t=this.dataviewModel.layer,e=t.get("cartocss");!e&&t.get("meta")&&(e=t.get("meta").cartocss),t.set("initialStyle",e);var i=this.autoStyler.getStyle();t.set("cartocss",i),this.set("autoStyle",!0)}},dataForAutoStyle:function(){return this.dataviewModel.get("data").length>0},reapplyAutoStyle:function(){var t=this.autoStyler.getStyle();this.dataviewModel.layer.set("cartocss",t),this.set("autoStyle",!0)},cancelAutoStyle:function(t){t||this.dataviewModel.layer.restoreCartoCSS(),this.set("autoStyle",!1)},getAutoStyle:function(){var t=this.get("style"),e=this.dataviewModel.layer,i=e.get("cartocss")||e.get("meta")&&e.get("meta").cartocss;if(this.isAutoStyleEnabled()&&this.autoStyler){if(t&&t.auto_style&&t.auto_style.definition){var a=n.extend(t.auto_style,{cartocss:i});return n.extend({},a,{definition:this.autoStyler.getDef(i)})}return{definition:this.autoStyler.getDef(i),cartocss:i}}return{}},setInitialState:function(t){this.initialState=t||{}},applyInitialState:function(){var t=n.extend(this.initialState,{hasInitialState:!0});this.setState(t)},setState:function(t){this.set(t)},getState:function(){var t={};for(var e in this.defaultState){var i=this.get(e),a=this.defaultState[e];void 0===a||void 0===i||n.isEqual(i,a)||(t[e]=i)}return t}})},73:function(t,e,i){"use strict";e.a=function(t,e){return t=+t,e-=t,function(i){return t+e*i}}},774:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Dashboard-menuContainer">\n  <div class="CDB-Dashboard-menuInner">\n    <div class="CDB-Dashboard-menuHeader">\n      ',!0===showLogo&&(__p+='\n      <div class="CDB-Dashboard-menuLogo">\n        <a href="http://carto.com" target="_blank">\n          <svg width="62px" height="24px" viewBox="35 63 62 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n              <g class="CDB-EmbedLogo" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(35.000000, 63.000000)">\n                  <path d="M3.94693333,15.9877346 C5.63066667,15.9877346 6.60373333,15.2552013 7.32533333,14.260268 L5.72906667,13.1232013 C5.26986667,13.6808013 4.79973333,14.0525346 4.0016,14.0525346 C2.93013333,14.0525346 2.17573333,13.1560013 2.17573333,12.0080013 L2.17573333,11.9861346 C2.17573333,10.8709346 2.93013333,9.95253464 4.0016,9.95253464 C4.73413333,9.95253464 5.23706667,10.3133346 5.6744,10.849068 L7.27066667,9.6136013 C6.5928,8.68426797 5.58693333,8.02826797 4.02346667,8.02826797 C1.7056,8.02826797 0,9.7776013 0,12.0080013 L0,12.029868 C0,14.3149346 1.76026667,15.9877346 3.94693333,15.9877346 L3.94693333,15.9877346 Z M10.93653,15.834668 L13.1559967,15.834668 L13.7026634,14.457068 L16.6655967,14.457068 L17.2122634,15.834668 L19.4863967,15.834668 L16.2282634,8.12666797 L14.18373,8.12666797 L10.93653,15.834668 Z M14.3258634,12.8061346 L15.1895967,10.6413346 L16.0423967,12.8061346 L14.3258634,12.8061346 Z M23.61653,15.834668 L25.7375966,15.834668 L25.7375966,13.5168013 L26.6778633,13.5168013 L28.2194633,15.834668 L30.6575966,15.834668 L28.83173,13.1669346 C29.78293,12.7624013 30.40613,11.9861346 30.40613,10.8053346 L30.40613,10.783468 C30.40613,10.029068 30.17653,9.4496013 29.7282633,9.00133464 C29.2143966,8.48746797 28.40533,8.18133464 27.2354633,8.18133464 L23.61653,8.18133464 L23.61653,15.834668 Z M25.7375966,11.8549346 L25.7375966,10.0072013 L27.1370633,10.0072013 C27.8367966,10.0072013 28.2850633,10.3133346 28.2850633,10.9256013 L28.2850633,10.947468 C28.2850633,11.505068 27.8586633,11.8549346 27.1479966,11.8549346 L25.7375966,11.8549346 Z M36.7338633,15.834668 L38.8549299,15.834668 L38.8549299,10.0400013 L41.1509299,10.0400013 L41.1509299,8.18133464 L34.4487966,8.18133464 L34.4487966,10.0400013 L36.7338633,10.0400013 L36.7338633,15.834668 Z" class="CDB-EmbedLogo-text" fill="#FFFFFF"></path>\n                  <g class="CDB-EmbedLogo-imago" transform="translate(37.000000, 0.000000)">\n                      <circle class="CDB-EmbedLogo-halo" fill="rgba(255, 255, 255, 0.20)"  cx="12.3333333" cy="12" r="12"></circle>\n                      <path d="M12.3333333,16.5 C14.8186147,16.5 16.8333333,14.4852814 16.8333333,12 C16.8333333,9.51471863 14.8186147,7.5 12.3333333,7.5 C9.84805196,7.5 7.83333333,9.51471863 7.83333333,12 C7.83333333,14.4852814 9.84805196,16.5 12.3333333,16.5 L12.3333333,16.5 Z" class="CDB-EmbedLogo-point" fill="#FFFFFF" ></path>\n                  </g>\n              </g>\n          </svg>\n        </a>\n      </div>\n      '),__p+='\n\n      <ul class="CDB-Dashboard-menuActions">\n        <li class="CDB-Dashboard-menuActionsItem">\n          <a href="https://twitter.com/share?url='+__e(urlWithoutParams)+"&text="+__e(shortTitle)+'" target="_blank" class="u-hintTextColor">\n            <i class="CDB-IconFont CDB-IconFont-twitter CDB-Size-large"></i>\n          </a>\n        </li>\n        <li class="CDB-Dashboard-menuActionsItem">\n          <a href="http://www.facebook.com/sharer.php?u='+__e(urlWithoutParams)+"&text="+__e(shortTitle)+'" target="_blank" class="u-hintTextColor">\n            <i class="CDB-IconFont CDB-IconFont-facebook CDB-Size-medium"></i>\n          </a>\n        </li>\n        ',inIframe&&(__p+='\n          <li class="CDB-Dashboard-menuActionsItem">\n            <a href="'+__e(url)+'" target="_blank" class="u-hintTextColor">\n              <i class="CDB-IconFont CDB-IconFont-anchor CDB-Size-medium"></i>\n            </a>\n          </li>\n        '),__p+='\n      </ul>\n\n\n      <div class="CDB-Dashboard-menuInfo">\n        <button class="js-toggle-view">\n          <i class="CDB-Text CDB-Size-medium CDB-IconFont CDB-IconFont-rArrowLight Size-large"></i>\n        </button>\n      </div>\n\n      <div class="CDB-Dashboard-menuTexts CDB-Dashboard-hideMobile">\n        <div class="CDB-Dashboard-menuTextInner js-content">\n          <button class="js-toggle-view u-actionTextColor CDB-Dashboard-menuTextActions">\n            <svg width="10px" height="7px" viewBox="12 13 10 7" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n              <path d="M12,13.5 C12,13.2238576 12.1908338,13 12.4169561,13 L21.5830439,13 C21.8133224,13 22,13.2319336 22,13.5 C22,13.7761424 21.8091662,14 21.5830439,14 L12.4169561,14 C12.1866776,14 12,13.7680664 12,13.5 L12,13.5 L12,13.5 Z M12,16.5 C12,16.2238576 12.1908338,16 12.4169561,16 L21.5830439,16 C21.8133224,16 22,16.2319336 22,16.5 C22,16.7761424 21.8091662,17 21.5830439,17 L12.4169561,17 C12.1866776,17 12,16.7680664 12,16.5 L12,16.5 L12,16.5 Z M12,19.5 C12,19.2238576 12.1908338,19 12.4169561,19 L21.5830439,19 C21.8133224,19 22,19.2319336 22,19.5 C22,19.7761424 21.8091662,20 21.5830439,20 L12.4169561,20 C12.1866776,20 12,19.7680664 12,19.5 L12,19.5 L12,19.5 Z" id="Combined-Shape" stroke="none" fill="#1785fB" fill-rule="evenodd"></path>\n            </svg>\n          </button>\n          <div>\n            <p class="CDB-Dashboard-menuTime CDB-Text CDB-Size-small u-upperCase u-altTextColor u-bSpace--m js-timeAgo">UPDATED '+__e(updatedAt)+'</p>\n            <h1 class="CDB-Dashboard-menuTitle CDB-Dashboard-menuTitle--mobile CDB-Text CDB-Size-huge u-ellipsis js-title" title="'+__e(title)+'">'+__e(title)+'</h1>\n            <h2 class="CDB-Dashboard-menuDescription CDB-Text CDB-Size-large is-light u-secondaryTextColor js-description">'+(null==(__t=cdb.core.sanitize.html(description))?"":__t)+'</h2>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div class="CDB-Dashboard-menuFooter">\n      <ul>\n        <li class="CDB-Dashboard-menuFooterItem ">\n          <div class="CDB-Dashboard-menuMedia CDB-Dashboard-menuAvatar">\n            <img src="'+__e(userAvatarURL)+'" alt="avatar" class="inline-block"/>\n          </div>\n          <p class="CDB-Text CDB-Size-medium CDB-Dashboard-menuFooterTxt">Map by <a href="'+__e(userProfileURL)+'" target="_blank">'+__e(userName)+'</a></p>\n        </li>\n      </ul>\n    </div>\n  </div>\n  <div class="CDB-Dashboard-bg js-toggle-view"></div>\n\n  <div class="CDB-Dashboard-menuHeaderMobile">\n    <div class="u-flex u-alignStart CDB-Dashboard-menuHeaderMobileInner">\n      <button class="js-toggle-view u-actionTextColor CDB-Dashboard-menuHeaderMobileActions">\n        <i class="CDB-Text CDB-Size-medium CDB-IconFont CDB-IconFont-rArrowLight Size-large"></i>\n      </button>\n      <div class="CDB-Dashboard-menuHeaderMobileText">\n        ',!0===showLogo&&(__p+='\n        <div class="CDB-Dashboard-menuLogo">\n          <a href="http://carto.com" target="_blank">\n          <svg width="62px" height="24px" viewBox="35 63 62 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n              <g class="CDB-EmbedLogo" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(35.000000, 63.000000)">\n                  <path d="M3.94693333,15.9877346 C5.63066667,15.9877346 6.60373333,15.2552013 7.32533333,14.260268 L5.72906667,13.1232013 C5.26986667,13.6808013 4.79973333,14.0525346 4.0016,14.0525346 C2.93013333,14.0525346 2.17573333,13.1560013 2.17573333,12.0080013 L2.17573333,11.9861346 C2.17573333,10.8709346 2.93013333,9.95253464 4.0016,9.95253464 C4.73413333,9.95253464 5.23706667,10.3133346 5.6744,10.849068 L7.27066667,9.6136013 C6.5928,8.68426797 5.58693333,8.02826797 4.02346667,8.02826797 C1.7056,8.02826797 0,9.7776013 0,12.0080013 L0,12.029868 C0,14.3149346 1.76026667,15.9877346 3.94693333,15.9877346 L3.94693333,15.9877346 Z M10.93653,15.834668 L13.1559967,15.834668 L13.7026634,14.457068 L16.6655967,14.457068 L17.2122634,15.834668 L19.4863967,15.834668 L16.2282634,8.12666797 L14.18373,8.12666797 L10.93653,15.834668 Z M14.3258634,12.8061346 L15.1895967,10.6413346 L16.0423967,12.8061346 L14.3258634,12.8061346 Z M23.61653,15.834668 L25.7375966,15.834668 L25.7375966,13.5168013 L26.6778633,13.5168013 L28.2194633,15.834668 L30.6575966,15.834668 L28.83173,13.1669346 C29.78293,12.7624013 30.40613,11.9861346 30.40613,10.8053346 L30.40613,10.783468 C30.40613,10.029068 30.17653,9.4496013 29.7282633,9.00133464 C29.2143966,8.48746797 28.40533,8.18133464 27.2354633,8.18133464 L23.61653,8.18133464 L23.61653,15.834668 Z M25.7375966,11.8549346 L25.7375966,10.0072013 L27.1370633,10.0072013 C27.8367966,10.0072013 28.2850633,10.3133346 28.2850633,10.9256013 L28.2850633,10.947468 C28.2850633,11.505068 27.8586633,11.8549346 27.1479966,11.8549346 L25.7375966,11.8549346 Z M36.7338633,15.834668 L38.8549299,15.834668 L38.8549299,10.0400013 L41.1509299,10.0400013 L41.1509299,8.18133464 L34.4487966,8.18133464 L34.4487966,10.0400013 L36.7338633,10.0400013 L36.7338633,15.834668 Z" class="CDB-EmbedLogo-text" fill="#FFFFFF"></path>\n                  <g class="CDB-EmbedLogo-imago" transform="translate(37.000000, 0.000000)">\n                      <circle class="CDB-EmbedLogo-halo" fill="rgba(255, 255, 255, 0.20)"  cx="12.3333333" cy="12" r="12"></circle>\n                      <path d="M12.3333333,16.5 C14.8186147,16.5 16.8333333,14.4852814 16.8333333,12 C16.8333333,9.51471863 14.8186147,7.5 12.3333333,7.5 C9.84805196,7.5 7.83333333,9.51471863 7.83333333,12 C7.83333333,14.4852814 9.84805196,16.5 12.3333333,16.5 L12.3333333,16.5 Z" class="CDB-EmbedLogo-point" fill="#FFFFFF" ></path>\n                  </g>\n              </g>\n          </svg>\n          </a>\n        </div>\n        '),__p+='\n        <p class="CDB-Dashboard-menuTime CDB-Text CDB-Size-small u-upperCase u-altTextColor u-bSpace--m js-timeAgo">UPDATED '+__e(updatedAt)+'</p>\n        <h1 class="CDB-Text CDB-Size-large u-ellipsis js-title u-bSpace--xl u-ellipsis">'+__e(title)+'</h1>\n        <h2 class="CDB-Text CDB-Size-medium u-secondaryTextColor js-description">'+(null==(__t=cdb.core.sanitize.html(description))?"":__t)+"</h2>\n      </div>\n    </div>\n  </div>\n</div>\n";return __p}},775:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="CDB-Widget-canvasInner js-container"></div>\n';return __p}},776:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="CDB-Dashboard-mapWrapper js-map-wrapper">\n  <div class="CDB-Map-canvas">\n    <div class="CDB-Map" id="map"></div>\n  </div>\n</div>\n';return __p}},777:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="CDB-Widget-header js-header"></div>\n<div class="CDB-Widget-content CDB-Widget-content--noSidesMargin">\n  <div class="CDB-Widget-listWrapper js-content"></div>\n</div>\n<div class="CDB-Widget-footer js-footer"></div>\n';return __p}},778:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<button type="button" class="CDB-Widget-listItemInner CDB-Widget-listButton js-button '+__e(isDisabled?"is-disabled":"")+'">\n  <div class="CDB-Widget-contentSpaced">\n    <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+__e(name)+'">'+__e(name)+'</p>\n    <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+__e(value)+'">'+__e(prefix)+__e(formattedValue)+__e(suffix)+'</p>\n  </div>\n  <div class="CDB-Widget-progressBar">\n    <div class="CDB-Widget-progressState '+__e(isAggregated?"CDB-Widget-progressState--pattern":"")+" "+__e(isAccepted?"is-accepted":"")+'" style="width: '+__e(percentage)+"%; background-color: "+__e(color)+'"></div>\n  </div>\n</button>\n';return __p}},779:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="CDB-Widget-listItemInner '+__e(isDisabled?"is-disabled":"")+'">\n  <div class="CDB-Widget-contentSpaced">\n    <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+__e(name)+'">'+__e(name)+'</p>\n    <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+__e(value)+'">'+__e(prefix)+__e(formattedValue)+__e(suffix)+'</p>\n  </div>\n  <div class="CDB-Widget-progressBar">\n    <div class="CDB-Widget-progressState CDB-Widget-progressState--pattern '+__e(isAggregated?"CDB-Widget-progressState--inactive":"")+'"\n      style="width: '+__e(percentage)+"%; background-color: "+__e(color)+'"></div>\n  </div>\n</div>\n';return __p}},780:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<button type="button" class="CDB-Widget-listItemInner CDB-Widget-listItemInner--fullSpace CDB-Widget-listButton js-button '+__e(isDisabled?"is-disabled":"")+'">\n  <span class="CDB-Widget-checkbox '+__e(isDisabled?"":"is-checked")+'"></span>\n  <div class="u-lSpace u-ellipsis">\n    <div class="CDB-Widget-contentSpaced">\n      <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+__e(name)+'">'+__e(name)+'</p>\n      <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+__e(value)+'">'+__e(prefix)+__e(formattedValue)+__e(suffix)+'</p>\n    </div>\n    <div class="CDB-Widget-progressBar">\n      <div class="CDB-Widget-progressState is-accepted" style="width: '+__e(percentage)+'%"></div>\n    </div>\n  </div>\n</button>\n';return __p}},781:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n<li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n<li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n<li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n';return __p}},782:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<li class="CDB-Widget-listItem">\n  <h4 class="CDB-Text CDB-Size-large">No results</h4>\n  <p class="CDB-Text CDB-Size-medium u-tSpace-xl u-altTextColor">Your search "'+__e(q)+'" didn\'t match<br/>with any value.</p>\n  <p class="CDB-Text CDB-Size-medium u-tSpace-xl u-altTextColor">Try searching again.</p>\n</li>\n';return __p}},783:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)isSearchEnabled?__p+='\n  <p class="CDB-Text is-semibold CDB-Size-small u-upperCase js-lockCategories">'+__e(totalLocked)+" selected</p>\n":(__p+='\n  <p class="CDB-Text is-semibold CDB-Size-small u-upperCase js-textInfo">\n    ',isLocked?__p+="\n      "+__e(totalCats)+' blocked <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link u-lSpace js-unlock">unlock</button>\n    ':(__p+="\n      ",noneSelected?__p+="\n        None selected\n      ":(__p+="\n        "+__e(allSelected?"All selected":acceptedCats+" selected")+"\n        ",canBeLocked&&(__p+='\n          <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link u-lSpace js-lock">lock</button>\n        '),__p+="\n      "),__p+="\n    "),__p+="\n  </p>\n  ",canSelectAll&&(__p+='\n    <div class="CDB-Widget-filterButtons">\n      <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link CDB-Widget-filterButton js-all">all</button>\n    </div>\n  '),__p+="\n"),__p+="\n";return __p}},784:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){if(showSearch&&(__p+='\n<div class="CDB-Widget-contentFlex">\n  <button class="u-rSpace--m CDB-Text is-semibold u-upperCase CDB-Size-small js-searchToggle">\n    <div class="CDB-Shape u-iBlock">\n      <span class="CDB-Shape-magnify is-small is-blue"></span>\n    </div>\n    <span class="u-iBlock u-actionTextColor">\n      search in '+__e(categoriesCount)+" categor"+__e(1===categoriesCount?"y":"ies")+"\n    </span>\n  </button>\n</div>\n"),__p+="\n",showPaginator){__p+='\n  <div class="CDB-Widget-navDots js-dots">\n    ';for(var i=0,l=pages;i<l;i++)__p+='<button class="CDB-Shape-dot CDB-Widget-dot--navigation js-page ',currentPage===i&&(__p+="is-selected"),__p+='" data-page="'+__e(i)+'"></button>';__p+="\n  </div>\n"}__p+="\n"}return __p}},785:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){if(__p+='<div class="CDB-Widget-contentFlex">\n  <button class="CDB-Text is-semibold u-upperCase CDB-Size-small u-rSpace--m js-searchToggle u-actionTextColor">cancel</button>\n</div>\n',showPaginator){__p+='\n  <div class="CDB-Widget-navDots js-dots u-tSpace--m">\n    ';for(var i=0,l=pages;i<l;i++)__p+='<button class="CDB-Shape-dot CDB-Widget-dot--navigation js-page ',currentPage===i&&(__p+="is-selected"),__p+='" data-page="'+__e(i)+'"></button>';__p+="\n  </div>\n"}__p+="\n"}return __p}},786:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(value)+"\n";return __p}},787:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)isSearchEnabled?(__p+="\n    ",isSearchApplied?__p+='\n      <dt class="CDB-Widget-infoCount">'+__e(resultsCount)+'</dt><dd class="CDB-Widget-infoDescription">found</dd>\n    ':__p+="\n      &nbsp;\n    ",__p+="\n  </dt>\n"):__p+='\n  <dt class="CDB-Widget-infoCount">'+__e(nullsPer)+'%</dt><dd class="CDB-Widget-infoDescription"> null rows</dd>\n  <dt class="CDB-Widget-infoCount"><span class="js-cats">'+__e(catsPer)+'</span>%</dt><dd class="CDB-Widget-infoDescription">of total</dd>\n',__p+="\n";return __p}},788:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)isSearchEnabled?(__p+='\n  <form class="CDB-Widget-search js-form">\n    <div class="CDB-Shape CDB-Widget-searchLens u-iBlock u-rSpace js-searchIcon">\n      <span class="CDB-Shape-magnify is-small is-blue"></span>\n    </div>\n    <input type="text" class="CDB-Text CDB-Size-large CDB-Widget-textInput CDB-Widget-searchTextInput js-textInput" value="'+__e(q)+'" placeholder="Search by '+__e(columnName)+'"/>\n    ',canShowApply&&(__p+='\n      <button type="button" class="CDB-Text is-semibold u-upperCase CDB-Size-small CDB-Widget-searchApply js-applyLocked u-actionTextColor">apply</button>\n    '),__p+="\n  </form>\n"):(__p+='\n  <div class="CDB-Widget-title CDB-Widget-contentSpaced js-title">\n    <h3 class="CDB-Text CDB-Size-large u-ellipsis js-titleText" title="'+__e(title)+'">'+__e(title)+'</h3>\n    <div class="CDB-Widget-options CDB-Widget-contentSpaced">\n      ',isAutoStyleEnabled&&(__p+='\n        <button class="CDB-Widget-buttonIcon CDB-Widget-buttonIcon--circle js-colors\n          '+__e(isAutoStyle?"is-selected":"")+"\n          "+__e(isAutoStyle?"js-cancelAutoStyle":"js-autoStyle")+'\n          " data-tooltip="\n            '+__e(isAutoStyle?"Remove auto style":"Auto style")+'\n          ">\n          <i class="CDB-IconFont CDB-IconFont-drop CDB-IconFont--small CDB-IconFont--top"></i>\n        </button>\n      '),__p+='\n      <button class="CDB-Shape CDB-Widget-actions js-actions u-lSpace">\n        <div class="CDB-Shape-threePoints is-blue is-small">\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n        </div>\n      </button>\n    </div>\n  </div>\n  ',showSource&&(__p+='\n    <dl class="CDB-Widget-info u-tSpace">\n      <div class="u-ellipsis u-flex">\n        <span class="CDB-SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase" style="background-color: '+(null==(__t=sourceColor)?"":__t)+';">'+(null==(__t=sourceId)?"":__t)+'</span>\n        <p class="CDB-Text CDB-Size-small u-mainTextColor u-ellipsis u-flex">\n          '+(null==(__t=sourceType)?"":__t)+' <span class="u-altTextColor u-lSpace u-ellipsis" title="'+(null==(__t=layerName)?"":__t)+'">'+(null==(__t=layerName)?"":__t)+"</span>\n        </p>\n      </div>\n    </dl>\n  "),__p+="\n"),__p+="\n";return __p}},789:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<ul class="CDB-Dropdown-list CDB-Text CDB-Size-medium">\n\n  ',flags.canCollapse&&(__p+='\n    <li class="CDB-Dropdown-item">\n      <button class="CDB-Dropdown-link js-toggleCollapsed">\n        Toggle widget\n          <div class="CDB-Dropdown-toggle">\n          ',collapsed?__p+='\n            <input class="CDB-Toggle js-inputCollapsed" checked="checked" type="checkbox" name="collapsed">\n          ':__p+='\n            <input class="CDB-Toggle js-inputCollapsed" type="checkbox" name="collapsed">\n          ',__p+='\n            <span class="u-iBlock CDB-ToggleFace"></span>\n          </div>\n      </button>\n    </li>\n  '),__p+="\n\n  ",flags.normalizeHistogram&&(__p+='\n  <li class="CDB-Dropdown-item">\n    <button class="CDB-Dropdown-link js-toggleNormalized">\n      Show totals\n      <div class="CDB-Dropdown-toggle">\n        ',normalized?__p+='\n        <input class="CDB-Toggle u-iBlock js-inputNormalized" type="checkbox" name="normalized">\n        ':__p+='\n        <input class="CDB-Toggle u-iBlock js-inputNormalized" checked="checked" type="checkbox" name="normalized">\n        ',__p+='\n        <span class="u-iBlock CDB-ToggleFace"></span>\n      </div>\n    </button>\n  </li>\n  '),__p+="\n\n  ",show_options&&(__p+='\n    <li class="CDB-Dropdown-item">\n      <button type="button" class="CDB-Dropdown-link u-ellipsis u-actionTextColor js-editWidget" title="Edit">Edit</button>\n    </li>\n    <li class="CDB-Dropdown-item">\n      <button type="button" class="CDB-Dropdown-link u-ellipsis u-errorTextColor js-removeWidget" title="Delete...">Delete...</button>\n    </li>\n  '),__p+="\n</ul>\n";return __p}},790:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(prefix)+""+__e(value)+__e(suffix)+"\n";return __p}},791:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Widget-header js-header">\n  <div class="CDB-Widget-title CDB-Widget-contentSpaced">\n    <h3 class="CDB-Text CDB-Size-large u-ellipsis '+__e(isCollapsed?"js-value is-collapsed":"js-title")+'">',isCollapsed?__p+=__e(formatedValue):__p+=" "+__e(title),__p+='</h3>\n    <div class="CDB-Widget-options">\n      <button class="CDB-Shape CDB-Widget-actions js-actions">\n        <div class="CDB-Shape-threePoints is-blue is-small">\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n        </div>\n      </button>\n    </div>\n  </div>\n  ',showSource&&(__p+='\n    <dl class="CDB-Widget-info u-tSpace">\n      <div class="u-ellipsis u-flex">\n        <span class="CDB-SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase" style="background-color: '+(null==(__t=sourceColor)?"":__t)+';">'+(null==(__t=sourceId)?"":__t)+'</span>\n        <p class="CDB-Text CDB-Size-small u-mainTextColor u-ellipsis u-flex">\n          '+(null==(__t=sourceType)?"":__t)+' <span class="u-altTextColor u-lSpace u-ellipsis" title="'+(null==(__t=layerName)?"":__t)+'">'+(null==(__t=layerName)?"":__t)+"</span>\n        </p>\n      </div>\n    </dl>\n  "),__p+="\n  ",showStats&&(__p+='\n    <dl class="CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace">\n      <dt class="CDB-Widget-infoCount">'+__e(nulls)+'</dt><dd class="CDB-Widget-infoDescription">null rows</dd>\n    </dl>\n  '),__p+='\n</div>\n<div class="CDB-Widget-content CDB-Widget-content--formula">\n  ',_.isNumber(value)?(__p+='\n    <h4 class="CDB-Text CDB-Size-huge '+__e(isCollapsed?"":"js-value")+'" title="'+__e(value)+'">\n      '+__e(prefix)+__e(value)+__e(suffix)+"\n    </h4>\n    ",description&&(__p+='\n      <p class="CDB-Text CDB-Size-small u-tSpace js-description">'+__e(description)+"</p>\n    "),__p+="\n  "):__p+='\n    <div class="CDB-Widget-listItem--fake"></div>\n  ',__p+="\n</div>\n";return __p}},792:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(value)+" "+__e(suffix)+"\n";return __p}},793:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Widget-header js-header">\n  <div class="js-title"></div>\n  ',isCollapsed||(__p+="\n    ",showSource&&(__p+='\n      <dl class="CDB-Widget-info u-tSpace">\n        <div class="u-ellipsis u-flex">\n          <span class="CDB-SelectorLayer-letter CDB-Text CDB-Size-small u-whiteTextColor u-rSpace u-upperCase" style="background-color: '+(null==(__t=sourceColor)?"":__t)+';">'+(null==(__t=sourceId)?"":__t)+'</span>\n          <p class="CDB-Text CDB-Size-small u-mainTextColor u-ellipsis u-flex">\n            '+(null==(__t=sourceType)?"":__t)+' <span class="u-altTextColor u-lSpace u-ellipsis" title="'+(null==(__t=layerName)?"":__t)+'">'+(null==(__t=layerName)?"":__t)+"</span>\n          </p>\n        </div>\n      </dl>\n    "),__p+="\n    ",showStats&&(__p+='\n      <dl class="CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace">\n        <dt class="CDB-Widget-infoCount js-nulls">0</dt><dd class="CDB-Widget-infoDescription">NULL ROWS</dd>\n        <dt class="CDB-Widget-infoCount js-min">0</dt><dd class="CDB-Widget-infoDescription">MIN</dd>\n        <dt class="CDB-Widget-infoCount js-avg">0</dt><dd class="CDB-Widget-infoDescription">AVG</dd>\n        <dt class="CDB-Widget-infoCount js-max">0</dt><dd class="CDB-Widget-infoDescription">MAX</dd>\n      </dl>\n    '),__p+="\n  "),__p+="\n</div>\n",isCollapsed||(__p+='\n<div class="CDB-Widget-content CDB-Widget-content--histogram js-content">\n  <div class="CDB-Widget-tooltip CDB-Widget-tooltip--light CDB-Text CDB-Size-small js-tooltip"></div>\n  <div class="CDB-Widget-filter CDB-Widget-contentSpaced ">\n    <p class="CDB-Text CDB-Size-small is-semibold u-upperCase js-val"></p>\n    <div class="CDB-Widget-filterButtons js-filter is-hidden">\n      <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-zoom">zoom</button>\n      <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-clear">clear</button>\n    </div>\n  </div>\n</div>\n'),__p+="\n";return __p}},794:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Widget-title CDB-Widget-contentSpaced">\n  <h3 class="CDB-Text CDB-Size-large u-ellipsis" title="'+__e(title)+'">'+__e(title)+'</h3>\n  <div class="CDB-Widget-options CDB-Widget-contentSpaced">\n    ',isAutoStyleEnabled&&(__p+='\n      <button class="CDB-Widget-buttonIcon CDB-Widget-buttonIcon--circle js-sizes\n        '+__e(isAutoStyle?"is-selected":"")+"\n        "+__e(isAutoStyle?"js-cancelAutoStyle":"js-autoStyle")+'\n        " data-tooltip="'+__e(isAutoStyle?"Remove auto style":"Auto style")+'">\n        <i class="CDB-IconFont CDB-IconFont-drop CDB-IconFont--small CDB-IconFont--top"></i>\n      </button>\n    '),__p+='\n    <button class="CDB-Shape CDB-Widget-actions js-actions u-lSpace">\n      <div class="CDB-Shape-threePoints is-blue is-small">\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n      </div>\n    </button>\n  </div>\n</div>\n';return __p}},795:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<ul class="CDB-Widget-chart CDB-Widget-chart--fake">\n  ';for(var i=0;i<15;i++)__p+='\n  <li class="CDB-Widget-chartItem CDB-Widget-chartItem--'+__e(_.sample(["small","medium","big"],1)[0])+' CDB-Widget-chartItem--fake"></li>\n  ';__p+="\n</ul>\n"}return __p}},796:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="CDB-Widget-header">\n  <div class="CDB-Widget-title CDB-Widget-contentSpaced">\n    <h3 class="CDB-Widget-textBig" title="'+__e(title)+'">'+__e(title)+'</h3>\n  </div>\n  <dl class="CDB-Widget-info CDB-Widget-textSmaller CDB-Widget-textSmaller--upper u-tSpace">\n    <dt>'+__e(itemsCount)+'</dt><dd class="CDB-Widget-info">rows</dd>\n  </dl>\n</div>\n<div class="CDB-Widget-content CDB-Widget-content--noSidesMargin">\n  <div class="CDB-Widget-listWrapper js-content"></div>\n</div>\n<div class="CDB-Widget-footer js-footer"></div>\n';return __p}},797:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){if(isClickable?__p+='\n  <button type="button" class="CDB-Widget-listItemInner CDB-Widget-listButton CDB-Widget-listButton--withBorder js-button">\n':__p+='\n  <div class="CDB-Widget-listItemInner CDB-Widget-listItemInner--withBorders">\n',__p+='\n  <div class="CDB-Widget-contentSpaced CDB-Widget-contentSpaced--topAligned CDB-Widget-contentSpaced--start">\n    <em class="CDB-Shape-dot CDB-Widget-listDot"></em>\n    ',itemsCount>0){if(__p+='\n      <div class="CDB-Widget-contentFull">\n        <p class="CDB-Widget-textSmall CDB-Widget-textSmall--upper CDB-Widget-textSmall--bold" title="'+__e(items[0][1])+'">'+__e(items[0][1])+"</p>\n        ",itemsCount>2){__p+='\n          <dl class="CDB-Widget-inlineList">\n          ';for(var i=1,l=itemsCount;i<l;i++)__p+='\n            <div class="CDB-Widget-inlineListItem CDB-Widget-textSmaller CDB-Widget-textSmaller--noEllip">\n              <dd class="CDB-Widget-textSmaller--bold CDB-Widget-textSmaller--dark u-rSpace" title="'+__e(items[i][1])+'">'+__e(items[i][1])+'</dd>\n              <dt title="'+__e(items[i][0])+'">'+__e(items[i][0])+"</dt>\n            </div>\n          ";__p+="\n          </dl>\n        "}else 2===itemsCount&&(__p+='\n          <dl class="CDB-Widget-textSmaller CDB-Widget-textSmaller--noEllip u-tSpace">\n            <dd class="CDB-Widget-textSmaller--bold CDB-Widget-textSmaller--dark u-rSpace" title="'+__e(items[1][1])+'">'+__e(items[1][1])+'</dd>\n            <dt title="'+__e(items[1][0])+'">'+__e(items[1][0])+"</dt>\n          </dl>\n        ");__p+="\n      </div>\n    "}__p+="\n  </div>\n",isClickable?__p+="\n  </button>\n":__p+="\n  </div>\n",__p+="\n"}return __p}},798:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<ul class="CDB-Widget-list CDB-Widget-list--withBorders">\n  <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n  <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n  <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n  <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n</ul>\n';return __p}},799:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(value)+" "+__e(suffix)+"\n";return __p}},800:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="CDB-Widget-header js-header">\n</div>\n<div class="CDB-Widget-content CDB-Widget-content--timeSeries js-content">\n</div>\n';return __p}},801:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Widget-contentSpaced CDB-Widget-contentFull">\n  <p class="CDB-Text CDB-Size-large js-widget-title u-iBlock u-ellipsis u-rSpace">'+__e(title)+'</p>\n  <div class="CDB-Widget-contentSpaced--end">\n    <div class="CDB-Widget-options CDB-Widget-contentSpaced">\n      <p class="CDB-Widget-timeSeriesTimeInfo CDB-Text CDB-Size-small is-semibold u-upperCase u-rSpace--m js-val"></p>\n      ',showClearButton&&(__p+='\n        <button class="CDB-Text CDB-Size-small is-semibold u-upperCase u-actionTextColor CDB-Widget-filterButton js-clear">Clear</button>\n      '),__p+='\n      <button class="CDB-Shape CDB-Widget-actions js-actions u-lSpace">\n        <div class="CDB-Shape-threePoints is-blue is-small">\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n        </div>\n      </button>\n    </div>\n  </div>\n</div>\n';return __p}},802:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="CDB-Widget-controlButtonContent">\n  <i class="'+__e(iconClass)+'"></i>\n</div>\n';return __p}},803:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="CDB-Widget-contentSpaced CDB-Widget-contentSpaced--end js-torque-controls"></div>\n<div class="CDB-Widget-contentFull">\n  <div class="js-time-series-header"></div>\n</div>\n';return __p}},804:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<p class="CDB-Text CDB-Size-large u-iBlock">\n  '+__e(number)+"\n</p>\n";return __p}},805:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="js-header">\n  <div class="js-torque-header"></div>\n</div>\n';return __p}},806:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<p class="CDB-Text CDB-Size-large u-iBlock">\n  '+__e(time)+'\n</p>\n<p class="CDB-Text CDB-Size-large u-secondaryTextColor u-iBlock">\n  '+__e(date)+"\n</p>\n";return __p}},807:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<button class="CDB-Widget-button CDB-Widget-errorButton js-refresh">\n  <span class="CDB-Widget-textSmall CDB-Widget-textSmall--bold">REFRESH</span>\n</button>\n';return __p}},810:function(t,e,i){!function(e,i){"use strict";t.exports=function(t){"use strict";function e(t){var e=t.toLowerCase(),i=e.split(":"),n=i.length,a=8;""===i[0]&&""===i[1]&&""===i[2]?(i.shift(),i.shift()):""===i[0]&&""===i[1]?i.shift():""===i[n-1]&&""===i[n-2]&&i.pop(),n=i.length,-1!==i[n-1].indexOf(".")&&(a=7);var s;for(s=0;s<n&&""!==i[s];s++);if(s<a){for(i.splice(s,1,"0000");i.length<a;)i.splice(s,0,"0000");n=i.length}for(var r,o=0;o<a;o++){r=i[o].split("");for(var l=0;l<3&&"0"===r[0]&&r.length>1;l++)r.splice(0,1);i[o]=r.join("")}var h=-1,d=0,c=0,u=-1,g=!1;for(o=0;o<a;o++)g?"0"===i[o]?c+=1:(g=!1,c>d&&(h=u,d=c)):"0"===i[o]&&(g=!0,u=o,c=1);c>d&&(h=u,d=c),d>1&&i.splice(h,d,""),n=i.length;var p="";for(""===i[0]&&(p=":"),o=0;o<n&&(p+=i[o],o!==n-1);o++)p+=":";return""===i[n-1]&&(p+=":"),p}function i(){return t.IPv6===this&&(t.IPv6=n),this}var n=t&&t.IPv6;return{best:e,noConflict:i}}()}()},811:function(t,e,i){!function(e,i){"use strict";t.exports=function(t){"use strict";var e=t&&t.SecondLevelDomains,i={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch "},has:function(t){var e=t.lastIndexOf(".");if(e<=0||e>=t.length-1)return!1;var n=t.lastIndexOf(".",e-1);if(n<=0||n>=e-1)return!1;var a=i.list[t.slice(e+1)];return!!a&&a.indexOf(" "+t.slice(n+1,e)+" ")>=0},is:function(t){var e=t.lastIndexOf(".");if(e<=0||e>=t.length-1)return!1;if(t.lastIndexOf(".",e-1)>=0)return!1;var n=i.list[t.slice(e+1)];return!!n&&n.indexOf(" "+t.slice(0,e)+" ")>=0},get:function(t){var e=t.lastIndexOf(".");if(e<=0||e>=t.length-1)return null;var n=t.lastIndexOf(".",e-1);if(n<=0||n>=e-1)return null;var a=i.list[t.slice(e+1)];return a?a.indexOf(" "+t.slice(n+1,e)+" ")<0?null:t.slice(n+1):null},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return i}()}()},812:function(t,e,i){!function(e,n){"use strict";t.exports=function(t,e,i,n){"use strict";function a(t,e){var i=arguments.length>=1,n=arguments.length>=2;if(!(this instanceof a))return i?n?new a(t,e):new a(t):new a;if(void 0===t){if(i)throw new TypeError("undefined is not a valid argument for URI");t="undefined"!=typeof location?location.href+"":""}return this.href(t),void 0!==e?this.absoluteTo(e):this}function s(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function r(t){return void 0===t?"Undefined":String(Object.prototype.toString.call(t)).slice(8,-1)}function o(t){return"Array"===r(t)}function l(t,e){var i,n,a={};if("RegExp"===r(e))a=null;else if(o(e))for(i=0,n=e.length;i<n;i++)a[e[i]]=!0;else a[e]=!0;for(i=0,n=t.length;i<n;i++)(a&&void 0!==a[t[i]]||!a&&e.test(t[i]))&&(t.splice(i,1),n--,i--);return t}function h(t,e){var i,n;if(o(e)){for(i=0,n=e.length;i<n;i++)if(!h(t,e[i]))return!1;return!0}var a=r(e);for(i=0,n=t.length;i<n;i++)if("RegExp"===a){if("string"==typeof t[i]&&t[i].match(e))return!0}else if(t[i]===e)return!0;return!1}function d(t,e){if(!o(t)||!o(e))return!1;if(t.length!==e.length)return!1;t.sort(),e.sort();for(var i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function c(t){var e=/^\/+|\/+$/g;return t.replace(e,"")}function u(t){return escape(t)}function g(t){return encodeURIComponent(t).replace(/[!'()*]/g,u).replace(/\*/g,"%2A")}function p(t){return function(e,i){return void 0===e?this._parts[t]||"":(this._parts[t]=e||null,this.build(!i),this)}}function _(t,e){return function(i,n){return void 0===i?this._parts[t]||"":(null!==i&&(i+="",i.charAt(0)===e&&(i=i.substring(1))),this._parts[t]=i,this.build(!n),this)}}var f=n&&n.URI;a.version="1.17.1";var m=a.prototype,v=Object.prototype.hasOwnProperty;a._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:a.duplicateQueryParameters,escapeQuerySpace:a.escapeQuerySpace}},a.duplicateQueryParameters=!1,a.escapeQuerySpace=!0,a.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,a.idn_expression=/[^a-z0-9\.-]/i,a.punycode_expression=/(xn--)/i,a.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,a.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,a.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))/gi,a.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?]+$/},a.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},a.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,a.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},a.getDomAttribute=function(t){if(t&&t.nodeName){var e=t.nodeName.toLowerCase();if("input"!==e||"image"===t.type)return a.domAttributes[e]}},a.encode=g,a.decode=decodeURIComponent,a.iso8859=function(){a.encode=escape,a.decode=unescape},a.unicode=function(){a.encode=g,a.decode=decodeURIComponent},a.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},a.encodeQuery=function(t,e){var i=a.encode(t+"");return void 0===e&&(e=a.escapeQuerySpace),e?i.replace(/%20/g,"+"):i},a.decodeQuery=function(t,e){t+="",void 0===e&&(e=a.escapeQuerySpace);try{return a.decode(e?t.replace(/\+/g,"%20"):t)}catch(e){return t}};var b,w={encode:"encode",decode:"decode"},C=function(t,e){return function(i){try{return a[e](i+"").replace(a.characters[t][e].expression,function(i){return a.characters[t][e].map[i]})}catch(t){return i}}};for(b in w)a[b+"PathSegment"]=C("pathname",w[b]),a[b+"UrnPathSegment"]=C("urnpath",w[b]);var y=function(t,e,i){return function(n){var s;s=i?function(t){return a[e](a[i](t))}:a[e];for(var r=(n+"").split(t),o=0,l=r.length;o<l;o++)r[o]=s(r[o]);return r.join(t)}};a.decodePath=y("/","decodePathSegment"),a.decodeUrnPath=y(":","decodeUrnPathSegment"),a.recodePath=y("/","encodePathSegment","decode"),a.recodeUrnPath=y(":","encodeUrnPathSegment","decode"),a.encodeReserved=C("reserved","encode"),a.parse=function(t,e){var i;return e||(e={}),i=t.indexOf("#"),i>-1&&(e.fragment=t.substring(i+1)||null,t=t.substring(0,i)),i=t.indexOf("?"),i>-1&&(e.query=t.substring(i+1)||null,t=t.substring(0,i)),"//"===t.substring(0,2)?(e.protocol=null,t=t.substring(2),t=a.parseAuthority(t,e)):(i=t.indexOf(":"))>-1&&(e.protocol=t.substring(0,i)||null,e.protocol&&!e.protocol.match(a.protocol_expression)?e.protocol=void 0:"//"===t.substring(i+1,i+3)?(t=t.substring(i+3),t=a.parseAuthority(t,e)):(t=t.substring(i+1),e.urn=!0)),e.path=t,e},a.parseHost=function(t,e){t=t.replace(/\\/g,"/");var i,n,a=t.indexOf("/");if(-1===a&&(a=t.length),"["===t.charAt(0))i=t.indexOf("]"),e.hostname=t.substring(1,i)||null,e.port=t.substring(i+2,a)||null,"/"===e.port&&(e.port=null);else{var s=t.indexOf(":"),r=t.indexOf("/"),o=t.indexOf(":",s+1);-1!==o&&(-1===r||o<r)?(e.hostname=t.substring(0,a)||null,e.port=null):(n=t.substring(0,a).split(":"),e.hostname=n[0]||null,e.port=n[1]||null)}return e.hostname&&"/"!==t.substring(a).charAt(0)&&(a++,t="/"+t),t.substring(a)||"/"},a.parseAuthority=function(t,e){return t=a.parseUserinfo(t,e),a.parseHost(t,e)},a.parseUserinfo=function(t,e){var i,n=t.indexOf("/"),s=t.lastIndexOf("@",n>-1?n:t.length-1);return s>-1&&(-1===n||s<n)?(i=t.substring(0,s).split(":"),e.username=i[0]?a.decode(i[0]):null,i.shift(),e.password=i[0]?a.decode(i.join(":")):null,t=t.substring(s+1)):(e.username=null,e.password=null),t},a.parseQuery=function(t,e){if(!t)return{};if(!(t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var i,n,s,r={},o=t.split("&"),l=o.length,h=0;h<l;h++)i=o[h].split("="),n=a.decodeQuery(i.shift(),e),s=i.length?a.decodeQuery(i.join("="),e):null,v.call(r,n)?("string"!=typeof r[n]&&null!==r[n]||(r[n]=[r[n]]),r[n].push(s)):r[n]=s;return r},a.build=function(t){var e="";return t.protocol&&(e+=t.protocol+":"),t.urn||!e&&!t.hostname||(e+="//"),e+=a.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path.charAt(0)&&"string"==typeof t.hostname&&(e+="/"),e+=t.path),"string"==typeof t.query&&t.query&&(e+="?"+t.query),"string"==typeof t.fragment&&t.fragment&&(e+="#"+t.fragment),e},a.buildHost=function(t){var e="";return t.hostname?(a.ip6_expression.test(t.hostname)?e+="["+t.hostname+"]":e+=t.hostname,t.port&&(e+=":"+t.port),e):""},a.buildAuthority=function(t){return a.buildUserinfo(t)+a.buildHost(t)},a.buildUserinfo=function(t){var e="";return t.username&&(e+=a.encode(t.username),t.password&&(e+=":"+a.encode(t.password)),e+="@"),e},a.buildQuery=function(t,e,i){var n,s,r,l,h="";for(s in t)if(v.call(t,s)&&s)if(o(t[s]))for(n={},r=0,l=t[s].length;r<l;r++)void 0!==t[s][r]&&void 0===n[t[s][r]+""]&&(h+="&"+a.buildQueryParameter(s,t[s][r],i),!0!==e&&(n[t[s][r]+""]=!0));else void 0!==t[s]&&(h+="&"+a.buildQueryParameter(s,t[s],i));return h.substring(1)},a.buildQueryParameter=function(t,e,i){return a.encodeQuery(t,i)+(null!==e?"="+a.encodeQuery(e,i):"")},a.addQuery=function(t,e,i){if("object"==typeof e)for(var n in e)v.call(e,n)&&a.addQuery(t,n,e[n]);else{if("string"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===t[e])return void(t[e]=i);"string"==typeof t[e]&&(t[e]=[t[e]]),o(i)||(i=[i]),t[e]=(t[e]||[]).concat(i)}},a.removeQuery=function(t,e,i){var n,s,h;if(o(e))for(n=0,s=e.length;n<s;n++)t[e[n]]=void 0;else if("RegExp"===r(e))for(h in t)e.test(h)&&(t[h]=void 0);else if("object"==typeof e)for(h in e)v.call(e,h)&&a.removeQuery(t,h,e[h]);else{if("string"!=typeof e)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==i?"RegExp"===r(i)?!o(t[e])&&i.test(t[e])?t[e]=void 0:t[e]=l(t[e],i):t[e]!==String(i)||o(i)&&1!==i.length?o(t[e])&&(t[e]=l(t[e],i)):t[e]=void 0:t[e]=void 0}},a.hasQuery=function(t,e,i,n){switch(r(e)){case"String":break;case"RegExp":for(var s in t)if(v.call(t,s)&&e.test(s)&&(void 0===i||a.hasQuery(t,s,i)))return!0;return!1;case"Object":for(var l in e)if(v.call(e,l)&&!a.hasQuery(t,l,e[l]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(r(i)){case"Undefined":return e in t;case"Boolean":return i===Boolean(o(t[e])?t[e].length:t[e]);case"Function":return!!i(t[e],e,t);case"Array":return!!o(t[e])&&(n?h:d)(t[e],i);case"RegExp":return o(t[e])?!!n&&h(t[e],i):Boolean(t[e]&&t[e].match(i));case"Number":i=String(i);case"String":return o(t[e])?!!n&&h(t[e],i):t[e]===i;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},a.commonPath=function(t,e){var i,n=Math.min(t.length,e.length);for(i=0;i<n;i++)if(t.charAt(i)!==e.charAt(i)){i--;break}return i<1?t.charAt(0)===e.charAt(0)&&"/"===t.charAt(0)?"/":"":("/"===t.charAt(i)&&"/"===e.charAt(i)||(i=t.substring(0,i).lastIndexOf("/")),t.substring(0,i+1))},a.withinString=function(t,e,i){i||(i={});var n=i.start||a.findUri.start,s=i.end||a.findUri.end,r=i.trim||a.findUri.trim,o=/[a-z0-9-]=["']?$/i;for(n.lastIndex=0;;){var l=n.exec(t);if(!l)break;var h=l.index;if(i.ignoreHtml){var d=t.slice(Math.max(h-3,0),h);if(d&&o.test(d))continue}var c=h+t.slice(h).search(s),u=t.slice(h,c).replace(r,"");if(!i.ignore||!i.ignore.test(u)){c=h+u.length;var g=e(u,h,c,t);t=t.slice(0,h)+g+t.slice(c),n.lastIndex=h+g.length}}return n.lastIndex=0,t},a.ensureValidHostname=function(e){if(e.match(a.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(t.toASCII(e).match(a.invalid_hostname_characters))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]')}},a.noConflict=function(t){if(t){var e={URI:this.noConflict()};return n.URITemplate&&"function"==typeof n.URITemplate.noConflict&&(e.URITemplate=n.URITemplate.noConflict()),n.IPv6&&"function"==typeof n.IPv6.noConflict&&(e.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&"function"==typeof n.SecondLevelDomains.noConflict&&(e.SecondLevelDomains=n.SecondLevelDomains.noConflict()),e}return n.URI===this&&(n.URI=f),this},m.build=function(t){return!0===t?this._deferred_build=!0:(void 0===t||this._deferred_build)&&(this._string=a.build(this._parts),this._deferred_build=!1),this},m.clone=function(){return new a(this)},m.valueOf=m.toString=function(){return this.build(!1)._string},m.protocol=p("protocol"),m.username=p("username"),m.password=p("password"),m.hostname=p("hostname"),m.port=p("port"),m.query=_("query","?"),m.fragment=_("fragment","#"),m.search=function(t,e){var i=this.query(t,e);return"string"==typeof i&&i.length?"?"+i:i},m.hash=function(t,e){var i=this.fragment(t,e);return"string"==typeof i&&i.length?"#"+i:i},m.pathname=function(t,e){if(void 0===t||!0===t){var i=this._parts.path||(this._parts.hostname?"/":"");return t?(this._parts.urn?a.decodeUrnPath:a.decodePath)(i):i}return this._parts.urn?this._parts.path=t?a.recodeUrnPath(t):"":this._parts.path=t?a.recodePath(t):"/",this.build(!e),this},m.path=m.pathname,m.href=function(t,e){var i;if(void 0===t)return this.toString();this._string="",this._parts=a._parts();var n=t instanceof a,s="object"==typeof t&&(t.hostname||t.path||t.pathname);if(t.nodeName&&(t=t[a.getDomAttribute(t)]||"",s=!1),!n&&s&&void 0!==t.pathname&&(t=t.toString()),"string"==typeof t||t instanceof String)this._parts=a.parse(String(t),this._parts);else{if(!n&&!s)throw new TypeError("invalid input");var r=n?t._parts:t;for(i in r)v.call(this._parts,i)&&(this._parts[i]=r[i])}return this.build(!e),this},m.is=function(t){var e=!1,n=!1,s=!1,r=!1,o=!1,l=!1,h=!1,d=!this._parts.urn;switch(this._parts.hostname&&(d=!1,n=a.ip4_expression.test(this._parts.hostname),s=a.ip6_expression.test(this._parts.hostname),e=n||s,r=!e,o=r&&i&&i.has(this._parts.hostname),l=r&&a.idn_expression.test(this._parts.hostname),h=r&&a.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return d;case"absolute":return!d;case"domain":case"name":return r;case"sld":return o;case"ip":return e;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return s;case"idn":return l;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return h}return null};var x=m.protocol,S=m.port,B=m.hostname;m.protocol=function(t,e){if(void 0!==t&&t&&(t=t.replace(/:(\/\/)?$/,""),!t.match(a.protocol_expression)))throw new TypeError('Protocol "'+t+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return x.call(this,t,e)},m.scheme=m.protocol,m.port=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t&&(0===t&&(t=null),t&&(t+="",":"===t.charAt(0)&&(t=t.substring(1)),t.match(/[^0-9]/))))throw new TypeError('Port "'+t+'" contains characters other than [0-9]');return S.call(this,t,e)},m.hostname=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t){var i={};if("/"!==a.parseHost(t,i))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');t=i.hostname}return B.call(this,t,e)},m.origin=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){var i=this.protocol();return this.authority()?(i?i+"://":"")+this.authority():""}var n=a(t);return this.protocol(n.protocol()).authority(n.authority()).build(!e),this},m.host=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?a.buildHost(this._parts):"";if("/"!==a.parseHost(t,this._parts))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},m.authority=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?a.buildAuthority(this._parts):"";if("/"!==a.parseAuthority(t,this._parts))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},m.userinfo=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.username)return"";var i=a.buildUserinfo(this._parts);return i.substring(0,i.length-1)}return"@"!==t[t.length-1]&&(t+="@"),a.parseUserinfo(t,this._parts),this.build(!e),this},m.resource=function(t,e){var i;return void 0===t?this.path()+this.search()+this.hash():(i=a.parse(t),this._parts.path=i.path,this._parts.query=i.query,this._parts.fragment=i.fragment,this.build(!e),this)},m.subdomain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,i)||""}var n=this._parts.hostname.length-this.domain().length,r=this._parts.hostname.substring(0,n),o=new RegExp("^"+s(r));return t&&"."!==t.charAt(t.length-1)&&(t+="."),t&&a.ensureValidHostname(t),this._parts.hostname=this._parts.hostname.replace(o,t),this.build(!e),this},m.domain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.match(/\./g);if(i&&i.length<2)return this._parts.hostname;var n=this._parts.hostname.length-this.tld(e).length-1;return n=this._parts.hostname.lastIndexOf(".",n-1)+1,this._parts.hostname.substring(n)||""}if(!t)throw new TypeError("cannot set domain empty");if(a.ensureValidHostname(t),!this._parts.hostname||this.is("IP"))this._parts.hostname=t;else{var r=new RegExp(s(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(r,t)}return this.build(!e),this},m.tld=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.lastIndexOf("."),a=this._parts.hostname.substring(n+1);return!0!==e&&i&&i.list[a.toLowerCase()]?i.get(this._parts.hostname)||a:a}var r;if(!t)throw new TypeError("cannot set TLD empty");if(t.match(/[^a-zA-Z0-9-]/)){if(!i||!i.is(t))throw new TypeError('TLD "'+t+'" contains characters other than [A-Z0-9]');r=new RegExp(s(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,t)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");r=new RegExp(s(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,t)}return this.build(!e),this},m.directory=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var i=this._parts.path.length-this.filename().length-1,n=this._parts.path.substring(0,i)||(this._parts.hostname?"/":"");return t?a.decodePath(n):n}var r=this._parts.path.length-this.filename().length,o=this._parts.path.substring(0,r),l=new RegExp("^"+s(o));return this.is("relative")||(t||(t="/"),"/"!==t.charAt(0)&&(t="/"+t)),t&&"/"!==t.charAt(t.length-1)&&(t+="/"),t=a.recodePath(t),this._parts.path=this._parts.path.replace(l,t),this.build(!e),this},m.filename=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path||"/"===this._parts.path)return"";var i=this._parts.path.lastIndexOf("/"),n=this._parts.path.substring(i+1);return t?a.decodePathSegment(n):n}var r=!1;"/"===t.charAt(0)&&(t=t.substring(1)),t.match(/\.?\//)&&(r=!0);var o=new RegExp(s(this.filename())+"$");return t=a.recodePath(t),this._parts.path=this._parts.path.replace(o,t),r?this.normalizePath(e):this.build(!e),this},m.suffix=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path||"/"===this._parts.path)return"";var i,n,r=this.filename(),o=r.lastIndexOf(".");return-1===o?"":(i=r.substring(o+1),n=/^[a-z0-9%]+$/i.test(i)?i:"",t?a.decodePathSegment(n):n)}"."===t.charAt(0)&&(t=t.substring(1));var l,h=this.suffix();if(h)l=t?new RegExp(s(h)+"$"):new RegExp(s("."+h)+"$");else{if(!t)return this;this._parts.path+="."+a.recodePath(t)}return l&&(t=a.recodePath(t),this._parts.path=this._parts.path.replace(l,t)),this.build(!e),this},m.segment=function(t,e,i){var n=this._parts.urn?":":"/",a=this.path(),s="/"===a.substring(0,1),r=a.split(n);if(void 0!==t&&"number"!=typeof t&&(i=e,e=t,t=void 0),void 0!==t&&"number"!=typeof t)throw new Error('Bad segment "'+t+'", must be 0-based integer');if(s&&r.shift(),t<0&&(t=Math.max(r.length+t,0)),void 0===e)return void 0===t?r:r[t];if(null===t||void 0===r[t])if(o(e)){r=[];for(var l=0,h=e.length;l<h;l++)(e[l].length||r.length&&r[r.length-1].length)&&(r.length&&!r[r.length-1].length&&r.pop(),r.push(c(e[l])))}else(e||"string"==typeof e)&&(e=c(e),""===r[r.length-1]?r[r.length-1]=e:r.push(e));else e?r[t]=c(e):r.splice(t,1);return s&&r.unshift(""),this.path(r.join(n),i)},m.segmentCoded=function(t,e,i){var n,s,r;if("number"!=typeof t&&(i=e,e=t,t=void 0),void 0===e){if(n=this.segment(t,e,i),o(n))for(s=0,r=n.length;s<r;s++)n[s]=a.decode(n[s]);else n=void 0!==n?a.decode(n):void 0;return n}if(o(e))for(s=0,r=e.length;s<r;s++)e[s]=a.encode(e[s]);else e="string"==typeof e||e instanceof String?a.encode(e):e;return this.segment(t,e,i)};var D=m.query;return m.query=function(t,e){if(!0===t)return a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof t){var i=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace),n=t.call(this,i);return this._parts.query=a.buildQuery(n||i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this}return void 0!==t&&"string"!=typeof t?(this._parts.query=a.buildQuery(t,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this):D.call(this,t,e)},m.setQuery=function(t,e,i){var n=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof t||t instanceof String)n[t]=void 0!==e?e:null;else{if("object"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var s in t)v.call(t,s)&&(n[s]=t[s])}return this._parts.query=a.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(i=e),this.build(!i),this},m.addQuery=function(t,e,i){var n=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.addQuery(n,t,void 0===e?null:e),this._parts.query=a.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(i=e),this.build(!i),this},m.removeQuery=function(t,e,i){var n=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.removeQuery(n,t,e),this._parts.query=a.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(i=e),this.build(!i),this},m.hasQuery=function(t,e,i){var n=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.hasQuery(n,t,e,i)},m.setSearch=m.setQuery,m.addSearch=m.addQuery,m.removeSearch=m.removeQuery,m.hasSearch=m.hasQuery,m.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},m.normalizeProtocol=function(t){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!t)),this},m.normalizeHostname=function(i){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!i)),this},m.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===a.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!t)),this},m.normalizePath=function(t){var e=this._parts.path;if(!e)return this;if(this._parts.urn)return this._parts.path=a.recodeUrnPath(this._parts.path),this.build(!t),this;if("/"===this._parts.path)return this;e=a.recodePath(e);var i,n,s,r="";for("/"!==e.charAt(0)&&(i=!0,e="/"+e),"/.."!==e.slice(-3)&&"/."!==e.slice(-2)||(e+="/"),e=e.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),i&&(r=e.substring(1).match(/^(\.\.\/)+/)||"")&&(r=r[0]);-1!==(n=e.search(/\/\.\.(\/|$)/));)0!==n?(s=e.substring(0,n).lastIndexOf("/"),-1===s&&(s=n),e=e.substring(0,s)+e.substring(n+3)):e=e.substring(3);return i&&this.is("relative")&&(e=r+e.substring(1)),this._parts.path=e,this.build(!t),this},m.normalizePathname=m.normalizePath,m.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(a.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!t)),this},m.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null,this.build(!t)),this},m.normalizeSearch=m.normalizeQuery,m.normalizeHash=m.normalizeFragment,m.iso8859=function(){var t=a.encode,e=a.decode;a.encode=escape,a.decode=decodeURIComponent;try{this.normalize()}finally{a.encode=t,a.decode=e}return this},m.unicode=function(){var t=a.encode,e=a.decode;a.encode=g,a.decode=unescape;try{this.normalize()}finally{a.encode=t,a.decode=e}return this},m.readable=function(){var e=this.clone();e.username("").password("").normalize();var i="";if(e._parts.protocol&&(i+=e._parts.protocol+"://"),e._parts.hostname&&(e.is("punycode")&&t?(i+=t.toUnicode(e._parts.hostname),e._parts.port&&(i+=":"+e._parts.port)):i+=e.host()),e._parts.hostname&&e._parts.path&&"/"!==e._parts.path.charAt(0)&&(i+="/"),i+=e.path(!0),e._parts.query){for(var n="",s=0,r=e._parts.query.split("&"),o=r.length;s<o;s++){var l=(r[s]||"").split("=");n+="&"+a.decodeQuery(l[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==l[1]&&(n+="="+a.decodeQuery(l[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}i+="?"+n.substring(1)}return i+=a.decodeQuery(e.hash(),!0)},m.absoluteTo=function(t){var e,i,n,s=this.clone(),r=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t instanceof a||(t=new a(t)),s._parts.protocol||(s._parts.protocol=t._parts.protocol),this._parts.hostname)return s;for(i=0;n=r[i];i++)s._parts[n]=t._parts[n];return s._parts.path?".."===s._parts.path.substring(-2)&&(s._parts.path+="/"):(s._parts.path=t._parts.path,s._parts.query||(s._parts.query=t._parts.query)),"/"!==s.path().charAt(0)&&(e=t.directory(),e=e||(0===t.path().indexOf("/")?"/":""),s._parts.path=(e?e+"/":"")+s._parts.path,s.normalizePath()),s.build(),s},m.relativeTo=function(t){var e,i,n,s,r,o=this.clone().normalize();if(o._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t=new a(t).normalize(),e=o._parts,i=t._parts,s=o.path(),r=t.path(),"/"!==s.charAt(0))throw new Error("URI is already relative");if("/"!==r.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(e.protocol===i.protocol&&(e.protocol=null),e.username!==i.username||e.password!==i.password)return o.build();if(null!==e.protocol||null!==e.username||null!==e.password)return o.build();if(e.hostname!==i.hostname||e.port!==i.port)return o.build();if(e.hostname=null,e.port=null,s===r)return e.path="",o.build();if(!(n=a.commonPath(s,r)))return o.build();var l=i.path.substring(n.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return e.path=l+e.path.substring(n.length)||"./",o.build()},m.equals=function(t){var e,i,n,s=this.clone(),r=new a(t),l={},h={},c={};if(s.normalize(),r.normalize(),s.toString()===r.toString())return!0;if(e=s.query(),i=r.query(),s.query(""),r.query(""),s.toString()!==r.toString())return!1;if(e.length!==i.length)return!1;l=a.parseQuery(e,this._parts.escapeQuerySpace),h=a.parseQuery(i,this._parts.escapeQuerySpace);for(n in l)if(v.call(l,n)){if(o(l[n])){if(!d(l[n],h[n]))return!1}else if(l[n]!==h[n])return!1;c[n]=!0}for(n in h)if(v.call(h,n)&&!c[n])return!1;return!0},m.duplicateQueryParameters=function(t){return this._parts.duplicateQueryParameters=!!t,this},m.escapeQuerySpace=function(t){return this._parts.escapeQuerySpace=!!t,this},a}(i(813),i(810),i(811))}()},813:function(t,e,i){(function(t,n){var a;!function(n){function s(t){throw new RangeError(A[t])}function r(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function o(t,e){var i=t.split("@"),n="";return i.length>1&&(n=i[0]+"@",t=i[1]),t=t.replace(j,"."),n+r(t.split("."),e).join(".")}function l(t){for(var e,i,n=[],a=0,s=t.length;a<s;)e=t.charCodeAt(a++),e>=55296&&e<=56319&&a<s?(i=t.charCodeAt(a++),56320==(64512&i)?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),a--)):n.push(e);return n}function h(t){return r(t,function(t){var e="";return t>65535&&(t-=65536,e+=T(t>>>10&1023|55296),t=56320|1023&t),e+=T(t)}).join("")}function d(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:b}function c(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function u(t,e,i){var n=0;for(t=i?z(t/x):t>>1,t+=z(t/e);t>W*C>>1;n+=b)t=z(t/W);return z(n+(W+1)*t/(t+y))}function g(t){var e,i,n,a,r,o,l,c,g,p,_=[],f=t.length,m=0,y=B,x=S;for(i=t.lastIndexOf(D),i<0&&(i=0),n=0;n<i;++n)t.charCodeAt(n)>=128&&s("not-basic"),_.push(t.charCodeAt(n));for(a=i>0?i+1:0;a<f;){for(r=m,o=1,l=b;a>=f&&s("invalid-input"),c=d(t.charCodeAt(a++)),(c>=b||c>z((v-m)/o))&&s("overflow"),m+=c*o,g=l<=x?w:l>=x+C?C:l-x,!(c<g);l+=b)p=b-g,o>z(v/p)&&s("overflow"),o*=p;e=_.length+1,x=u(m-r,e,0==r),z(m/e)>v-y&&s("overflow"),y+=z(m/e),m%=e,_.splice(m++,0,y)}return h(_)}function p(t){var e,i,n,a,r,o,h,d,g,p,_,f,m,y,x,M=[];for(t=l(t),f=t.length,e=B,i=0,r=S,o=0;o<f;++o)(_=t[o])<128&&M.push(T(_));for(n=a=M.length,a&&M.push(D);n<f;){for(h=v,o=0;o<f;++o)(_=t[o])>=e&&_<h&&(h=_);for(m=n+1,h-e>z((v-i)/m)&&s("overflow"),i+=(h-e)*m,e=h,o=0;o<f;++o)if(_=t[o],_<e&&++i>v&&s("overflow"),_==e){for(d=i,g=b;p=g<=r?w:g>=r+C?C:g-r,!(d<p);g+=b)x=d-p,y=b-p,M.push(T(c(p+x%y,0))),d=z(x/y);M.push(T(c(d,0))),r=u(i,m,n==a),i=0,++n}++i,++e}return M.join("")}function _(t){return o(t,function(t){return M.test(t)?g(t.slice(4).toLowerCase()):t})}function f(t){return o(t,function(t){return k.test(t)?"xn--"+p(t):t})}var m,v=("object"==typeof e&&e&&e.nodeType,"object"==typeof t&&t&&t.nodeType,2147483647),b=36,w=1,C=26,y=38,x=700,S=72,B=128,D="-",M=/^xn--/,k=/[^\x20-\x7E]/,j=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},W=b-w,z=Math.floor,T=String.fromCharCode;m={version:"1.3.2",ucs2:{decode:l,encode:h},decode:g,encode:p,toASCII:f,toUnicode:_},void 0!==(a=function(){return m}.call(e,i,e,t))&&(t.exports=a)}()}).call(e,i(278)(t),i(15))},814:function(t,e,i){"use strict";var n=function(){};t.exports=n}});
//# sourceMappingURL=builder_embed_vendor.js.map